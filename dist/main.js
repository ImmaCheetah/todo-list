(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{kj:()=>E,F5:()=>g,k3:()=>v,HA:()=>y,QP:()=>h,mo:()=>k});const t={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let n;const o=new Uint8Array(16);function d(){if(!n&&(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(o)}const l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));const a=function(e,n,o){if(t.randomUUID&&!n&&!e)return t.randomUUID();const a=(e=e||{}).random||(e.rng||d)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,n){o=o||0;for(let e=0;e<16;++e)n[o+e]=a[e];return n}return function(e,t=0){return l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]}(a)};function r(e,t,n,o){let d=a(),l=!1;const r=()=>l;e=e.toString(),t=t.toString();const s=e=>{o=e};return{get title(){return e},get description(){return t},get dueDate(){return n},get priority(){return o},getCompleteState:r,setComplete:()=>{l=0==r()},changePriority:s,editTask:(o,d,l,a)=>{e=o,t=d,n=l,s(a)},printTask:()=>{console.log(`Task title - ${e}, Desc - ${t}, Date - ${n}, Priority - ${o}`)},myTaskUuid:d}}function s(e){let t=a(),n=[];return{title:e,tasks:n,myFolderUuid:t,addTask:e=>{n.push(e)},displayTasks:()=>{for(let e=0;e<n.length;e++)console.log(`Task ${e} - ${n[e].title}, ${n[e].dueDate}, ${n[e].priority}`)},deleteTask:e=>{for(let t=n.length-1;t>=0;--t)n[t].myTaskUuid===e.myTaskUuid&&n.splice(t,1)}}}function i(e){e.tasks.forEach((e=>{!function(e,t){let n=function(e){const t=document.createElement("div"),n=document.createElement("p"),o=document.createElement("p"),d=document.createElement("p"),l=document.createElement("p");return t.classList.add("task-div"),n.textContent=e.title,o.textContent=e.description,d.textContent=e.dueDate,l.textContent=e.priority,t.appendChild(n),t.appendChild(o),t.appendChild(d),t.appendChild(l),(function(e){const t=document.createElement("button");return t.classList.add("task-delete-btn"),t.textContent="-",e.appendChild(t),t.addEventListener("click",(function(e){let t=e.target;v(t.value),t.parentNode.remove()})),t}(t)).value=e.myTaskUuid,(function(e){const t=document.createElement("button");return t.classList.add("task-edit-btn"),t.textContent="+",e.appendChild(t),t.addEventListener("click",(function(e){const t=document.getElementById("edit-form"),n=document.createElement("button");n.classList.add("edit-btn-id"),n.value=e.target.value,t.appendChild(n),function(e){const t=document.getElementById("edit-form"),n=t.elements["task-title"],o=t.elements["task-description"],d=t.elements["task-due-date"],l=t.elements["task-priority"];n.value=e.title,o.value=e.description,d.value=e.dueDate,l.value=e.priority}(h(e.target.value)),k().showModal()})),t}(t)).value=e.myTaskUuid,(function(e){const t=document.createElement("button");return t.classList.add("task-status-btn"),t.textContent="âœ”",e.appendChild(t),t.addEventListener("click",(function(e){let t=e.target;var n;E(t.value),(n=t).parentNode.classList.contains("complete-task")?n.parentNode.classList.remove("complete-task"):n.parentNode.classList.add("complete-task")})),t}(t)).value=e.myTaskUuid,t}(e);document.getElementById(["task-container"]).appendChild(n)}(e)}))}function c(e){const t=document.querySelector(".sidebar"),n=document.createElement("div"),o=document.createElement("button");return n.classList.add("folder-div"),o.classList.add("folder-button"),o.textContent=e.title,o.value=e.myFolderUuid,n.appendChild(o),(function(e){const t=document.createElement("button");return t.classList.add("folder-delete-btn"),t.textContent="-",e.appendChild(t),t.addEventListener("click",(function(e){let t=e.target;g(t.value),t.parentNode.remove()})),t}(n)).value=e.myFolderUuid,t.appendChild(n),o.addEventListener("click",(function(){let t=e.myFolderUuid;return y(e.myFolderUuid),console.log(e.title,e.myFolderUuid),t})),n}function u(e){let t=c(e);document.querySelector(".sidebar").appendChild(t)}let m=0;const f=function(){let e=[];return{folders:e,addFolder:t=>{e.push(t)},deleteFolder:t=>{for(let n=e.length-1;n>=0;--n)e[n].myFolderUuid===t.myFolderUuid&&e.splice(n,1)}}}();function p(){return document.getElementById("task-dialog")}function k(){return document.getElementById("edit-dialog")}function y(e){f.folders.forEach((t=>{e===t.myFolderUuid&&(document.getElementById("task-container").textContent="",i(t),console.log("match found"))}))}function g(e){f.folders.forEach((t=>{e===t.myFolderUuid&&(console.log(e),f.deleteFolder(t))}))}function v(e){f.folders.forEach((t=>{t.tasks.forEach((n=>{e===n.myTaskUuid&&t.deleteTask(n)}))}))}function E(e){f.folders.forEach((t=>{t.tasks.forEach((t=>{e===t.myTaskUuid&&t.setComplete()}))}))}function h(e){let t;return f.folders.forEach((n=>{n.tasks.forEach((n=>{e===n.myTaskUuid&&(t=n)}))})),t}document.getElementById("open-task-modal-btn").addEventListener("click",(function(){p().reset,p().showModal(),function(e){const t=document.getElementById("folder-selection");!function(e){for(let t=e.options.length;t>=0;t--)e.remove(0)}(t),e.folders.forEach((e=>{const n=document.createElement("option");n.textContent=e.title,n.value=e.myFolderUuid,t.appendChild(n)}))}(f)})),document.getElementById("folder-add-btn").addEventListener("click",(function(){document.getElementById("folder-dialog").showModal()})),document.getElementById("folder-confirm-btn").addEventListener("click",(function(e){e.preventDefault();const t=document.getElementById("folder-dialog"),{folderTitleInForm:n}=function(){const e=document.getElementById("folder-form");return{folderForm:e,folderTitleInForm:e.elements["folder-title"].value}}();let o=s(n);u(o),localStorage.setItem(m++,JSON.stringify(o)),console.log("Length of storage when folder is created "+localStorage.length),f.addFolder(o),t.close()})),document.getElementById("task-add-btn").addEventListener("click",(function(e){e.preventDefault();const t=document.getElementById("folder-selection").value,{taskTitle:n,taskDescription:o,taskDueDate:d,taskPriority:l}=function(){const e=document.getElementById("main-form"),t=e.elements["task-title"],n=e.elements["task-description"],o=e.elements["task-due-date"],d=e.elements["task-priority"];return{taskTitle:t.value,taskDescription:n.value,taskDueDate:o.value,taskPriority:d.value}}(),a=r(n,o,d,l);f.folders.forEach((e=>{t===e.myFolderUuid&&e.addTask(a)})),y(t),document.getElementById("main-form").reset(),p().close()})),document.getElementById("task-edit-btn").addEventListener("click",(function(e){e.preventDefault();const t=document.querySelector(".edit-btn-id"),{taskTitle:n,taskDescription:o,taskDueDate:d,taskPriority:l}=function(){const e=document.getElementById("edit-form"),t=e.elements["task-title"],n=e.elements["task-description"],o=e.elements["task-due-date"],d=e.elements["task-priority"];return{taskTitle:t.value,taskDescription:n.value,taskDueDate:o.value,taskPriority:d.value}}();f.folders.forEach((e=>{e.tasks.forEach((a=>{t.value===a.myTaskUuid&&(a.editTask(n,o,d,l),y(e.myFolderUuid),console.log(a))}))})),t.remove(),k().close()}));const U=r("chores","wash dishes","nov 23","high"),T=r("movies","avatar","nov 29","med"),I=r("coding","todo list","dec 10","low");let C=s("Inbox");C.addTask(U),f.addFolder(C),u(C);let b=s("test2");b.addTask(T),b.addTask(U),b.addTask(I),b.deleteTask(T),f.addFolder(b),u(b);let D=[];if(localStorage.getItem(m)){console.log("a folder exists");for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);console.log("this is the key "+t);let n=JSON.parse(localStorage.getItem(t));console.log(n),D.push(n)}}else console.log("no folder");D.forEach((e=>{c(e),console.log(e)})),console.log(D)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FDdEIzQyxFQUFhMkMsR0FFYixJQUFJQyxFQUFjbEgsRUFBTyxTQUN6QmtILEVBQVkvRyxRQUFRNEcsR0FDcEJHLEVBQVkvRyxRQUFRMkcsR0FDcEJJLEVBQVkvRyxRQUFRNkcsR0FDcEJFLEVBQVkzRyxXQUFXd0csR0FDdkJ0QyxFQUFZRSxVQUFVdUMsR0FDdEI1QyxFQUFhNEMsR0FFYixJQUFJQyxFQUFnQixHQUVwQixHQUFJbkIsYUFBYW9CLFFBQVE1QyxHQUFRLENBQzdCMUUsUUFBUUMsSUFBSSxtQkFDWixJQUFLLElBQUk1QixFQUFJLEVBQUdBLEVBQUk2SCxhQUFhMUYsT0FBUW5DLElBQUssQ0FDMUMsSUFBSXBCLEVBQU9pSixhQUFhakosSUFBSW9CLEdBQzVCMkIsUUFBUUMsSUFBSSxtQkFBcUJoRCxHQUVqQyxJQUFJc0ssRUFBV25CLEtBQUtvQixNQUFNdEIsYUFBYW9CLFFBQVFySyxJQUMvQytDLFFBQVFDLElBQUlzSCxHQUVaRixFQUFjL0ksS0FBS2lKLEVBQ3ZCLENBQ0osTUFDSXZILFFBQVFDLElBQUksYUFJaEJvSCxFQUFjdkcsU0FBUW9ELElBRWxCTCxFQUFtQkssR0FDbkJsRSxRQUFRQyxJQUFJaUUsRUFBTyxJQUd2QmxFLFFBQVFDLElBQUlvSCxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9kby1saXN0L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3RvZG8tbGlzdC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0L3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL3V1aWQvZGlzdC9lc20tYnJvd3Nlci9uYXRpdmUuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL3V1aWQvZGlzdC9lc20tYnJvd3Nlci9ybmcuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL3V1aWQvZGlzdC9lc20tYnJvd3Nlci9zdHJpbmdpZnkuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL3V1aWQvZGlzdC9lc20tYnJvd3Nlci92NC5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvbW9kdWxlcy9mYWN0b3JpZXMuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL21vZHVsZXMvZG9tLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsImNvbnN0IHJhbmRvbVVVSUQgPSB0eXBlb2YgY3J5cHRvICE9PSAndW5kZWZpbmVkJyAmJiBjcnlwdG8ucmFuZG9tVVVJRCAmJiBjcnlwdG8ucmFuZG9tVVVJRC5iaW5kKGNyeXB0byk7XG5leHBvcnQgZGVmYXVsdCB7XG4gIHJhbmRvbVVVSURcbn07IiwiLy8gVW5pcXVlIElEIGNyZWF0aW9uIHJlcXVpcmVzIGEgaGlnaCBxdWFsaXR5IHJhbmRvbSAjIGdlbmVyYXRvci4gSW4gdGhlIGJyb3dzZXIgd2UgdGhlcmVmb3JlXG4vLyByZXF1aXJlIHRoZSBjcnlwdG8gQVBJIGFuZCBkbyBub3Qgc3VwcG9ydCBidWlsdC1pbiBmYWxsYmFjayB0byBsb3dlciBxdWFsaXR5IHJhbmRvbSBudW1iZXJcbi8vIGdlbmVyYXRvcnMgKGxpa2UgTWF0aC5yYW5kb20oKSkuXG5sZXQgZ2V0UmFuZG9tVmFsdWVzO1xuY29uc3Qgcm5kczggPSBuZXcgVWludDhBcnJheSgxNik7XG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBybmcoKSB7XG4gIC8vIGxhenkgbG9hZCBzbyB0aGF0IGVudmlyb25tZW50cyB0aGF0IG5lZWQgdG8gcG9seWZpbGwgaGF2ZSBhIGNoYW5jZSB0byBkbyBzb1xuICBpZiAoIWdldFJhbmRvbVZhbHVlcykge1xuICAgIC8vIGdldFJhbmRvbVZhbHVlcyBuZWVkcyB0byBiZSBpbnZva2VkIGluIGEgY29udGV4dCB3aGVyZSBcInRoaXNcIiBpcyBhIENyeXB0byBpbXBsZW1lbnRhdGlvbi5cbiAgICBnZXRSYW5kb21WYWx1ZXMgPSB0eXBlb2YgY3J5cHRvICE9PSAndW5kZWZpbmVkJyAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzICYmIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMuYmluZChjcnlwdG8pO1xuXG4gICAgaWYgKCFnZXRSYW5kb21WYWx1ZXMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignY3J5cHRvLmdldFJhbmRvbVZhbHVlcygpIG5vdCBzdXBwb3J0ZWQuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdXVpZGpzL3V1aWQjZ2V0cmFuZG9tdmFsdWVzLW5vdC1zdXBwb3J0ZWQnKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZ2V0UmFuZG9tVmFsdWVzKHJuZHM4KTtcbn0iLCJpbXBvcnQgdmFsaWRhdGUgZnJvbSAnLi92YWxpZGF0ZS5qcyc7XG4vKipcbiAqIENvbnZlcnQgYXJyYXkgb2YgMTYgYnl0ZSB2YWx1ZXMgdG8gVVVJRCBzdHJpbmcgZm9ybWF0IG9mIHRoZSBmb3JtOlxuICogWFhYWFhYWFgtWFhYWC1YWFhYLVhYWFgtWFhYWFhYWFhYWFhYXG4gKi9cblxuY29uc3QgYnl0ZVRvSGV4ID0gW107XG5cbmZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyArK2kpIHtcbiAgYnl0ZVRvSGV4LnB1c2goKGkgKyAweDEwMCkudG9TdHJpbmcoMTYpLnNsaWNlKDEpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVuc2FmZVN0cmluZ2lmeShhcnIsIG9mZnNldCA9IDApIHtcbiAgLy8gTm90ZTogQmUgY2FyZWZ1bCBlZGl0aW5nIHRoaXMgY29kZSEgIEl0J3MgYmVlbiB0dW5lZCBmb3IgcGVyZm9ybWFuY2VcbiAgLy8gYW5kIHdvcmtzIGluIHdheXMgeW91IG1heSBub3QgZXhwZWN0LiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3V1aWRqcy91dWlkL3B1bGwvNDM0XG4gIHJldHVybiBieXRlVG9IZXhbYXJyW29mZnNldCArIDBdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMV1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAyXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDNdXSArICctJyArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgNF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA1XV0gKyAnLScgKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDZdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgN11dICsgJy0nICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA4XV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDldXSArICctJyArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMTBdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMTFdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMTJdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMTNdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMTRdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMTVdXTtcbn1cblxuZnVuY3Rpb24gc3RyaW5naWZ5KGFyciwgb2Zmc2V0ID0gMCkge1xuICBjb25zdCB1dWlkID0gdW5zYWZlU3RyaW5naWZ5KGFyciwgb2Zmc2V0KTsgLy8gQ29uc2lzdGVuY3kgY2hlY2sgZm9yIHZhbGlkIFVVSUQuICBJZiB0aGlzIHRocm93cywgaXQncyBsaWtlbHkgZHVlIHRvIG9uZVxuICAvLyBvZiB0aGUgZm9sbG93aW5nOlxuICAvLyAtIE9uZSBvciBtb3JlIGlucHV0IGFycmF5IHZhbHVlcyBkb24ndCBtYXAgdG8gYSBoZXggb2N0ZXQgKGxlYWRpbmcgdG9cbiAgLy8gXCJ1bmRlZmluZWRcIiBpbiB0aGUgdXVpZClcbiAgLy8gLSBJbnZhbGlkIGlucHV0IHZhbHVlcyBmb3IgdGhlIFJGQyBgdmVyc2lvbmAgb3IgYHZhcmlhbnRgIGZpZWxkc1xuXG4gIGlmICghdmFsaWRhdGUodXVpZCkpIHtcbiAgICB0aHJvdyBUeXBlRXJyb3IoJ1N0cmluZ2lmaWVkIFVVSUQgaXMgaW52YWxpZCcpO1xuICB9XG5cbiAgcmV0dXJuIHV1aWQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHN0cmluZ2lmeTsiLCJpbXBvcnQgbmF0aXZlIGZyb20gJy4vbmF0aXZlLmpzJztcbmltcG9ydCBybmcgZnJvbSAnLi9ybmcuanMnO1xuaW1wb3J0IHsgdW5zYWZlU3RyaW5naWZ5IH0gZnJvbSAnLi9zdHJpbmdpZnkuanMnO1xuXG5mdW5jdGlvbiB2NChvcHRpb25zLCBidWYsIG9mZnNldCkge1xuICBpZiAobmF0aXZlLnJhbmRvbVVVSUQgJiYgIWJ1ZiAmJiAhb3B0aW9ucykge1xuICAgIHJldHVybiBuYXRpdmUucmFuZG9tVVVJRCgpO1xuICB9XG5cbiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gIGNvbnN0IHJuZHMgPSBvcHRpb25zLnJhbmRvbSB8fCAob3B0aW9ucy5ybmcgfHwgcm5nKSgpOyAvLyBQZXIgNC40LCBzZXQgYml0cyBmb3IgdmVyc2lvbiBhbmQgYGNsb2NrX3NlcV9oaV9hbmRfcmVzZXJ2ZWRgXG5cbiAgcm5kc1s2XSA9IHJuZHNbNl0gJiAweDBmIHwgMHg0MDtcbiAgcm5kc1s4XSA9IHJuZHNbOF0gJiAweDNmIHwgMHg4MDsgLy8gQ29weSBieXRlcyB0byBidWZmZXIsIGlmIHByb3ZpZGVkXG5cbiAgaWYgKGJ1Zikge1xuICAgIG9mZnNldCA9IG9mZnNldCB8fCAwO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxNjsgKytpKSB7XG4gICAgICBidWZbb2Zmc2V0ICsgaV0gPSBybmRzW2ldO1xuICAgIH1cblxuICAgIHJldHVybiBidWY7XG4gIH1cblxuICByZXR1cm4gdW5zYWZlU3RyaW5naWZ5KHJuZHMpO1xufVxuXG5leHBvcnQgZGVmYXVsdCB2NDsiLCJpbXBvcnQge3Y0IGFzIHV1aWR2NH0gZnJvbSAndXVpZCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBUYXNrKHRpdGxlLCBkZXNjcmlwdGlvbiwgZHVlRGF0ZSwgcHJpb3JpdHkpIHtcblxuICAgIGxldCBteVRhc2tVdWlkID0gdXVpZHY0KCk7XG5cbiAgICBsZXQgY29tcGxldGVTdGF0ZSA9IGZhbHNlO1xuXG4gICAgY29uc3QgZ2V0Q29tcGxldGVTdGF0ZSA9ICgpID0+IGNvbXBsZXRlU3RhdGU7XG5cbiAgICBjb25zdCBzZXRDb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgaWYgKGdldENvbXBsZXRlU3RhdGUoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgY29tcGxldGVTdGF0ZSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb21wbGV0ZVN0YXRlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIHRpdGxlID0gdGl0bGUudG9TdHJpbmcoKTtcbiAgICBkZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uLnRvU3RyaW5nKCk7XG5cbiAgICBjb25zdCBjaGFuZ2VQcmlvcml0eSA9IChuZXdQcmlvcml0eSkgPT4ge1xuICAgICAgICBwcmlvcml0eSA9IG5ld1ByaW9yaXR5O1xuICAgIH1cblxuICAgIGNvbnN0IGVkaXRUYXNrID0gKG5ld1RpdGxlLCBuZXdEZXNjcmlwdGlvbiwgbmV3RHVlRGF0ZSwgbmV3UHJpb3JpdHkpID0+IHtcbiAgICAgICAgdGl0bGUgPSBuZXdUaXRsZTtcbiAgICAgICAgZGVzY3JpcHRpb24gPSBuZXdEZXNjcmlwdGlvbjtcbiAgICAgICAgZHVlRGF0ZSA9IG5ld0R1ZURhdGU7XG4gICAgICAgIGNoYW5nZVByaW9yaXR5KG5ld1ByaW9yaXR5KTtcbiAgICB9XG5cbiAgICBjb25zdCBwcmludFRhc2sgPSAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBUYXNrIHRpdGxlIC0gJHt0aXRsZX0sIERlc2MgLSAke2Rlc2NyaXB0aW9ufSwgRGF0ZSAtICR7ZHVlRGF0ZX0sIFByaW9yaXR5IC0gJHtwcmlvcml0eX1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBnZXQgdGl0bGUoKSB7cmV0dXJuIHRpdGxlfSwgXG4gICAgICAgIGdldCBkZXNjcmlwdGlvbigpIHtyZXR1cm4gZGVzY3JpcHRpb259LCBcbiAgICAgICAgZ2V0IGR1ZURhdGUoKSB7cmV0dXJuIGR1ZURhdGV9LCBcbiAgICAgICAgZ2V0IHByaW9yaXR5KCkge3JldHVybiBwcmlvcml0eX0sXG4gICAgICAgIGdldENvbXBsZXRlU3RhdGUsXG4gICAgICAgIHNldENvbXBsZXRlLCBcbiAgICAgICAgY2hhbmdlUHJpb3JpdHksXG4gICAgICAgIGVkaXRUYXNrLFxuICAgICAgICBwcmludFRhc2ssXG4gICAgICAgIG15VGFza1V1aWRcbiAgICB9O1xufTtcblxuXG5leHBvcnQgZnVuY3Rpb24gRm9sZGVyKHRpdGxlKSB7XG4gICAgXG5cbiAgICBsZXQgbXlGb2xkZXJVdWlkID0gdXVpZHY0KCk7XG4gICAgbGV0IHRhc2tzID0gW107XG5cbiAgICBjb25zdCBhZGRUYXNrID0gKG5ld1Rhc2tOYW1lKSA9PiB7XG4gICAgICAgIHRhc2tzLnB1c2gobmV3VGFza05hbWUpO1xuICAgIH1cblxuICAgIGNvbnN0IGRpc3BsYXlUYXNrcyA9ICgpID0+IHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXNrcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYFRhc2sgJHtpfSAtICR7dGFza3NbaV0udGl0bGV9LCAke3Rhc2tzW2ldLmR1ZURhdGV9LCAke3Rhc2tzW2ldLnByaW9yaXR5fWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZGVsZXRlVGFzayA9ICh0YXNrTmFtZSkgPT4ge1xuICAgICAgICAvLyB0YXNrcy5zcGxpY2UodGFza05hbWUsIDEpO1xuICAgICAgICBmb3IgKGxldCBpID0gdGFza3MubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgIGlmICh0YXNrc1tpXS5teVRhc2tVdWlkID09PSB0YXNrTmFtZS5teVRhc2tVdWlkKSB7XG4gICAgICAgICAgICAgICAgdGFza3Muc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgXG4gICAgcmV0dXJuIHt0aXRsZSwgdGFza3MsIG15Rm9sZGVyVXVpZCwgYWRkVGFzaywgZGlzcGxheVRhc2tzLCBkZWxldGVUYXNrfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFN1cGVyRm9sZGVyKCkge1xuICAgIGxldCBmb2xkZXJzID0gW11cblxuICAgIGNvbnN0IGFkZEZvbGRlciA9IChuZXdGb2xkZXJOYW1lKSA9PiB7XG4gICAgICAgIGZvbGRlcnMucHVzaChuZXdGb2xkZXJOYW1lKTtcbiAgICB9XG5cbiAgICBjb25zdCBkZWxldGVGb2xkZXIgPSAoZm9sZGVyTmFtZSkgPT4ge1xuICAgICAgICBmb3IgKGxldCBpID0gZm9sZGVycy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgaWYgKGZvbGRlcnNbaV0ubXlGb2xkZXJVdWlkID09PSBmb2xkZXJOYW1lLm15Rm9sZGVyVXVpZCkge1xuICAgICAgICAgICAgICAgIGZvbGRlcnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtmb2xkZXJzLCBhZGRGb2xkZXIsIGRlbGV0ZUZvbGRlcn1cbn0iLCJpbXBvcnQge1xuICAgIGRpc3BsYXlDdXJyZW50Rm9sZGVyV2l0aElkLFxuICAgIGRlbGV0ZUZvbGRlcldpdGhJZCxcbiAgICBkZWxldGVUYXNrV2l0aElkLFxuICAgIGNoYW5nZVRhc2tTdGF0dXMsXG4gICAgZmluZFRhc2tXaXRoSWQsXG4gICAgZ2V0RWRpdERpYWxvZ1xufSBmcm9tICcuLi9pbmRleC5qcyc7XG5cblxuLy8gQ3JlYXRlIGFsbCBlbGVtZW50cyBmb3IgZWFjaCB0YXNrIHByb3BlcnR5IGFuZCBjaGFuZ2UgdGV4dCBjb250ZW50IHRvIGNvcnJlc3BvbmRpbmcgdmFsdWVcbi8vIFRoZW4gYWRkIHRoZW0gdG8gYSBtYWluIGRpdiBhbmQgcmV0dXJuXG5mdW5jdGlvbiBjcmVhdGVUYXNrRWxlbWVudCh0YXNrTmFtZSkge1xuICAgIGNvbnN0IHRhc2tEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb25zdCB0YXNrVGl0bGVJbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBjb25zdCB0YXNrRGVzY3JpcHRpb25JbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBjb25zdCB0YXNrRHVlRGF0ZUluRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIGNvbnN0IHRhc2tQcmlvcml0eUluRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIFxuICAgIHRhc2tEaXYuY2xhc3NMaXN0LmFkZCgndGFzay1kaXYnKTtcbiAgICB0YXNrVGl0bGVJbkRpdi50ZXh0Q29udGVudCA9IHRhc2tOYW1lLnRpdGxlO1xuICAgIHRhc2tEZXNjcmlwdGlvbkluRGl2LnRleHRDb250ZW50ID0gdGFza05hbWUuZGVzY3JpcHRpb247XG4gICAgdGFza0R1ZURhdGVJbkRpdi50ZXh0Q29udGVudCA9IHRhc2tOYW1lLmR1ZURhdGU7XG4gICAgdGFza1ByaW9yaXR5SW5EaXYudGV4dENvbnRlbnQgPSB0YXNrTmFtZS5wcmlvcml0eTtcblxuICAgIHRhc2tEaXYuYXBwZW5kQ2hpbGQodGFza1RpdGxlSW5EaXYpO1xuICAgIHRhc2tEaXYuYXBwZW5kQ2hpbGQodGFza0Rlc2NyaXB0aW9uSW5EaXYpO1xuICAgIHRhc2tEaXYuYXBwZW5kQ2hpbGQodGFza0R1ZURhdGVJbkRpdik7XG4gICAgdGFza0Rpdi5hcHBlbmRDaGlsZCh0YXNrUHJpb3JpdHlJbkRpdik7XG4gICAgY3JlYXRlVGFza0RlbGV0ZUJ1dHRvbih0YXNrRGl2KS52YWx1ZSA9IHRhc2tOYW1lLm15VGFza1V1aWQ7XG4gICAgY3JlYXRlVGFza0VkaXRCdXR0b24odGFza0RpdikudmFsdWUgPSB0YXNrTmFtZS5teVRhc2tVdWlkO1xuICAgIGNyZWF0ZVRhc2tTdGF0dXNCdXR0b24odGFza0RpdikudmFsdWUgPSB0YXNrTmFtZS5teVRhc2tVdWlkO1xuXG4gICAgcmV0dXJuIHRhc2tEaXY7XG59XG5cbi8vIFRha2UgaW4gdGFzayBhbmQgd2hlcmUgdG8gYXBwZW5kXG4vLyBDcmVhdGUgdGhlIHRhc2sgdXNpbmcgY3JlYXRlVGFza0VsZW1lbnQgYW5kIGFzc2lnbiB0byB2YXJpYWJsZVxuLy8gVGFyZ2V0IGVsZW1lbnQgdG8gYXBwZW5kIHRvIGFuZCBhcHBlbmRcbmZ1bmN0aW9uIGFwcGVuZFRhc2sodGFza05hbWUsIGxvY2F0aW9uKSB7XG4gICAgbGV0IHRhc2tET00gPSBjcmVhdGVUYXNrRWxlbWVudCh0YXNrTmFtZSk7XG5cbiAgICBjb25zdCBsb2NhdGlvbkRPTSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxvY2F0aW9uKTtcbiAgICBsb2NhdGlvbkRPTS5hcHBlbmRDaGlsZCh0YXNrRE9NKTtcbn1cblxuLy8gVGFrZSBpbiBmb2xkZXIgbmFtZSB0aGVuIGxvb3AgdGhyb3VnaCB0YXNrcyBpbnNpZGUgZm9sZGVyIHRvIGFwcGVuZCB0byBzY3JlZW5cbmZ1bmN0aW9uIGRpc3BsYXlGb2xkZXJUYXNrcyhmb2xkZXJOYW1lKSB7XG4gICAgZm9sZGVyTmFtZS50YXNrcy5mb3JFYWNoKHRhc2sgPT4ge1xuICAgICAgICBhcHBlbmRUYXNrKHRhc2ssIFsndGFzay1jb250YWluZXInXSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldFRhc2tGb3JtSW5mbygpIHtcbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tZm9ybScpO1xuXG4gICAgY29uc3QgdGFza1RpdGxlSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay10aXRsZSddO1xuICAgIGNvbnN0IHRhc2tEZXNjcmlwdGlvbkluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stZGVzY3JpcHRpb24nXTtcbiAgICBjb25zdCB0YXNrRHVlRGF0ZUluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stZHVlLWRhdGUnXTtcbiAgICBjb25zdCB0YXNrUHJpb3JpdHlJbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLXByaW9yaXR5J107XG4gICAgXG4gICAgbGV0IHRhc2tUaXRsZSA9IHRhc2tUaXRsZUluRm9ybS52YWx1ZTtcbiAgICBsZXQgdGFza0Rlc2NyaXB0aW9uID0gdGFza0Rlc2NyaXB0aW9uSW5Gb3JtLnZhbHVlO1xuICAgIGxldCB0YXNrRHVlRGF0ZSA9IHRhc2tEdWVEYXRlSW5Gb3JtLnZhbHVlO1xuICAgIGxldCB0YXNrUHJpb3JpdHkgPSB0YXNrUHJpb3JpdHlJbkZvcm0udmFsdWU7XG5cbiAgICByZXR1cm4ge3Rhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uLCB0YXNrRHVlRGF0ZSwgdGFza1ByaW9yaXR5fTtcbn0gXG5cbmZ1bmN0aW9uIGdldFRhc2tFZGl0Rm9ybUluZm8oKSB7XG4gICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0LWZvcm0nKTtcblxuICAgIGNvbnN0IHRhc2tUaXRsZUluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stdGl0bGUnXTtcbiAgICBjb25zdCB0YXNrRGVzY3JpcHRpb25JbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLWRlc2NyaXB0aW9uJ107XG4gICAgY29uc3QgdGFza0R1ZURhdGVJbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLWR1ZS1kYXRlJ107XG4gICAgY29uc3QgdGFza1ByaW9yaXR5SW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay1wcmlvcml0eSddO1xuICAgIFxuICAgIGxldCB0YXNrVGl0bGUgPSB0YXNrVGl0bGVJbkZvcm0udmFsdWU7XG4gICAgbGV0IHRhc2tEZXNjcmlwdGlvbiA9IHRhc2tEZXNjcmlwdGlvbkluRm9ybS52YWx1ZTtcbiAgICBsZXQgdGFza0R1ZURhdGUgPSB0YXNrRHVlRGF0ZUluRm9ybS52YWx1ZTtcbiAgICBsZXQgdGFza1ByaW9yaXR5ID0gdGFza1ByaW9yaXR5SW5Gb3JtLnZhbHVlO1xuXG4gICAgcmV0dXJuIHt0YXNrVGl0bGUsIHRhc2tEZXNjcmlwdGlvbiwgdGFza0R1ZURhdGUsIHRhc2tQcmlvcml0eX07XG59IFxuXG4vLyBDcmVhdGUgYnV0dG9uIHRvIGhvbGQgZm9sZGVyIGFuZCB0aXRsZVxuLy8gQWRkIHRpdGxlIHRvIGRpdiBhbmQgcmV0dXJuXG5mdW5jdGlvbiBjcmVhdGVGb2xkZXJCdXR0b24oZm9sZGVyTmFtZSkge1xuICAgIGNvbnN0IHNpZGViYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2lkZWJhcicpO1xuICAgIGNvbnN0IGZvbGRlckRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IGZvbGRlckJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXG4gICAgZm9sZGVyRGl2LmNsYXNzTGlzdC5hZGQoJ2ZvbGRlci1kaXYnKTtcbiAgICBmb2xkZXJCdG4uY2xhc3NMaXN0LmFkZCgnZm9sZGVyLWJ1dHRvbicpO1xuICAgIGZvbGRlckJ0bi50ZXh0Q29udGVudCA9IGZvbGRlck5hbWUudGl0bGU7XG4gICAgZm9sZGVyQnRuLnZhbHVlID0gZm9sZGVyTmFtZS5teUZvbGRlclV1aWQ7XG5cbiAgICBmb2xkZXJEaXYuYXBwZW5kQ2hpbGQoZm9sZGVyQnRuKTtcbiAgICBcbiAgICAvLyBDcmVhdGUgdGhlIGRlbCBidG4gYW5kICBhc3NpZ24gc2FtZSBpZCBhcyBmb2xkZXIgdG8gaXRcbiAgICBjcmVhdGVGb2xkZXJEZWxldGVCdXR0b24oZm9sZGVyRGl2KS52YWx1ZSA9IGZvbGRlck5hbWUubXlGb2xkZXJVdWlkO1xuXG4gICAgc2lkZWJhci5hcHBlbmRDaGlsZChmb2xkZXJEaXYpO1xuXG4gICAgZm9sZGVyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGxldCBjdXJyZW50Rm9sZGVySWQgPSBmb2xkZXJOYW1lLm15Rm9sZGVyVXVpZDtcbiAgICAgICAgZGlzcGxheUN1cnJlbnRGb2xkZXJXaXRoSWQoZm9sZGVyTmFtZS5teUZvbGRlclV1aWQpO1xuICAgICAgICBjb25zb2xlLmxvZyhmb2xkZXJOYW1lLnRpdGxlLCBmb2xkZXJOYW1lLm15Rm9sZGVyVXVpZCk7XG4gICAgICAgIHJldHVybiBjdXJyZW50Rm9sZGVySWQ7XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIGZvbGRlckRpdjtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRm9sZGVyRGVsZXRlQnV0dG9uKGZvbGRlcikge1xuICAgIGNvbnN0IGZvbGRlckRlbGV0ZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXG4gICAgZm9sZGVyRGVsZXRlQnRuLmNsYXNzTGlzdC5hZGQoJ2ZvbGRlci1kZWxldGUtYnRuJyk7XG4gICAgZm9sZGVyRGVsZXRlQnRuLnRleHRDb250ZW50ID0gJy0nO1xuXG4gICAgZm9sZGVyLmFwcGVuZENoaWxkKGZvbGRlckRlbGV0ZUJ0bik7XG5cbiAgICBmb2xkZXJEZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGxldCB0aGlzQnV0dG9uID0gZS50YXJnZXQ7XG4gICAgICAgIGRlbGV0ZUZvbGRlcldpdGhJZCh0aGlzQnV0dG9uLnZhbHVlKTtcbiAgICAgICAgdGhpc0J1dHRvbi5wYXJlbnROb2RlLnJlbW92ZSgpO1xuICAgIH0pXG5cbiAgICByZXR1cm4gZm9sZGVyRGVsZXRlQnRuO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVUYXNrRGVsZXRlQnV0dG9uKHRhc2spIHtcbiAgICBjb25zdCB0YXNrRGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG5cbiAgICB0YXNrRGVsZXRlQnRuLmNsYXNzTGlzdC5hZGQoJ3Rhc2stZGVsZXRlLWJ0bicpO1xuICAgIHRhc2tEZWxldGVCdG4udGV4dENvbnRlbnQgPSAnLSc7XG5cbiAgICB0YXNrLmFwcGVuZENoaWxkKHRhc2tEZWxldGVCdG4pO1xuXG4gICAgdGFza0RlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgbGV0IHRoaXNCdXR0b24gPSBlLnRhcmdldDtcbiAgICAgICAgZGVsZXRlVGFza1dpdGhJZCh0aGlzQnV0dG9uLnZhbHVlKTtcbiAgICAgICAgdGhpc0J1dHRvbi5wYXJlbnROb2RlLnJlbW92ZSgpO1xuICAgIH0pXG5cbiAgICByZXR1cm4gdGFza0RlbGV0ZUJ0bjtcbn1cblxuZnVuY3Rpb24gY3JlYXRlVGFza0VkaXRCdXR0b24odGFzaykge1xuICAgIGNvbnN0IHRhc2tFZGl0QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG5cbiAgICB0YXNrRWRpdEJ0bi5jbGFzc0xpc3QuYWRkKCd0YXNrLWVkaXQtYnRuJyk7XG4gICAgdGFza0VkaXRCdG4udGV4dENvbnRlbnQgPSAnKyc7XG5cbiAgICB0YXNrLmFwcGVuZENoaWxkKHRhc2tFZGl0QnRuKTtcblxuICAgIHRhc2tFZGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAvLyBDcmVhdGUgYSBidXR0b24gdG8gaG9sZCBJZCB2YWx1ZVxuICAgICAgICBjb25zdCBlZGl0Rm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0LWZvcm0nKTtcbiAgICAgICAgY29uc3QgYnRuRm9ySWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblxuICAgICAgICBidG5Gb3JJZC5jbGFzc0xpc3QuYWRkKCdlZGl0LWJ0bi1pZCcpO1xuICAgICAgICBidG5Gb3JJZC52YWx1ZSA9IGUudGFyZ2V0LnZhbHVlXG4gICAgICAgIGVkaXRGb3JtLmFwcGVuZENoaWxkKGJ0bkZvcklkKTtcblxuICAgICAgICAvLyBDaGFuZ2UgZm9ybSBmaWVsZHMgdG8gdGFzayBpbmZvIGFuZCBvcGVuIG1vZGFsXG4gICAgICAgIGNoYW5nZVRhc2tGb3JtRmllbGRzKGZpbmRUYXNrV2l0aElkKGUudGFyZ2V0LnZhbHVlKSk7XG4gICAgICAgIGdldEVkaXREaWFsb2coKS5zaG93TW9kYWwoKTtcbiAgICB9KVxuXG4gICAgcmV0dXJuIHRhc2tFZGl0QnRuO1xufVxuXG5mdW5jdGlvbiBjaGFuZ2VUYXNrRm9ybUZpZWxkcyh0YXNrKSB7XG4gICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0LWZvcm0nKTtcblxuICAgIGNvbnN0IHRhc2tUaXRsZUluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stdGl0bGUnXTtcbiAgICBjb25zdCB0YXNrRGVzY3JpcHRpb25JbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLWRlc2NyaXB0aW9uJ107XG4gICAgY29uc3QgdGFza0R1ZURhdGVJbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLWR1ZS1kYXRlJ107XG4gICAgY29uc3QgdGFza1ByaW9yaXR5SW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay1wcmlvcml0eSddO1xuXG4gICAgdGFza1RpdGxlSW5Gb3JtLnZhbHVlID0gdGFzay50aXRsZTtcbiAgICB0YXNrRGVzY3JpcHRpb25JbkZvcm0udmFsdWUgPSB0YXNrLmRlc2NyaXB0aW9uO1xuICAgIHRhc2tEdWVEYXRlSW5Gb3JtLnZhbHVlID0gdGFzay5kdWVEYXRlO1xuICAgIHRhc2tQcmlvcml0eUluRm9ybS52YWx1ZSA9IHRhc2sucHJpb3JpdHk7XG59IFxuXG5mdW5jdGlvbiBjcmVhdGVUYXNrU3RhdHVzQnV0dG9uKHRhc2spIHtcbiAgICBjb25zdCB0YXNrU3RhdHVzQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG5cbiAgICB0YXNrU3RhdHVzQnRuLmNsYXNzTGlzdC5hZGQoJ3Rhc2stc3RhdHVzLWJ0bicpO1xuICAgIHRhc2tTdGF0dXNCdG4udGV4dENvbnRlbnQgPSAn4pyUJztcblxuICAgIHRhc2suYXBwZW5kQ2hpbGQodGFza1N0YXR1c0J0bik7XG5cbiAgICB0YXNrU3RhdHVzQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBsZXQgdGhpc0J1dHRvbiA9IGUudGFyZ2V0O1xuICAgICAgICBjaGFuZ2VUYXNrU3RhdHVzKHRoaXNCdXR0b24udmFsdWUpO1xuICAgICAgICB0b2dnbGVDb21wbGV0ZVN0eWxlKHRoaXNCdXR0b24pO1xuICAgIH0pXG5cbiAgICByZXR1cm4gdGFza1N0YXR1c0J0bjtcbn1cblxuZnVuY3Rpb24gdG9nZ2xlQ29tcGxldGVTdHlsZShlbGVtZW50KSB7XG4gICAgaWYgKCFlbGVtZW50LnBhcmVudE5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb21wbGV0ZS10YXNrJykpIHtcbiAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2NvbXBsZXRlLXRhc2snKVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnQucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjb21wbGV0ZS10YXNrJyk7XG4gICAgfVxufVxuXG4vLyBUYWtlIGluIGZvbGRlciBuYW1lIGFuZCBjcmVhdGUgZm9sZGVyIHVzaW5nIGZ1bmN0aW9uXG4vLyBBcHBlbmQgdG8gc2lkZWJhclxuZnVuY3Rpb24gYXBwZW5kRm9sZGVyKGZvbGRlck5hbWUpIHtcbiAgICBsZXQgZm9sZGVyRE9NID0gY3JlYXRlRm9sZGVyQnV0dG9uKGZvbGRlck5hbWUpO1xuICAgIFxuICAgIGNvbnN0IHNpZGViYXJGb2xkZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNpZGViYXInKTtcbiAgICBzaWRlYmFyRm9sZGVycy5hcHBlbmRDaGlsZChmb2xkZXJET00pO1xufVxuXG4vLyBUYWtlIGluIHN1cGVyIGZvbGRlciBuYW1lIHRvIGxvb3AgdGhyb3VnaCBlYWNoIGZvbGRlciBhbmQgYXBwZW5kIHRvIHNpZGViYXJcbmZ1bmN0aW9uIGRpc3BsYXlGb2xkZXJzKHN1cGVyRm9sZGVyTmFtZSkge1xuICAgIC8vIGNsZWFyU2lkZWJhcigpO1xuICAgIHN1cGVyRm9sZGVyTmFtZS5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgYXBwZW5kRm9sZGVyKGZvbGRlcik7XG4gICAgfSk7XG59XG5cblxuZnVuY3Rpb24gZ2V0Rm9sZGVyRm9ybUluZm8oKSB7XG4gICAgY29uc3QgZm9sZGVyRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXItZm9ybScpO1xuXG4gICAgY29uc3QgZm9sZGVyVGl0bGVJbkZvcm0gPSBmb2xkZXJGb3JtLmVsZW1lbnRzWydmb2xkZXItdGl0bGUnXS52YWx1ZTtcblxuICAgIHJldHVybiB7Zm9sZGVyRm9ybSwgZm9sZGVyVGl0bGVJbkZvcm19O1xufVxuXG5mdW5jdGlvbiBjbGVhclRhc2tDb250YWluZXIoKSB7XG4gICAgY29uc3QgdGFza0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLWNvbnRhaW5lcicpO1xuXG4gICAgdGFza0NvbnRhaW5lci50ZXh0Q29udGVudCA9ICcnO1xufVxuXG5mdW5jdGlvbiBhcHBlbmREcm9wZG93bihzdXBlckZvbGRlcikge1xuXG4gICAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlci1zZWxlY3Rpb24nKTtcblxuICAgIGNsZWFyU2VsZWN0TWVudShzZWxlY3QpO1xuXG4gICAgc3VwZXJGb2xkZXIuZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgICAgICBcbiAgICAgICAgb3B0aW9uLnRleHRDb250ZW50ID0gZm9sZGVyLnRpdGxlO1xuICAgICAgICBvcHRpb24udmFsdWUgPSBmb2xkZXIubXlGb2xkZXJVdWlkOyAvLyBmaWd1cmUgb3V0IGlmIHRoaXMgaXMgZ29vZCB3YXkgdG8gc2VsZWN0XG4gICAgICAgIC8vIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2luZGV4JywgaW5kZXgrKyk7XG5cbiAgICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7XG4gICAgfSlcbn1cblxuZnVuY3Rpb24gY2xlYXJTZWxlY3RNZW51KHNlbGVjdE9wdGlvbikge1xuICAgIGZvciAobGV0IGkgPSBzZWxlY3RPcHRpb24ub3B0aW9ucy5sZW5ndGg7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIHNlbGVjdE9wdGlvbi5yZW1vdmUoMCk7XG4gICAgfVxufVxuXG5leHBvcnQge1xuICAgIGdldFRhc2tGb3JtSW5mbyxcbiAgICBnZXRUYXNrRWRpdEZvcm1JbmZvLFxuICAgIGdldEZvbGRlckZvcm1JbmZvLFxuICAgIGNyZWF0ZVRhc2tFbGVtZW50LFxuICAgIGNyZWF0ZUZvbGRlckJ1dHRvbixcbiAgICBhcHBlbmRGb2xkZXIsXG4gICAgZGlzcGxheUZvbGRlclRhc2tzLFxuICAgIGFwcGVuZFRhc2ssXG4gICAgZGlzcGxheUZvbGRlcnMsXG4gICAgY2xlYXJUYXNrQ29udGFpbmVyLFxuICAgIGFwcGVuZERyb3Bkb3duLFxuICAgIGNsZWFyU2VsZWN0TWVudSxcbn0iLCJpbXBvcnQge1xuICAgIFRhc2ssXG4gICAgRm9sZGVyLFxuICAgIFN1cGVyRm9sZGVyXG59IGZyb20gJy4vbW9kdWxlcy9mYWN0b3JpZXMuanMnO1xuXG5pbXBvcnQge1xuICAgIGdldFRhc2tGb3JtSW5mbyxcbiAgICBnZXRUYXNrRWRpdEZvcm1JbmZvLFxuICAgIGdldEZvbGRlckZvcm1JbmZvLFxuICAgIGFwcGVuZEZvbGRlcixcbiAgICBkaXNwbGF5Rm9sZGVyVGFza3MsXG4gICAgY2xlYXJUYXNrQ29udGFpbmVyLFxuICAgIGFwcGVuZERyb3Bkb3duLFxuICAgIGNyZWF0ZUZvbGRlckJ1dHRvbixcbiAgICBkaXNwbGF5Rm9sZGVyc1xuXG59IGZyb20gJy4vbW9kdWxlcy9kb20uanMnO1xuXG5pbXBvcnQgeyBmb3JtYXREaXN0YW5jZSwgc3ViRGF5cyB9IGZyb20gXCJkYXRlLWZuc1wiO1xuXG5sZXQgaW5kZXggPSAwO1xuXG4vL1N1cGVyIEZvbGRlciBcbmNvbnN0IHN1cGVyRm9sZGVyID0gU3VwZXJGb2xkZXIoKTtcblxuLy8gT3BlbiB0YXNrIG1vZGFsIHdoZW4gY2xpY2tlZFxuY29uc3Qgb3BlblRhc2tNb2RhbEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVuLXRhc2stbW9kYWwtYnRuJyk7XG5vcGVuVGFza01vZGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgZ2V0VGFza0RpYWxvZygpLnJlc2V0O1xuICAgIGdldFRhc2tEaWFsb2coKS5zaG93TW9kYWwoKTtcbiAgICBhcHBlbmREcm9wZG93bihzdXBlckZvbGRlcik7XG59KTtcblxuLy8gR2V0IHRhc2sgZGlhbG9nIGFuZCByZXR1cm4gXG5mdW5jdGlvbiBnZXRUYXNrRGlhbG9nKCkge1xuICAgIGNvbnN0IHRhc2tEaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1kaWFsb2cnKTtcblxuICAgIHJldHVybiB0YXNrRGlhbG9nO1xufVxuXG5mdW5jdGlvbiBnZXRFZGl0RGlhbG9nKCkge1xuICAgIGNvbnN0IGVkaXREaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdC1kaWFsb2cnKTtcblxuICAgIHJldHVybiBlZGl0RGlhbG9nO1xufVxuXG4vLyBPcGVuIGZvbGRlciBtb2RhbCB3aGVuIGNsaWNrZWRcbmNvbnN0IGFkZEZvbGRlckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXItYWRkLWJ0bicpO1xuYWRkRm9sZGVyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgXG4gICAgY29uc3QgZm9sZGVyRGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlci1kaWFsb2cnKTtcbiAgICBmb2xkZXJEaWFsb2cuc2hvd01vZGFsKCk7XG4gICAgXG59KTtcblxuLy8gRXZlbnQgbGlzdGVuZXIgdG8gc3VibWl0IGZvbGRlciBmb3JtXG4vLyBDcmVhdGUgYSBuZXcgZm9sZGVyIGluc3RhbmNlIHdpdGggaW5mbyBmcm9tIGZvcm1cbi8vIEFkZCB0byBET01cbi8vIEFkZCB0byBzdXBlciBmb2xkZXJcbi8vIFNob3VsZCBiZSBkb25lIG9uIHRoZSBmb3JtIGluc3RlYWQgb2YgYnV0dG9uIGJ1dCBNRE4gZXhhbXBsZSB3aXRoIGRpYWxvZyBkaWQgaXQgdGhpcyB3YXlcbmNvbnN0IGZvbGRlclN1Ym1pdEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXItY29uZmlybS1idG4nKTtcbmZvbGRlclN1Ym1pdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgXG4gICAgY29uc3QgZm9sZGVyRGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlci1kaWFsb2cnKTtcbiAgICBjb25zdCB7Zm9sZGVyVGl0bGVJbkZvcm19ID0gZ2V0Rm9sZGVyRm9ybUluZm8oKTtcblxuICAgIGxldCBuZXdGb2xkZXIgPSBGb2xkZXIoZm9sZGVyVGl0bGVJbkZvcm0pO1xuICAgIGFwcGVuZEZvbGRlcihuZXdGb2xkZXIpO1xuICAgIFxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGluZGV4KyssIEpTT04uc3RyaW5naWZ5KG5ld0ZvbGRlcikpO1xuICAgIGNvbnNvbGUubG9nKCdMZW5ndGggb2Ygc3RvcmFnZSB3aGVuIGZvbGRlciBpcyBjcmVhdGVkICcgKyBsb2NhbFN0b3JhZ2UubGVuZ3RoKTtcbiAgICBcbiAgICBzdXBlckZvbGRlci5hZGRGb2xkZXIobmV3Rm9sZGVyKTtcblxuICAgIGZvbGRlckRpYWxvZy5jbG9zZSgpO1xufSk7XG5cbi8vIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0ZXN0JywgJ3NvbWV0aGluZycpO1xuLy8gbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Rlc3QnLCAnc29tZXRoaW5nIGVsc2UnKTtcbi8vIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0ZXN0JywgJzNyZCB0aGluZycpO1xuLy8gY29uc29sZS5sb2coJ0xlbmd0aCBvZiBzdG9yYWdlIHdoZW4gZm9sZGVyIGlzIGNyZWF0ZWQgJyArIGxvY2FsU3RvcmFnZS5sZW5ndGgpO1xuXG4vLyBHbyB0aHJvdWdoIGFsbCBmb2xkZXJzIGFuZCBjaGVjayBpZiB0aGUgY2xpY2tlZCBidXR0b24gdmFsdWUgbWF0Y2hlcyBmb2xkZXIgdmFsdWVcbi8vIHRoZW4gZGlzcGxheSB0YXNrcyBvZiB0aGF0IGZvbGRlciB0byBzY3JlZW5cbmZ1bmN0aW9uIGRpc3BsYXlDdXJyZW50Rm9sZGVyV2l0aElkKHRlbXBJZCkge1xuXG4gICAgc3VwZXJGb2xkZXIuZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgICAgIGlmICh0ZW1wSWQgPT09IGZvbGRlci5teUZvbGRlclV1aWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGFza0NvbnRhaW5lcigpO1xuICAgICAgICAgICAgLy9kaXNwbGF5IGFsbCB0YXNrcyBvZiB0aGlzIGZvbGRlciB0byBwYWdlXG4gICAgICAgICAgICBkaXNwbGF5Rm9sZGVyVGFza3MoZm9sZGVyKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibWF0Y2ggZm91bmRcIik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuY29uc3QgdGFza0FkZEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLWFkZC1idG4nKTtcbi8vIENyZWF0ZSBuZXcgdGFzayBpbnN0YW5jZSB1c2luZyBpbmZvIGZyb20gZm9ybVxudGFza0FkZEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAvLyBHZXQgdmFsdWUgb2YgdGhlIHNlbGVjdGVkIGZpZWxkIChJZCBiZWNhdXNlIHZhbHVlIGlzIHNldCB0byBpZCBpbiBkb20uanMpXG4gICAgY29uc3Qgc2VsZWN0ZWRGb2xkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVyLXNlbGVjdGlvbicpO1xuICAgIGNvbnN0IHNlbGVjdGVkRm9sZGVyVmFsdWUgPSBzZWxlY3RlZEZvbGRlci52YWx1ZTtcbiAgICAvLyBHZXQgdmFsdWVzIG9mIHRoZSBmb3JtXG4gICAgY29uc3Qge3Rhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uLCB0YXNrRHVlRGF0ZSwgdGFza1ByaW9yaXR5fSA9IGdldFRhc2tGb3JtSW5mbygpO1xuXG4gICAgLy8gQ3JlYXRlIG5ldyB0YXNrIGFuZCBsb29wIHRocm91Z2ggZm9sZGVyIHRvIGZpbmQgbWF0Y2hpbmcgSWQgYW5kIGFkZFxuICAgIGNvbnN0IG5ld1Rhc2sgPSBUYXNrKHRhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uLCB0YXNrRHVlRGF0ZSwgdGFza1ByaW9yaXR5KTtcbiAgICBzdXBlckZvbGRlci5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgaWYgKHNlbGVjdGVkRm9sZGVyVmFsdWUgPT09IGZvbGRlci5teUZvbGRlclV1aWQpIHtcbiAgICAgICAgICAgIGZvbGRlci5hZGRUYXNrKG5ld1Rhc2spO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBVcGRhdGUgdGhlIHRhc2tzIG9mIHRoZSBmb2xkZXIgdGhhdCBpcyBjdXJyZW50bHkgYmVpbmcgZGlzcGxheWVkIHRvIGF2b2lkIHJlbG9hZGluZyBmb2xkZXJcbiAgICBkaXNwbGF5Q3VycmVudEZvbGRlcldpdGhJZChzZWxlY3RlZEZvbGRlclZhbHVlKTtcblxuICAgIC8vIENsZWFyIGZvcm0gZmllbGRzXG4gICAgY29uc3QgdGFza0Zvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1mb3JtJyk7XG4gICAgdGFza0Zvcm0ucmVzZXQoKTtcbiAgICBnZXRUYXNrRGlhbG9nKCkuY2xvc2UoKTtcbn0pXG5cbi8vIFNlbGVjdCB0aGUgYnV0dG9uIHdpdGggSWQgYW5kIGZpbmQgdGFzayB3aXRoIHRoYXQgSWRcbi8vIENoYW5nZSB0aGUgaW5mbyBvZiB0aGF0IHRhc2sgYW5kIHVwZGF0ZSBmb2xkZXJcbi8vIERlbGV0ZSBidXR0b24gYWZ0ZXIgYW5kIGNsb3NlXG5jb25zdCB0YXNrRWRpdENvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1lZGl0LWJ0bicpO1xudGFza0VkaXRDb25maXJtQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBcblxuICAgIGNvbnN0IGJ0bklkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmVkaXQtYnRuLWlkJyk7XG5cbiAgICBjb25zdCB7dGFza1RpdGxlLCB0YXNrRGVzY3JpcHRpb24sIHRhc2tEdWVEYXRlLCB0YXNrUHJpb3JpdHl9ID0gZ2V0VGFza0VkaXRGb3JtSW5mbygpO1xuXG4gICAgc3VwZXJGb2xkZXIuZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgICAgIGZvbGRlci50YXNrcy5mb3JFYWNoKHRhc2sgPT4ge1xuICAgICAgICAgICAgaWYgKGJ0bklkLnZhbHVlID09PSB0YXNrLm15VGFza1V1aWQpIHtcbiAgICAgICAgICAgICAgICB0YXNrLmVkaXRUYXNrKHRhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uLCB0YXNrRHVlRGF0ZSwgdGFza1ByaW9yaXR5KTtcbiAgICAgICAgICAgICAgICBkaXNwbGF5Q3VycmVudEZvbGRlcldpdGhJZChmb2xkZXIubXlGb2xkZXJVdWlkKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0YXNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9KTtcblxuICAgIGJ0bklkLnJlbW92ZSgpO1xuICAgIGdldEVkaXREaWFsb2coKS5jbG9zZSgpO1xuXG59KVxuXG5mdW5jdGlvbiBkZWxldGVGb2xkZXJXaXRoSWQoYnV0dG9uSWQpIHtcbiAgICBzdXBlckZvbGRlci5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgaWYgKGJ1dHRvbklkID09PSBmb2xkZXIubXlGb2xkZXJVdWlkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhidXR0b25JZCk7XG4gICAgICAgICAgICBzdXBlckZvbGRlci5kZWxldGVGb2xkZXIoZm9sZGVyKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBkZWxldGVUYXNrV2l0aElkKGJ1dHRvbklkKSB7XG4gICAgc3VwZXJGb2xkZXIuZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgICAgIGZvbGRlci50YXNrcy5mb3JFYWNoKHRhc2sgPT4ge1xuICAgICAgICAgICAgaWYgKGJ1dHRvbklkID09PSB0YXNrLm15VGFza1V1aWQpIHtcbiAgICAgICAgICAgICAgICBmb2xkZXIuZGVsZXRlVGFzayh0YXNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9KTtcbn1cblxuXG5mdW5jdGlvbiBjaGFuZ2VUYXNrU3RhdHVzKHRhc2tJZCkge1xuICAgIHN1cGVyRm9sZGVyLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBmb2xkZXIudGFza3MuZm9yRWFjaCh0YXNrID0+IHtcbiAgICAgICAgICAgIGlmICh0YXNrSWQgPT09IHRhc2subXlUYXNrVXVpZCkge1xuICAgICAgICAgICAgICAgIHRhc2suc2V0Q29tcGxldGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZmluZFRhc2tXaXRoSWQoYnV0dG9uSWQpIHtcbiAgICBsZXQgb3V0cHV0O1xuICAgIHN1cGVyRm9sZGVyLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBmb2xkZXIudGFza3MuZm9yRWFjaCh0YXNrID0+IHtcbiAgICAgICAgICAgIGlmIChidXR0b25JZCA9PT0gdGFzay5teVRhc2tVdWlkKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0ID0gdGFzaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9KTtcbiAgICByZXR1cm4gb3V0cHV0O1xufVxuLy8gVGVzdCB0YXNrc1xuY29uc3QgdGFzazEgPSBUYXNrKCdjaG9yZXMnLCAnd2FzaCBkaXNoZXMnLCAnbm92IDIzJywgJ2hpZ2gnKTtcbmNvbnN0IHRhc2syID0gVGFzaygnbW92aWVzJywgJ2F2YXRhcicsICdub3YgMjknLCAnbWVkJyk7XG5jb25zdCB0YXNrMyA9IFRhc2soJ2NvZGluZycsICd0b2RvIGxpc3QnLCAnZGVjIDEwJywgJ2xvdycpO1xuXG5sZXQgaW5ib3hGb2xkZXIgPSBGb2xkZXIoJ0luYm94Jyk7XG5pbmJveEZvbGRlci5hZGRUYXNrKHRhc2sxKTtcbnN1cGVyRm9sZGVyLmFkZEZvbGRlcihpbmJveEZvbGRlcik7XG5hcHBlbmRGb2xkZXIoaW5ib3hGb2xkZXIpO1xuXG5sZXQgdGVzdEZvbGRlcjIgPSBGb2xkZXIoJ3Rlc3QyJyk7XG50ZXN0Rm9sZGVyMi5hZGRUYXNrKHRhc2syKTtcbnRlc3RGb2xkZXIyLmFkZFRhc2sodGFzazEpO1xudGVzdEZvbGRlcjIuYWRkVGFzayh0YXNrMyk7XG50ZXN0Rm9sZGVyMi5kZWxldGVUYXNrKHRhc2syKTtcbnN1cGVyRm9sZGVyLmFkZEZvbGRlcih0ZXN0Rm9sZGVyMik7XG5hcHBlbmRGb2xkZXIodGVzdEZvbGRlcjIpO1xuXG5sZXQgZm9sZGVyU3RvcmFnZSA9IFtdO1xuXG5pZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oaW5kZXgpKSB7XG4gICAgY29uc29sZS5sb2coJ2EgZm9sZGVyIGV4aXN0cycpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbG9jYWxTdG9yYWdlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxldCBrZXkgPSAobG9jYWxTdG9yYWdlLmtleShpKSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCd0aGlzIGlzIHRoZSBrZXkgJyArIGtleSk7XG5cbiAgICAgICAgbGV0IGxzRm9sZGVyID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpKTtcbiAgICAgICAgY29uc29sZS5sb2cobHNGb2xkZXIpO1xuXG4gICAgICAgIGZvbGRlclN0b3JhZ2UucHVzaChsc0ZvbGRlcik7XG4gICAgfVxufSBlbHNlIHtcbiAgICBjb25zb2xlLmxvZygnbm8gZm9sZGVyJyk7XG4gICAgLy8gZm9sZGVyU3RvcmFnZSA9IFtdO1xufVxuXG5mb2xkZXJTdG9yYWdlLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAvLyBmb2xkZXJTdG9yYWdlLnB1c2goZm9sZGVyKTtcbiAgICBjcmVhdGVGb2xkZXJCdXR0b24oZm9sZGVyKTtcbiAgICBjb25zb2xlLmxvZyhmb2xkZXIpO1xufSk7XG5cbmNvbnNvbGUubG9nKGZvbGRlclN0b3JhZ2UpO1xuLy8gaWYgKCFKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdmb2xkZXJzJykpKSB7XG4vLyAgICAgY29uc29sZS5sb2coJ25vIGZvbGRlcicpO1xuLy8gfSBlbHNlIHtcbi8vICAgICBjb25zb2xlLmxvZygnYSBmb2xkZXIgZXhpc3RzJyk7XG4vLyAgICAgY29uc3QgbHNGb2xkZXIgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdmb2xkZXJzJykpO1xuXG4vLyAgICAgLy8gc3VwZXJGb2xkZXIuYWRkRm9sZGVyKGxzRm9sZGVyKTtcbi8vICAgICAvLyBzdXBlckZvbGRlci5mb3JFYWNoKGFkZEZvbGRlcihsc0ZvbGRlcikpO1xuLy8gICAgIHN1cGVyRm9sZGVyLmZvckVhY2goZm9sZGVyID0+IHtcbi8vICAgICAgICAgc3VwZXJGb2xkZXIuYWRkRm9sZGVyKGxzRm9sZGVyKTtcbi8vICAgICB9KVxuLy8gICAgIGNyZWF0ZUZvbGRlckJ1dHRvbihsc0ZvbGRlcik7XG4vLyAgICAgLy8gbG9hZExTRm9sZGVycygpO1xuLy8gfVxuXG5cbi8vIGZ1bmN0aW9uIGxvYWRMU0ZvbGRlcnMoKSB7XG4vLyAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsb2NhbFN0b3JhZ2UubGVuZ3RoOyBpKyspIHtcbi8vICAgICAgICAgLy8gY29uc3QgbHNGb2xkZXIgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGxvY2FsU3RvcmFnZS5rZXkoaSkpKTtcbi8vICAgICAgICAgbGV0IGtleSA9IChsb2NhbFN0b3JhZ2Uua2V5KGkpKTtcbi8vICAgICAgICAgbGV0IHggPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkpO1xuXG4vLyAgICAgICAgIHN1cGVyRm9sZGVyLmFkZEZvbGRlcih4KTtcbi8vICAgICAgICAgYXBwZW5kRm9sZGVyKHgpO1xuLy8gICAgIH1cbi8vIH1cblxuLy8gbG9hZExTRm9sZGVycygpO1xuXG5cblxuXG4vLyBPbiBwYWdlIGxvYWQsIGNoZWNrIGZvciBzdG9yYWdlXG4vLyBJZiBzdG9yYWdlIGNvbnRhaW5zIHByb2plY3RzLCBnZXQgcHJvamVjdHMgZnJvbSBzdG9yYWdlXG4vLyBQdXQgc2FpZCBwcm9qZWN0cyBpbnRvIHByb2plY3RzIGFycmF5XG4vLyBEaXNwbGF5IHByb2plY3RzIGFycmF5IHRvIERPTSAoZnVuY3Rpb25hbGl0eSB5b3UgYWxyZWFkeSBoYXZlKVxuXG4vLyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndGVzdEZvbGRlckluU3RvcmFnZScsIEpTT04uc3RyaW5naWZ5KHRlc3RGb2xkZXIyKSlcbi8vIGNvbnNvbGUubG9nKEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Rlc3RGb2xkZXJJblN0b3JhZ2UnKSkpO1xuXG5cbi8vIHBvcHVsYXRlU3RvcmFnZSgpOyBcblxuLy8gZnVuY3Rpb24gc3RvcmFnZUF2YWlsYWJsZSh0eXBlKSB7XG4vLyAgICAgbGV0IHN0b3JhZ2U7XG4vLyAgICAgdHJ5IHtcbi8vICAgICAgIHN0b3JhZ2UgPSB3aW5kb3dbdHlwZV07XG4vLyAgICAgICBjb25zdCB4ID0gXCJfX3N0b3JhZ2VfdGVzdF9fXCI7XG4vLyAgICAgICBzdG9yYWdlLnNldEl0ZW0oeCwgeCk7XG4vLyAgICAgICBzdG9yYWdlLnJlbW92ZUl0ZW0oeCk7XG4vLyAgICAgICByZXR1cm4gdHJ1ZTtcbi8vICAgICB9IGNhdGNoIChlKSB7XG4vLyAgICAgICByZXR1cm4gKFxuLy8gICAgICAgICBlIGluc3RhbmNlb2YgRE9NRXhjZXB0aW9uICYmXG4vLyAgICAgICAgIC8vIGV2ZXJ5dGhpbmcgZXhjZXB0IEZpcmVmb3hcbi8vICAgICAgICAgKGUuY29kZSA9PT0gMjIgfHxcbi8vICAgICAgICAgICAvLyBGaXJlZm94XG4vLyAgICAgICAgICAgZS5jb2RlID09PSAxMDE0IHx8XG4vLyAgICAgICAgICAgLy8gdGVzdCBuYW1lIGZpZWxkIHRvbywgYmVjYXVzZSBjb2RlIG1pZ2h0IG5vdCBiZSBwcmVzZW50XG4vLyAgICAgICAgICAgLy8gZXZlcnl0aGluZyBleGNlcHQgRmlyZWZveFxuLy8gICAgICAgICAgIGUubmFtZSA9PT0gXCJRdW90YUV4Y2VlZGVkRXJyb3JcIiB8fFxuLy8gICAgICAgICAgIC8vIEZpcmVmb3hcbi8vICAgICAgICAgICBlLm5hbWUgPT09IFwiTlNfRVJST1JfRE9NX1FVT1RBX1JFQUNIRURcIikgJiZcbi8vICAgICAgICAgLy8gYWNrbm93bGVkZ2UgUXVvdGFFeGNlZWRlZEVycm9yIG9ubHkgaWYgdGhlcmUncyBzb21ldGhpbmcgYWxyZWFkeSBzdG9yZWRcbi8vICAgICAgICAgc3RvcmFnZSAmJlxuLy8gICAgICAgICBzdG9yYWdlLmxlbmd0aCAhPT0gMFxuLy8gICAgICAgKTtcbi8vICAgICB9XG4vLyAgIH1cblxuLy8gaWYgKHN0b3JhZ2VBdmFpbGFibGUoXCJsb2NhbFN0b3JhZ2VcIikpIHtcbi8vIC8vIFlpcHBlZSEgV2UgY2FuIHVzZSBsb2NhbFN0b3JhZ2UgYXdlc29tZW5lc3Ncbi8vIGNvbnNvbGUubG9nKCd5YXknKTtcbi8vIH0gZWxzZSB7XG4vLyAvLyBUb28gYmFkLCBubyBsb2NhbFN0b3JhZ2UgZm9yIHVzXG4vLyBjb25zb2xlLmxvZygnbWFoJyk7XG4vLyB9XG5leHBvcnQge1xuICAgIGRpc3BsYXlDdXJyZW50Rm9sZGVyV2l0aElkLFxuICAgIGRlbGV0ZUZvbGRlcldpdGhJZCxcbiAgICBkZWxldGVUYXNrV2l0aElkLFxuICAgIGNoYW5nZVRhc2tTdGF0dXMsXG4gICAgZ2V0VGFza0RpYWxvZyxcbiAgICBmaW5kVGFza1dpdGhJZCxcbiAgICBnZXRFZGl0RGlhbG9nXG59Il0sIm5hbWVzIjpbIl9fd2VicGFja19yZXF1aXJlX18iLCJleHBvcnRzIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwicmFuZG9tVVVJRCIsImNyeXB0byIsImJpbmQiLCJnZXRSYW5kb21WYWx1ZXMiLCJybmRzOCIsIlVpbnQ4QXJyYXkiLCJybmciLCJFcnJvciIsImJ5dGVUb0hleCIsImkiLCJwdXNoIiwidG9TdHJpbmciLCJzbGljZSIsIm9wdGlvbnMiLCJidWYiLCJvZmZzZXQiLCJybmRzIiwicmFuZG9tIiwiYXJyIiwidW5zYWZlU3RyaW5naWZ5IiwiVGFzayIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJkdWVEYXRlIiwicHJpb3JpdHkiLCJteVRhc2tVdWlkIiwiY29tcGxldGVTdGF0ZSIsImdldENvbXBsZXRlU3RhdGUiLCJjaGFuZ2VQcmlvcml0eSIsIm5ld1ByaW9yaXR5Iiwic2V0Q29tcGxldGUiLCJlZGl0VGFzayIsIm5ld1RpdGxlIiwibmV3RGVzY3JpcHRpb24iLCJuZXdEdWVEYXRlIiwicHJpbnRUYXNrIiwiY29uc29sZSIsImxvZyIsIkZvbGRlciIsIm15Rm9sZGVyVXVpZCIsInRhc2tzIiwiYWRkVGFzayIsIm5ld1Rhc2tOYW1lIiwiZGlzcGxheVRhc2tzIiwibGVuZ3RoIiwiZGVsZXRlVGFzayIsInRhc2tOYW1lIiwic3BsaWNlIiwiZGlzcGxheUZvbGRlclRhc2tzIiwiZm9sZGVyTmFtZSIsImZvckVhY2giLCJ0YXNrIiwibG9jYXRpb24iLCJ0YXNrRE9NIiwidGFza0RpdiIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInRhc2tUaXRsZUluRGl2IiwidGFza0Rlc2NyaXB0aW9uSW5EaXYiLCJ0YXNrRHVlRGF0ZUluRGl2IiwidGFza1ByaW9yaXR5SW5EaXYiLCJjbGFzc0xpc3QiLCJhZGQiLCJ0ZXh0Q29udGVudCIsImFwcGVuZENoaWxkIiwidGFza0RlbGV0ZUJ0biIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwidGhpc0J1dHRvbiIsInRhcmdldCIsImRlbGV0ZVRhc2tXaXRoSWQiLCJ2YWx1ZSIsInBhcmVudE5vZGUiLCJyZW1vdmUiLCJjcmVhdGVUYXNrRGVsZXRlQnV0dG9uIiwidGFza0VkaXRCdG4iLCJlZGl0Rm9ybSIsImdldEVsZW1lbnRCeUlkIiwiYnRuRm9ySWQiLCJmb3JtIiwidGFza1RpdGxlSW5Gb3JtIiwiZWxlbWVudHMiLCJ0YXNrRGVzY3JpcHRpb25JbkZvcm0iLCJ0YXNrRHVlRGF0ZUluRm9ybSIsInRhc2tQcmlvcml0eUluRm9ybSIsImNoYW5nZVRhc2tGb3JtRmllbGRzIiwiZmluZFRhc2tXaXRoSWQiLCJnZXRFZGl0RGlhbG9nIiwic2hvd01vZGFsIiwiY3JlYXRlVGFza0VkaXRCdXR0b24iLCJ0YXNrU3RhdHVzQnRuIiwiZWxlbWVudCIsImNoYW5nZVRhc2tTdGF0dXMiLCJjb250YWlucyIsImNyZWF0ZVRhc2tTdGF0dXNCdXR0b24iLCJjcmVhdGVUYXNrRWxlbWVudCIsImFwcGVuZFRhc2siLCJjcmVhdGVGb2xkZXJCdXR0b24iLCJzaWRlYmFyIiwicXVlcnlTZWxlY3RvciIsImZvbGRlckRpdiIsImZvbGRlckJ0biIsImZvbGRlciIsImZvbGRlckRlbGV0ZUJ0biIsImRlbGV0ZUZvbGRlcldpdGhJZCIsImNyZWF0ZUZvbGRlckRlbGV0ZUJ1dHRvbiIsImN1cnJlbnRGb2xkZXJJZCIsImRpc3BsYXlDdXJyZW50Rm9sZGVyV2l0aElkIiwiYXBwZW5kRm9sZGVyIiwiZm9sZGVyRE9NIiwiaW5kZXgiLCJzdXBlckZvbGRlciIsImZvbGRlcnMiLCJhZGRGb2xkZXIiLCJuZXdGb2xkZXJOYW1lIiwiZGVsZXRlRm9sZGVyIiwiU3VwZXJGb2xkZXIiLCJnZXRUYXNrRGlhbG9nIiwidGVtcElkIiwiYnV0dG9uSWQiLCJ0YXNrSWQiLCJvdXRwdXQiLCJyZXNldCIsInNlbGVjdCIsInNlbGVjdE9wdGlvbiIsImNsZWFyU2VsZWN0TWVudSIsIm9wdGlvbiIsImFwcGVuZERyb3Bkb3duIiwicHJldmVudERlZmF1bHQiLCJmb2xkZXJEaWFsb2ciLCJmb2xkZXJUaXRsZUluRm9ybSIsImZvbGRlckZvcm0iLCJnZXRGb2xkZXJGb3JtSW5mbyIsIm5ld0ZvbGRlciIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwiY2xvc2UiLCJzZWxlY3RlZEZvbGRlclZhbHVlIiwidGFza1RpdGxlIiwidGFza0Rlc2NyaXB0aW9uIiwidGFza0R1ZURhdGUiLCJ0YXNrUHJpb3JpdHkiLCJnZXRUYXNrRm9ybUluZm8iLCJuZXdUYXNrIiwiYnRuSWQiLCJnZXRUYXNrRWRpdEZvcm1JbmZvIiwidGFzazEiLCJ0YXNrMiIsInRhc2szIiwiaW5ib3hGb2xkZXIiLCJ0ZXN0Rm9sZGVyMiIsImZvbGRlclN0b3JhZ2UiLCJnZXRJdGVtIiwibHNGb2xkZXIiLCJwYXJzZSJdLCJzb3VyY2VSb290IjoiIn0=