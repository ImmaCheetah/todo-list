(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{kj:()=>S,F5:()=>F,k3:()=>C,HA:()=>T,QP:()=>b,mo:()=>p});const t={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let n;const o=new Uint8Array(16);function d(){if(!n&&(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(o)}const r=[];for(let e=0;e<256;++e)r.push((e+256).toString(16).slice(1));const l=function(e,n,o){if(t.randomUUID&&!n&&!e)return t.randomUUID();const l=(e=e||{}).random||(e.rng||d)();if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,n){o=o||0;for(let e=0;e<16;++e)n[o+e]=l[e];return n}return function(e,t=0){return r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]}(l)};function a(e,t,n,o,d=l()){let r=!1;const a=()=>r;e=e.toString(),t=t.toString();const s=e=>{o=e};return{get title(){return e},get description(){return t},get dueDate(){return n},get priority(){return o},getCompleteState:a,setComplete:()=>{r=0==a()},changePriority:s,editTask:(o,d,r,l)=>{e=o,t=d,n=r,s(l)},printTask:()=>{console.log(`Task title - ${e}, Desc - ${t}, Date - ${n}, Priority - ${o}`)},myTaskUuid:d}}function s(e,t=l()){let n=[];return{title:e,tasks:n,myFolderUuid:t,addTask:e=>{n.push(e)},displayTasks:()=>{for(let e=0;e<n.length;e++)console.log(`Task ${e} - ${n[e].title}, ${n[e].dueDate}, ${n[e].priority}`)},deleteTask:e=>{for(let t=n.length-1;t>=0;--t)n[t].myTaskUuid===e.myTaskUuid&&n.splice(t,1)}}}function i(e=l()){let t=[];return{folders:t,addFolder:e=>{t.push(e)},deleteFolder:e=>{for(let n=t.length-1;n>=0;--n)t[n].myFolderUuid===e.myFolderUuid&&t.splice(n,1);localStorage.removeItem(e.myFolderUuid)},mySuperFolderUuid:e}}function c(e){e.tasks.forEach((e=>{!function(e,t){let n=function(e){const t=document.createElement("div"),n=document.createElement("p"),o=document.createElement("p"),d=document.createElement("p"),r=document.createElement("p");return t.classList.add("task-div"),n.textContent=e.title,o.textContent=e.description,d.textContent=e.dueDate,r.textContent=e.priority,t.appendChild(n),t.appendChild(o),t.appendChild(d),t.appendChild(r),(function(e){const t=document.createElement("button");return t.classList.add("task-delete-btn"),t.textContent="-",e.appendChild(t),t.addEventListener("click",(function(e){let t=e.target;C(t.value),t.parentNode.remove()})),t}(t)).value=e.myTaskUuid,(function(e){const t=document.createElement("button");return t.classList.add("task-edit-btn"),t.textContent="+",e.appendChild(t),t.addEventListener("click",(function(e){const t=document.getElementById("edit-form"),n=document.createElement("button");n.classList.add("edit-btn-id"),n.value=e.target.value,t.appendChild(n),function(e){const t=document.getElementById("edit-form"),n=t.elements["task-title"],o=t.elements["task-description"],d=t.elements["task-due-date"],r=t.elements["task-priority"];n.value=e.title,o.value=e.description,d.value=e.dueDate,r.value=e.priority}(b(e.target.value)),p().showModal()})),t}(t)).value=e.myTaskUuid,(function(e){const t=document.createElement("button");return t.classList.add("task-status-btn"),t.textContent="âœ”",e.appendChild(t),t.addEventListener("click",(function(e){let t=e.target;var n;S(t.value),(n=t).parentNode.classList.contains("complete-task")?n.parentNode.classList.remove("complete-task"):n.parentNode.classList.add("complete-task")})),t}(t)).value=e.myTaskUuid,t}(e);document.getElementById(["task-container"]).appendChild(n)}(e)}))}function u(e){let t=function(e){const t=document.querySelector(".sidebar"),n=document.createElement("div"),o=document.createElement("button");return n.classList.add("folder-div"),o.classList.add("folder-button"),o.textContent=e.title,o.value=e.myFolderUuid,n.appendChild(o),(function(e){const t=document.createElement("button");return t.classList.add("folder-delete-btn"),t.textContent="-",e.appendChild(t),t.addEventListener("click",(function(e){let t=e.target;F(t.value),t.parentNode.remove()})),t}(n)).value=e.myFolderUuid,t.appendChild(n),o.addEventListener("click",(function(){let t=e.myFolderUuid;return T(e.myFolderUuid),console.log(e.title,e.myFolderUuid),t})),n}(e);document.querySelector(".sidebar").appendChild(t)}const m=i();function f(){return document.getElementById("task-dialog")}function p(){return document.getElementById("edit-dialog")}document.getElementById("open-task-modal-btn").addEventListener("click",(function(){f().reset,f().showModal(),function(e){const t=document.getElementById("folder-selection");!function(e){for(let t=e.options.length;t>=0;t--)e.remove(0)}(t),e.folders.forEach((e=>{const n=document.createElement("option");n.textContent=e.title,n.value=e.myFolderUuid,t.appendChild(n)}))}(JSON.parse(localStorage.getItem("folders")))})),document.getElementById("folder-add-btn").addEventListener("click",(function(){document.getElementById("folder-dialog").showModal()})),document.getElementById("folder-confirm-btn").addEventListener("click",(function(e){e.preventDefault();const t=document.getElementById("folder-dialog"),{folderTitleInForm:n}=function(){const e=document.getElementById("folder-form");return{folderForm:e,folderTitleInForm:e.elements["folder-title"].value}}();let o=s(n);u(o),m.addFolder(o),h(JSON.parse(localStorage.getItem("folders"))),t.close()})),document.getElementById("task-add-btn").addEventListener("click",(function(e){e.preventDefault();const t=document.getElementById("folder-selection").value,{taskTitle:n,taskDescription:o,taskDueDate:d,taskPriority:r}=function(){const e=document.getElementById("main-form"),t=e.elements["task-title"],n=e.elements["task-description"],o=e.elements["task-due-date"],d=e.elements["task-priority"];return{taskTitle:t.value,taskDescription:n.value,taskDueDate:o.value,taskPriority:d.value}}(),l=a(n,o,d,r);m.folders.forEach((e=>{t===e.myFolderUuid&&e.addTask(l)})),h(JSON.parse(localStorage.getItem("folders"))),T(t),document.getElementById("main-form").reset(),f().close()})),document.getElementById("task-edit-btn").addEventListener("click",(function(e){e.preventDefault();const t=document.querySelector(".edit-btn-id"),{taskTitle:n,taskDescription:o,taskDueDate:d,taskPriority:r}=function(){const e=document.getElementById("edit-form"),t=e.elements["task-title"],n=e.elements["task-description"],o=e.elements["task-due-date"],d=e.elements["task-priority"];return{taskTitle:t.value,taskDescription:n.value,taskDueDate:o.value,taskPriority:d.value}}();m.folders.forEach((e=>{e.tasks.forEach((l=>{t.value===l.myTaskUuid&&(l.editTask(n,o,d,r),T(e.myFolderUuid),console.log(l))}))})),t.remove(),p().close()}));const k=a("chores","wash dishes","nov 23","high"),y=a("movies","avatar","nov 29","med"),g=a("coding","todo list","dec 10","low");let E=s("Inbox");E.addTask(k),m.addFolder(E),u(E);let v=s("test2");function h(e){const{mySuperFolderUuid:t}=e;let n=i(t);return e.folders.forEach((e=>{n.addFolder(function(e){const{title:t,myFolderUuid:n}=e;let o=s(t,n);return e.tasks.forEach((e=>{o.addTask(function(e){const{title:t,description:n,dueDate:o,priority:d,myTaskUuid:r}=e;return a(t,n,o,d,r)}(e))})),o}(e))})),n}v.addTask(y),v.addTask(k),v.addTask(g),v.deleteTask(y),m.addFolder(v),u(v),function(){if(localStorage.getItem("folders")){let e=JSON.parse(localStorage.getItem("folders"));h(e),h(e).folders.forEach((e=>{u(e)}))}else localStorage.setItem("folders",JSON.stringify(m))}();let U=i();U.addFolder(v),U.addFolder(E),localStorage.setItem("lsSuperFolder",JSON.stringify(U));let I=h(JSON.parse(localStorage.getItem("lsSuperFolder")));function T(e){m.folders.forEach((t=>{e===t.myFolderUuid&&(document.getElementById("task-container").textContent="",c(t),console.log("match found"))}))}function F(e){m.folders.forEach((t=>{e===t.myFolderUuid&&(console.log(e),m.deleteFolder(t))}))}function C(e){m.folders.forEach((t=>{t.tasks.forEach((n=>{e===n.myTaskUuid&&t.deleteTask(n)}))}))}function S(e){m.folders.forEach((t=>{t.tasks.forEach((t=>{e===t.myTaskUuid&&t.setComplete()}))}))}function b(e){let t;return m.folders.forEach((n=>{n.tasks.forEach((n=>{e===n.myTaskUuid&&(t=n)}))})),t}console.log(I)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEdBRVQsQ0FFQSxTQUFTZ0UsRUFBZXNFLEdBQ3BCLElBQUlFLEVBUUosT0FQQWhELEVBQVlwRSxRQUFRUSxTQUFRcUQsSUFDeEJBLEVBQU92RSxNQUFNa0IsU0FBUUMsSUFDYnlHLElBQWF6RyxFQUFLbEMsYUFDbEI2SSxFQUFTM0csRUFDYixHQUNILElBRUUyRyxDQUNYLENBeERBbEksUUFBUUMsSUFBSTZILEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2RvLWxpc3Qvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vdG9kby1saXN0L3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly90b2RvLWxpc3Qvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL25hdGl2ZS5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3JuZy5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3N0cmluZ2lmeS5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3Y0LmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9tb2R1bGVzL2ZhY3Rvcmllcy5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvbW9kdWxlcy9kb20uanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiY29uc3QgcmFuZG9tVVVJRCA9IHR5cGVvZiBjcnlwdG8gIT09ICd1bmRlZmluZWQnICYmIGNyeXB0by5yYW5kb21VVUlEICYmIGNyeXB0by5yYW5kb21VVUlELmJpbmQoY3J5cHRvKTtcbmV4cG9ydCBkZWZhdWx0IHtcbiAgcmFuZG9tVVVJRFxufTsiLCIvLyBVbmlxdWUgSUQgY3JlYXRpb24gcmVxdWlyZXMgYSBoaWdoIHF1YWxpdHkgcmFuZG9tICMgZ2VuZXJhdG9yLiBJbiB0aGUgYnJvd3NlciB3ZSB0aGVyZWZvcmVcbi8vIHJlcXVpcmUgdGhlIGNyeXB0byBBUEkgYW5kIGRvIG5vdCBzdXBwb3J0IGJ1aWx0LWluIGZhbGxiYWNrIHRvIGxvd2VyIHF1YWxpdHkgcmFuZG9tIG51bWJlclxuLy8gZ2VuZXJhdG9ycyAobGlrZSBNYXRoLnJhbmRvbSgpKS5cbmxldCBnZXRSYW5kb21WYWx1ZXM7XG5jb25zdCBybmRzOCA9IG5ldyBVaW50OEFycmF5KDE2KTtcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJuZygpIHtcbiAgLy8gbGF6eSBsb2FkIHNvIHRoYXQgZW52aXJvbm1lbnRzIHRoYXQgbmVlZCB0byBwb2x5ZmlsbCBoYXZlIGEgY2hhbmNlIHRvIGRvIHNvXG4gIGlmICghZ2V0UmFuZG9tVmFsdWVzKSB7XG4gICAgLy8gZ2V0UmFuZG9tVmFsdWVzIG5lZWRzIHRvIGJlIGludm9rZWQgaW4gYSBjb250ZXh0IHdoZXJlIFwidGhpc1wiIGlzIGEgQ3J5cHRvIGltcGxlbWVudGF0aW9uLlxuICAgIGdldFJhbmRvbVZhbHVlcyA9IHR5cGVvZiBjcnlwdG8gIT09ICd1bmRlZmluZWQnICYmIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMgJiYgY3J5cHRvLmdldFJhbmRvbVZhbHVlcy5iaW5kKGNyeXB0byk7XG5cbiAgICBpZiAoIWdldFJhbmRvbVZhbHVlcykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKCkgbm90IHN1cHBvcnRlZC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS91dWlkanMvdXVpZCNnZXRyYW5kb212YWx1ZXMtbm90LXN1cHBvcnRlZCcpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBnZXRSYW5kb21WYWx1ZXMocm5kczgpO1xufSIsImltcG9ydCB2YWxpZGF0ZSBmcm9tICcuL3ZhbGlkYXRlLmpzJztcbi8qKlxuICogQ29udmVydCBhcnJheSBvZiAxNiBieXRlIHZhbHVlcyB0byBVVUlEIHN0cmluZyBmb3JtYXQgb2YgdGhlIGZvcm06XG4gKiBYWFhYWFhYWC1YWFhYLVhYWFgtWFhYWC1YWFhYWFhYWFhYWFhcbiAqL1xuXG5jb25zdCBieXRlVG9IZXggPSBbXTtcblxuZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7ICsraSkge1xuICBieXRlVG9IZXgucHVzaCgoaSArIDB4MTAwKS50b1N0cmluZygxNikuc2xpY2UoMSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdW5zYWZlU3RyaW5naWZ5KGFyciwgb2Zmc2V0ID0gMCkge1xuICAvLyBOb3RlOiBCZSBjYXJlZnVsIGVkaXRpbmcgdGhpcyBjb2RlISAgSXQncyBiZWVuIHR1bmVkIGZvciBwZXJmb3JtYW5jZVxuICAvLyBhbmQgd29ya3MgaW4gd2F5cyB5b3UgbWF5IG5vdCBleHBlY3QuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdXVpZGpzL3V1aWQvcHVsbC80MzRcbiAgcmV0dXJuIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDJdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgM11dICsgJy0nICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA0XV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDVdXSArICctJyArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgNl1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA3XV0gKyAnLScgKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDhdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgOV1dICsgJy0nICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMV1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMl1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxM11dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxNF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxNV1dO1xufVxuXG5mdW5jdGlvbiBzdHJpbmdpZnkoYXJyLCBvZmZzZXQgPSAwKSB7XG4gIGNvbnN0IHV1aWQgPSB1bnNhZmVTdHJpbmdpZnkoYXJyLCBvZmZzZXQpOyAvLyBDb25zaXN0ZW5jeSBjaGVjayBmb3IgdmFsaWQgVVVJRC4gIElmIHRoaXMgdGhyb3dzLCBpdCdzIGxpa2VseSBkdWUgdG8gb25lXG4gIC8vIG9mIHRoZSBmb2xsb3dpbmc6XG4gIC8vIC0gT25lIG9yIG1vcmUgaW5wdXQgYXJyYXkgdmFsdWVzIGRvbid0IG1hcCB0byBhIGhleCBvY3RldCAobGVhZGluZyB0b1xuICAvLyBcInVuZGVmaW5lZFwiIGluIHRoZSB1dWlkKVxuICAvLyAtIEludmFsaWQgaW5wdXQgdmFsdWVzIGZvciB0aGUgUkZDIGB2ZXJzaW9uYCBvciBgdmFyaWFudGAgZmllbGRzXG5cbiAgaWYgKCF2YWxpZGF0ZSh1dWlkKSkge1xuICAgIHRocm93IFR5cGVFcnJvcignU3RyaW5naWZpZWQgVVVJRCBpcyBpbnZhbGlkJyk7XG4gIH1cblxuICByZXR1cm4gdXVpZDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgc3RyaW5naWZ5OyIsImltcG9ydCBuYXRpdmUgZnJvbSAnLi9uYXRpdmUuanMnO1xuaW1wb3J0IHJuZyBmcm9tICcuL3JuZy5qcyc7XG5pbXBvcnQgeyB1bnNhZmVTdHJpbmdpZnkgfSBmcm9tICcuL3N0cmluZ2lmeS5qcyc7XG5cbmZ1bmN0aW9uIHY0KG9wdGlvbnMsIGJ1Ziwgb2Zmc2V0KSB7XG4gIGlmIChuYXRpdmUucmFuZG9tVVVJRCAmJiAhYnVmICYmICFvcHRpb25zKSB7XG4gICAgcmV0dXJuIG5hdGl2ZS5yYW5kb21VVUlEKCk7XG4gIH1cblxuICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgY29uc3Qgcm5kcyA9IG9wdGlvbnMucmFuZG9tIHx8IChvcHRpb25zLnJuZyB8fCBybmcpKCk7IC8vIFBlciA0LjQsIHNldCBiaXRzIGZvciB2ZXJzaW9uIGFuZCBgY2xvY2tfc2VxX2hpX2FuZF9yZXNlcnZlZGBcblxuICBybmRzWzZdID0gcm5kc1s2XSAmIDB4MGYgfCAweDQwO1xuICBybmRzWzhdID0gcm5kc1s4XSAmIDB4M2YgfCAweDgwOyAvLyBDb3B5IGJ5dGVzIHRvIGJ1ZmZlciwgaWYgcHJvdmlkZWRcblxuICBpZiAoYnVmKSB7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IDA7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyArK2kpIHtcbiAgICAgIGJ1ZltvZmZzZXQgKyBpXSA9IHJuZHNbaV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGJ1ZjtcbiAgfVxuXG4gIHJldHVybiB1bnNhZmVTdHJpbmdpZnkocm5kcyk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHY0OyIsImltcG9ydCB7djQgYXMgdXVpZHY0fSBmcm9tICd1dWlkJztcblxuZXhwb3J0IGZ1bmN0aW9uIFRhc2sodGl0bGUsIGRlc2NyaXB0aW9uLCBkdWVEYXRlLCBwcmlvcml0eSwgbXlUYXNrVXVpZCA9IHV1aWR2NCgpKSB7XG5cbiAgICAvLyBsZXQgbXlUYXNrVXVpZCA9IHV1aWR2NCgpO1xuXG4gICAgbGV0IGNvbXBsZXRlU3RhdGUgPSBmYWxzZTtcblxuICAgIGNvbnN0IGdldENvbXBsZXRlU3RhdGUgPSAoKSA9PiBjb21wbGV0ZVN0YXRlO1xuXG4gICAgY29uc3Qgc2V0Q29tcGxldGUgPSAoKSA9PiB7XG4gICAgICAgIGlmIChnZXRDb21wbGV0ZVN0YXRlKCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGNvbXBsZXRlU3RhdGUgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29tcGxldGVTdGF0ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cbiAgICB0aXRsZSA9IHRpdGxlLnRvU3RyaW5nKCk7XG4gICAgZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbi50b1N0cmluZygpO1xuXG4gICAgY29uc3QgY2hhbmdlUHJpb3JpdHkgPSAobmV3UHJpb3JpdHkpID0+IHtcbiAgICAgICAgcHJpb3JpdHkgPSBuZXdQcmlvcml0eTtcbiAgICB9XG5cbiAgICBjb25zdCBlZGl0VGFzayA9IChuZXdUaXRsZSwgbmV3RGVzY3JpcHRpb24sIG5ld0R1ZURhdGUsIG5ld1ByaW9yaXR5KSA9PiB7XG4gICAgICAgIHRpdGxlID0gbmV3VGl0bGU7XG4gICAgICAgIGRlc2NyaXB0aW9uID0gbmV3RGVzY3JpcHRpb247XG4gICAgICAgIGR1ZURhdGUgPSBuZXdEdWVEYXRlO1xuICAgICAgICBjaGFuZ2VQcmlvcml0eShuZXdQcmlvcml0eSk7XG4gICAgfVxuXG4gICAgY29uc3QgcHJpbnRUYXNrID0gKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhgVGFzayB0aXRsZSAtICR7dGl0bGV9LCBEZXNjIC0gJHtkZXNjcmlwdGlvbn0sIERhdGUgLSAke2R1ZURhdGV9LCBQcmlvcml0eSAtICR7cHJpb3JpdHl9YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0IHRpdGxlKCkge3JldHVybiB0aXRsZX0sIFxuICAgICAgICBnZXQgZGVzY3JpcHRpb24oKSB7cmV0dXJuIGRlc2NyaXB0aW9ufSwgXG4gICAgICAgIGdldCBkdWVEYXRlKCkge3JldHVybiBkdWVEYXRlfSwgXG4gICAgICAgIGdldCBwcmlvcml0eSgpIHtyZXR1cm4gcHJpb3JpdHl9LFxuICAgICAgICBnZXRDb21wbGV0ZVN0YXRlLFxuICAgICAgICBzZXRDb21wbGV0ZSwgXG4gICAgICAgIGNoYW5nZVByaW9yaXR5LFxuICAgICAgICBlZGl0VGFzayxcbiAgICAgICAgcHJpbnRUYXNrLFxuICAgICAgICBteVRhc2tVdWlkXG4gICAgfTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBGb2xkZXIodGl0bGUsIG15Rm9sZGVyVXVpZD11dWlkdjQoKSkge1xuICAgIFxuXG4gICAgLy8gbGV0IG15Rm9sZGVyVXVpZCA9IHV1aWR2NCgpO1xuICAgIGxldCB0YXNrcyA9IFtdO1xuXG4gICAgY29uc3QgYWRkVGFzayA9IChuZXdUYXNrTmFtZSkgPT4ge1xuICAgICAgICB0YXNrcy5wdXNoKG5ld1Rhc2tOYW1lKTtcblxuXG4gICAgICAgIC8vIGxvY2FsU3RvcmFnZS5zZXRJdGVtKG5ld1Rhc2tOYW1lLm15VGFza1V1aWQsIEpTT04uc3RyaW5naWZ5KG5ld1Rhc2tOYW1lKSk7XG4gICAgfVxuXG4gICAgY29uc3QgZGlzcGxheVRhc2tzID0gKCkgPT4ge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhc2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgVGFzayAke2l9IC0gJHt0YXNrc1tpXS50aXRsZX0sICR7dGFza3NbaV0uZHVlRGF0ZX0sICR7dGFza3NbaV0ucHJpb3JpdHl9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBkZWxldGVUYXNrID0gKHRhc2tOYW1lKSA9PiB7XG4gICAgICAgIC8vIHRhc2tzLnNwbGljZSh0YXNrTmFtZSwgMSk7XG4gICAgICAgIGZvciAobGV0IGkgPSB0YXNrcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgaWYgKHRhc2tzW2ldLm15VGFza1V1aWQgPT09IHRhc2tOYW1lLm15VGFza1V1aWQpIHtcbiAgICAgICAgICAgICAgICB0YXNrcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHt0aXRsZSwgdGFza3MsIG15Rm9sZGVyVXVpZCwgYWRkVGFzaywgZGlzcGxheVRhc2tzLCBkZWxldGVUYXNrfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFN1cGVyRm9sZGVyKG15U3VwZXJGb2xkZXJVdWlkPXV1aWR2NCgpKSB7XG4gICAgbGV0IGZvbGRlcnMgPSBbXVxuXG4gICAgY29uc3QgYWRkRm9sZGVyID0gKG5ld0ZvbGRlck5hbWUpID0+IHtcbiAgICAgICAgZm9sZGVycy5wdXNoKG5ld0ZvbGRlck5hbWUpO1xuXG4gICAgICAgIC8vIGxvY2FsU3RvcmFnZS5zZXRJdGVtKG5ld0ZvbGRlck5hbWUubXlGb2xkZXJVdWlkLCBKU09OLnN0cmluZ2lmeShuZXdGb2xkZXJOYW1lKSk7XG4gICAgfVxuXG4gICAgY29uc3QgZGVsZXRlRm9sZGVyID0gKGZvbGRlck5hbWUpID0+IHtcbiAgICAgICAgZm9yIChsZXQgaSA9IGZvbGRlcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgIGlmIChmb2xkZXJzW2ldLm15Rm9sZGVyVXVpZCA9PT0gZm9sZGVyTmFtZS5teUZvbGRlclV1aWQpIHtcbiAgICAgICAgICAgICAgICBmb2xkZXJzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGZvbGRlck5hbWUubXlGb2xkZXJVdWlkKTtcblxuICAgIH1cblxuICAgIHJldHVybiB7Zm9sZGVycywgYWRkRm9sZGVyLCBkZWxldGVGb2xkZXIsIG15U3VwZXJGb2xkZXJVdWlkfVxufSIsImltcG9ydCB7XG4gICAgZGlzcGxheUN1cnJlbnRGb2xkZXJXaXRoSWQsXG4gICAgZGVsZXRlRm9sZGVyV2l0aElkLFxuICAgIGRlbGV0ZVRhc2tXaXRoSWQsXG4gICAgY2hhbmdlVGFza1N0YXR1cyxcbiAgICBmaW5kVGFza1dpdGhJZCxcbiAgICBnZXRFZGl0RGlhbG9nXG59IGZyb20gJy4uL2luZGV4LmpzJztcblxuXG4vLyBDcmVhdGUgYWxsIGVsZW1lbnRzIGZvciBlYWNoIHRhc2sgcHJvcGVydHkgYW5kIGNoYW5nZSB0ZXh0IGNvbnRlbnQgdG8gY29ycmVzcG9uZGluZyB2YWx1ZVxuLy8gVGhlbiBhZGQgdGhlbSB0byBhIG1haW4gZGl2IGFuZCByZXR1cm5cbmZ1bmN0aW9uIGNyZWF0ZVRhc2tFbGVtZW50KHRhc2tOYW1lKSB7XG4gICAgY29uc3QgdGFza0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IHRhc2tUaXRsZUluRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIGNvbnN0IHRhc2tEZXNjcmlwdGlvbkluRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIGNvbnN0IHRhc2tEdWVEYXRlSW5EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgY29uc3QgdGFza1ByaW9yaXR5SW5EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgXG4gICAgdGFza0Rpdi5jbGFzc0xpc3QuYWRkKCd0YXNrLWRpdicpO1xuICAgIHRhc2tUaXRsZUluRGl2LnRleHRDb250ZW50ID0gdGFza05hbWUudGl0bGU7XG4gICAgdGFza0Rlc2NyaXB0aW9uSW5EaXYudGV4dENvbnRlbnQgPSB0YXNrTmFtZS5kZXNjcmlwdGlvbjtcbiAgICB0YXNrRHVlRGF0ZUluRGl2LnRleHRDb250ZW50ID0gdGFza05hbWUuZHVlRGF0ZTtcbiAgICB0YXNrUHJpb3JpdHlJbkRpdi50ZXh0Q29udGVudCA9IHRhc2tOYW1lLnByaW9yaXR5O1xuXG4gICAgdGFza0Rpdi5hcHBlbmRDaGlsZCh0YXNrVGl0bGVJbkRpdik7XG4gICAgdGFza0Rpdi5hcHBlbmRDaGlsZCh0YXNrRGVzY3JpcHRpb25JbkRpdik7XG4gICAgdGFza0Rpdi5hcHBlbmRDaGlsZCh0YXNrRHVlRGF0ZUluRGl2KTtcbiAgICB0YXNrRGl2LmFwcGVuZENoaWxkKHRhc2tQcmlvcml0eUluRGl2KTtcbiAgICBjcmVhdGVUYXNrRGVsZXRlQnV0dG9uKHRhc2tEaXYpLnZhbHVlID0gdGFza05hbWUubXlUYXNrVXVpZDtcbiAgICBjcmVhdGVUYXNrRWRpdEJ1dHRvbih0YXNrRGl2KS52YWx1ZSA9IHRhc2tOYW1lLm15VGFza1V1aWQ7XG4gICAgY3JlYXRlVGFza1N0YXR1c0J1dHRvbih0YXNrRGl2KS52YWx1ZSA9IHRhc2tOYW1lLm15VGFza1V1aWQ7XG5cbiAgICByZXR1cm4gdGFza0Rpdjtcbn1cblxuLy8gVGFrZSBpbiB0YXNrIGFuZCB3aGVyZSB0byBhcHBlbmRcbi8vIENyZWF0ZSB0aGUgdGFzayB1c2luZyBjcmVhdGVUYXNrRWxlbWVudCBhbmQgYXNzaWduIHRvIHZhcmlhYmxlXG4vLyBUYXJnZXQgZWxlbWVudCB0byBhcHBlbmQgdG8gYW5kIGFwcGVuZFxuZnVuY3Rpb24gYXBwZW5kVGFzayh0YXNrTmFtZSwgbG9jYXRpb24pIHtcbiAgICBsZXQgdGFza0RPTSA9IGNyZWF0ZVRhc2tFbGVtZW50KHRhc2tOYW1lKTtcblxuICAgIGNvbnN0IGxvY2F0aW9uRE9NID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobG9jYXRpb24pO1xuICAgIGxvY2F0aW9uRE9NLmFwcGVuZENoaWxkKHRhc2tET00pO1xufVxuXG4vLyBUYWtlIGluIGZvbGRlciBuYW1lIHRoZW4gbG9vcCB0aHJvdWdoIHRhc2tzIGluc2lkZSBmb2xkZXIgdG8gYXBwZW5kIHRvIHNjcmVlblxuZnVuY3Rpb24gZGlzcGxheUZvbGRlclRhc2tzKGZvbGRlck5hbWUpIHtcbiAgICBmb2xkZXJOYW1lLnRhc2tzLmZvckVhY2godGFzayA9PiB7XG4gICAgICAgIGFwcGVuZFRhc2sodGFzaywgWyd0YXNrLWNvbnRhaW5lciddKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0VGFza0Zvcm1JbmZvKCkge1xuICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1mb3JtJyk7XG5cbiAgICBjb25zdCB0YXNrVGl0bGVJbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLXRpdGxlJ107XG4gICAgY29uc3QgdGFza0Rlc2NyaXB0aW9uSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay1kZXNjcmlwdGlvbiddO1xuICAgIGNvbnN0IHRhc2tEdWVEYXRlSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay1kdWUtZGF0ZSddO1xuICAgIGNvbnN0IHRhc2tQcmlvcml0eUluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stcHJpb3JpdHknXTtcbiAgICBcbiAgICBsZXQgdGFza1RpdGxlID0gdGFza1RpdGxlSW5Gb3JtLnZhbHVlO1xuICAgIGxldCB0YXNrRGVzY3JpcHRpb24gPSB0YXNrRGVzY3JpcHRpb25JbkZvcm0udmFsdWU7XG4gICAgbGV0IHRhc2tEdWVEYXRlID0gdGFza0R1ZURhdGVJbkZvcm0udmFsdWU7XG4gICAgbGV0IHRhc2tQcmlvcml0eSA9IHRhc2tQcmlvcml0eUluRm9ybS52YWx1ZTtcblxuICAgIHJldHVybiB7dGFza1RpdGxlLCB0YXNrRGVzY3JpcHRpb24sIHRhc2tEdWVEYXRlLCB0YXNrUHJpb3JpdHl9O1xufSBcblxuZnVuY3Rpb24gZ2V0VGFza0VkaXRGb3JtSW5mbygpIHtcbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXQtZm9ybScpO1xuXG4gICAgY29uc3QgdGFza1RpdGxlSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay10aXRsZSddO1xuICAgIGNvbnN0IHRhc2tEZXNjcmlwdGlvbkluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stZGVzY3JpcHRpb24nXTtcbiAgICBjb25zdCB0YXNrRHVlRGF0ZUluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stZHVlLWRhdGUnXTtcbiAgICBjb25zdCB0YXNrUHJpb3JpdHlJbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLXByaW9yaXR5J107XG4gICAgXG4gICAgbGV0IHRhc2tUaXRsZSA9IHRhc2tUaXRsZUluRm9ybS52YWx1ZTtcbiAgICBsZXQgdGFza0Rlc2NyaXB0aW9uID0gdGFza0Rlc2NyaXB0aW9uSW5Gb3JtLnZhbHVlO1xuICAgIGxldCB0YXNrRHVlRGF0ZSA9IHRhc2tEdWVEYXRlSW5Gb3JtLnZhbHVlO1xuICAgIGxldCB0YXNrUHJpb3JpdHkgPSB0YXNrUHJpb3JpdHlJbkZvcm0udmFsdWU7XG5cbiAgICByZXR1cm4ge3Rhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uLCB0YXNrRHVlRGF0ZSwgdGFza1ByaW9yaXR5fTtcbn0gXG5cbi8vIENyZWF0ZSBidXR0b24gdG8gaG9sZCBmb2xkZXIgYW5kIHRpdGxlXG4vLyBBZGQgdGl0bGUgdG8gZGl2IGFuZCByZXR1cm5cbmZ1bmN0aW9uIGNyZWF0ZUZvbGRlckJ1dHRvbihmb2xkZXJOYW1lKSB7XG4gICAgY29uc3Qgc2lkZWJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaWRlYmFyJyk7XG4gICAgY29uc3QgZm9sZGVyRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29uc3QgZm9sZGVyQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG5cbiAgICBmb2xkZXJEaXYuY2xhc3NMaXN0LmFkZCgnZm9sZGVyLWRpdicpO1xuICAgIGZvbGRlckJ0bi5jbGFzc0xpc3QuYWRkKCdmb2xkZXItYnV0dG9uJyk7XG4gICAgZm9sZGVyQnRuLnRleHRDb250ZW50ID0gZm9sZGVyTmFtZS50aXRsZTtcbiAgICBmb2xkZXJCdG4udmFsdWUgPSBmb2xkZXJOYW1lLm15Rm9sZGVyVXVpZDtcblxuICAgIGZvbGRlckRpdi5hcHBlbmRDaGlsZChmb2xkZXJCdG4pO1xuICAgIFxuICAgIC8vIENyZWF0ZSB0aGUgZGVsIGJ0biBhbmQgIGFzc2lnbiBzYW1lIGlkIGFzIGZvbGRlciB0byBpdFxuICAgIGNyZWF0ZUZvbGRlckRlbGV0ZUJ1dHRvbihmb2xkZXJEaXYpLnZhbHVlID0gZm9sZGVyTmFtZS5teUZvbGRlclV1aWQ7XG5cbiAgICBzaWRlYmFyLmFwcGVuZENoaWxkKGZvbGRlckRpdik7XG5cbiAgICBmb2xkZXJCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbGV0IGN1cnJlbnRGb2xkZXJJZCA9IGZvbGRlck5hbWUubXlGb2xkZXJVdWlkO1xuICAgICAgICBkaXNwbGF5Q3VycmVudEZvbGRlcldpdGhJZChmb2xkZXJOYW1lLm15Rm9sZGVyVXVpZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGZvbGRlck5hbWUudGl0bGUsIGZvbGRlck5hbWUubXlGb2xkZXJVdWlkKTtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRGb2xkZXJJZDtcbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gZm9sZGVyRGl2O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVGb2xkZXJEZWxldGVCdXR0b24oZm9sZGVyKSB7XG4gICAgY29uc3QgZm9sZGVyRGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG5cbiAgICBmb2xkZXJEZWxldGVCdG4uY2xhc3NMaXN0LmFkZCgnZm9sZGVyLWRlbGV0ZS1idG4nKTtcbiAgICBmb2xkZXJEZWxldGVCdG4udGV4dENvbnRlbnQgPSAnLSc7XG5cbiAgICBmb2xkZXIuYXBwZW5kQ2hpbGQoZm9sZGVyRGVsZXRlQnRuKTtcblxuICAgIGZvbGRlckRlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgbGV0IHRoaXNCdXR0b24gPSBlLnRhcmdldDtcbiAgICAgICAgZGVsZXRlRm9sZGVyV2l0aElkKHRoaXNCdXR0b24udmFsdWUpO1xuICAgICAgICB0aGlzQnV0dG9uLnBhcmVudE5vZGUucmVtb3ZlKCk7XG4gICAgfSlcblxuICAgIHJldHVybiBmb2xkZXJEZWxldGVCdG47XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVRhc2tEZWxldGVCdXR0b24odGFzaykge1xuICAgIGNvbnN0IHRhc2tEZWxldGVCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblxuICAgIHRhc2tEZWxldGVCdG4uY2xhc3NMaXN0LmFkZCgndGFzay1kZWxldGUtYnRuJyk7XG4gICAgdGFza0RlbGV0ZUJ0bi50ZXh0Q29udGVudCA9ICctJztcblxuICAgIHRhc2suYXBwZW5kQ2hpbGQodGFza0RlbGV0ZUJ0bik7XG5cbiAgICB0YXNrRGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBsZXQgdGhpc0J1dHRvbiA9IGUudGFyZ2V0O1xuICAgICAgICBkZWxldGVUYXNrV2l0aElkKHRoaXNCdXR0b24udmFsdWUpO1xuICAgICAgICB0aGlzQnV0dG9uLnBhcmVudE5vZGUucmVtb3ZlKCk7XG4gICAgfSlcblxuICAgIHJldHVybiB0YXNrRGVsZXRlQnRuO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVUYXNrRWRpdEJ1dHRvbih0YXNrKSB7XG4gICAgY29uc3QgdGFza0VkaXRCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblxuICAgIHRhc2tFZGl0QnRuLmNsYXNzTGlzdC5hZGQoJ3Rhc2stZWRpdC1idG4nKTtcbiAgICB0YXNrRWRpdEJ0bi50ZXh0Q29udGVudCA9ICcrJztcblxuICAgIHRhc2suYXBwZW5kQ2hpbGQodGFza0VkaXRCdG4pO1xuXG4gICAgdGFza0VkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8vIENyZWF0ZSBhIGJ1dHRvbiB0byBob2xkIElkIHZhbHVlXG4gICAgICAgIGNvbnN0IGVkaXRGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXQtZm9ybScpO1xuICAgICAgICBjb25zdCBidG5Gb3JJZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXG4gICAgICAgIGJ0bkZvcklkLmNsYXNzTGlzdC5hZGQoJ2VkaXQtYnRuLWlkJyk7XG4gICAgICAgIGJ0bkZvcklkLnZhbHVlID0gZS50YXJnZXQudmFsdWVcbiAgICAgICAgZWRpdEZvcm0uYXBwZW5kQ2hpbGQoYnRuRm9ySWQpO1xuXG4gICAgICAgIC8vIENoYW5nZSBmb3JtIGZpZWxkcyB0byB0YXNrIGluZm8gYW5kIG9wZW4gbW9kYWxcbiAgICAgICAgY2hhbmdlVGFza0Zvcm1GaWVsZHMoZmluZFRhc2tXaXRoSWQoZS50YXJnZXQudmFsdWUpKTtcbiAgICAgICAgZ2V0RWRpdERpYWxvZygpLnNob3dNb2RhbCgpO1xuICAgIH0pXG5cbiAgICByZXR1cm4gdGFza0VkaXRCdG47XG59XG5cbmZ1bmN0aW9uIGNoYW5nZVRhc2tGb3JtRmllbGRzKHRhc2spIHtcbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXQtZm9ybScpO1xuXG4gICAgY29uc3QgdGFza1RpdGxlSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay10aXRsZSddO1xuICAgIGNvbnN0IHRhc2tEZXNjcmlwdGlvbkluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stZGVzY3JpcHRpb24nXTtcbiAgICBjb25zdCB0YXNrRHVlRGF0ZUluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stZHVlLWRhdGUnXTtcbiAgICBjb25zdCB0YXNrUHJpb3JpdHlJbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLXByaW9yaXR5J107XG5cbiAgICB0YXNrVGl0bGVJbkZvcm0udmFsdWUgPSB0YXNrLnRpdGxlO1xuICAgIHRhc2tEZXNjcmlwdGlvbkluRm9ybS52YWx1ZSA9IHRhc2suZGVzY3JpcHRpb247XG4gICAgdGFza0R1ZURhdGVJbkZvcm0udmFsdWUgPSB0YXNrLmR1ZURhdGU7XG4gICAgdGFza1ByaW9yaXR5SW5Gb3JtLnZhbHVlID0gdGFzay5wcmlvcml0eTtcbn0gXG5cbmZ1bmN0aW9uIGNyZWF0ZVRhc2tTdGF0dXNCdXR0b24odGFzaykge1xuICAgIGNvbnN0IHRhc2tTdGF0dXNCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblxuICAgIHRhc2tTdGF0dXNCdG4uY2xhc3NMaXN0LmFkZCgndGFzay1zdGF0dXMtYnRuJyk7XG4gICAgdGFza1N0YXR1c0J0bi50ZXh0Q29udGVudCA9ICfinJQnO1xuXG4gICAgdGFzay5hcHBlbmRDaGlsZCh0YXNrU3RhdHVzQnRuKTtcblxuICAgIHRhc2tTdGF0dXNCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGxldCB0aGlzQnV0dG9uID0gZS50YXJnZXQ7XG4gICAgICAgIGNoYW5nZVRhc2tTdGF0dXModGhpc0J1dHRvbi52YWx1ZSk7XG4gICAgICAgIHRvZ2dsZUNvbXBsZXRlU3R5bGUodGhpc0J1dHRvbik7XG4gICAgfSlcblxuICAgIHJldHVybiB0YXNrU3RhdHVzQnRuO1xufVxuXG5mdW5jdGlvbiB0b2dnbGVDb21wbGV0ZVN0eWxlKGVsZW1lbnQpIHtcbiAgICBpZiAoIWVsZW1lbnQucGFyZW50Tm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbXBsZXRlLXRhc2snKSkge1xuICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnY29tcGxldGUtdGFzaycpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NvbXBsZXRlLXRhc2snKTtcbiAgICB9XG59XG5cbi8vIFRha2UgaW4gZm9sZGVyIG5hbWUgYW5kIGNyZWF0ZSBmb2xkZXIgdXNpbmcgZnVuY3Rpb25cbi8vIEFwcGVuZCB0byBzaWRlYmFyXG5mdW5jdGlvbiBhcHBlbmRGb2xkZXIoZm9sZGVyTmFtZSkge1xuICAgIGxldCBmb2xkZXJET00gPSBjcmVhdGVGb2xkZXJCdXR0b24oZm9sZGVyTmFtZSk7XG4gICAgXG4gICAgY29uc3Qgc2lkZWJhckZvbGRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2lkZWJhcicpO1xuICAgIHNpZGViYXJGb2xkZXJzLmFwcGVuZENoaWxkKGZvbGRlckRPTSk7XG59XG5cbi8vIFRha2UgaW4gc3VwZXIgZm9sZGVyIG5hbWUgdG8gbG9vcCB0aHJvdWdoIGVhY2ggZm9sZGVyIGFuZCBhcHBlbmQgdG8gc2lkZWJhclxuZnVuY3Rpb24gZGlzcGxheUZvbGRlcnMoc3VwZXJGb2xkZXJOYW1lKSB7XG4gICAgLy8gY2xlYXJTaWRlYmFyKCk7XG4gICAgc3VwZXJGb2xkZXJOYW1lLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBhcHBlbmRGb2xkZXIoZm9sZGVyKTtcbiAgICB9KTtcbn1cblxuXG5mdW5jdGlvbiBnZXRGb2xkZXJGb3JtSW5mbygpIHtcbiAgICBjb25zdCBmb2xkZXJGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlci1mb3JtJyk7XG5cbiAgICBjb25zdCBmb2xkZXJUaXRsZUluRm9ybSA9IGZvbGRlckZvcm0uZWxlbWVudHNbJ2ZvbGRlci10aXRsZSddLnZhbHVlO1xuXG4gICAgcmV0dXJuIHtmb2xkZXJGb3JtLCBmb2xkZXJUaXRsZUluRm9ybX07XG59XG5cbmZ1bmN0aW9uIGNsZWFyVGFza0NvbnRhaW5lcigpIHtcbiAgICBjb25zdCB0YXNrQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2stY29udGFpbmVyJyk7XG5cbiAgICB0YXNrQ29udGFpbmVyLnRleHRDb250ZW50ID0gJyc7XG59XG5cbmZ1bmN0aW9uIGFwcGVuZERyb3Bkb3duKHN1cGVyRm9sZGVyKSB7XG5cbiAgICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVyLXNlbGVjdGlvbicpO1xuXG4gICAgY2xlYXJTZWxlY3RNZW51KHNlbGVjdCk7XG5cbiAgICBzdXBlckZvbGRlci5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgIFxuICAgICAgICBvcHRpb24udGV4dENvbnRlbnQgPSBmb2xkZXIudGl0bGU7XG4gICAgICAgIG9wdGlvbi52YWx1ZSA9IGZvbGRlci5teUZvbGRlclV1aWQ7IC8vIGZpZ3VyZSBvdXQgaWYgdGhpcyBpcyBnb29kIHdheSB0byBzZWxlY3RcbiAgICAgICAgLy8gb3B0aW9uLnNldEF0dHJpYnV0ZSgnaW5kZXgnLCBpbmRleCsrKTtcblxuICAgICAgICBzZWxlY3QuYXBwZW5kQ2hpbGQob3B0aW9uKTtcbiAgICB9KVxufVxuXG5mdW5jdGlvbiBjbGVhclNlbGVjdE1lbnUoc2VsZWN0T3B0aW9uKSB7XG4gICAgZm9yIChsZXQgaSA9IHNlbGVjdE9wdGlvbi5vcHRpb25zLmxlbmd0aDsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgc2VsZWN0T3B0aW9uLnJlbW92ZSgwKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7XG4gICAgZ2V0VGFza0Zvcm1JbmZvLFxuICAgIGdldFRhc2tFZGl0Rm9ybUluZm8sXG4gICAgZ2V0Rm9sZGVyRm9ybUluZm8sXG4gICAgY3JlYXRlVGFza0VsZW1lbnQsXG4gICAgY3JlYXRlRm9sZGVyQnV0dG9uLFxuICAgIGFwcGVuZEZvbGRlcixcbiAgICBkaXNwbGF5Rm9sZGVyVGFza3MsXG4gICAgYXBwZW5kVGFzayxcbiAgICBkaXNwbGF5Rm9sZGVycyxcbiAgICBjbGVhclRhc2tDb250YWluZXIsXG4gICAgYXBwZW5kRHJvcGRvd24sXG4gICAgY2xlYXJTZWxlY3RNZW51LFxufSIsImltcG9ydCB7XG4gICAgVGFzayxcbiAgICBGb2xkZXIsXG4gICAgU3VwZXJGb2xkZXJcbn0gZnJvbSAnLi9tb2R1bGVzL2ZhY3Rvcmllcy5qcyc7XG5cbmltcG9ydCB7XG4gICAgZ2V0VGFza0Zvcm1JbmZvLFxuICAgIGdldFRhc2tFZGl0Rm9ybUluZm8sXG4gICAgZ2V0Rm9sZGVyRm9ybUluZm8sXG4gICAgYXBwZW5kRm9sZGVyLFxuICAgIGRpc3BsYXlGb2xkZXJUYXNrcyxcbiAgICBjbGVhclRhc2tDb250YWluZXIsXG4gICAgYXBwZW5kRHJvcGRvd24sXG4gICAgZGlzcGxheUZvbGRlcnNcblxufSBmcm9tICcuL21vZHVsZXMvZG9tLmpzJztcblxuaW1wb3J0IHsgZm9ybWF0RGlzdGFuY2UsIHN1YkRheXMgfSBmcm9tIFwiZGF0ZS1mbnNcIjtcblxuXG4vL1N1cGVyIEZvbGRlciBcbmNvbnN0IHN1cGVyRm9sZGVyID0gU3VwZXJGb2xkZXIoKTtcblxuLy8gT3BlbiB0YXNrIG1vZGFsIHdoZW4gY2xpY2tlZFxuY29uc3Qgb3BlblRhc2tNb2RhbEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVuLXRhc2stbW9kYWwtYnRuJyk7XG5vcGVuVGFza01vZGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgZ2V0VGFza0RpYWxvZygpLnJlc2V0O1xuICAgIGdldFRhc2tEaWFsb2coKS5zaG93TW9kYWwoKTtcbiAgICBhcHBlbmREcm9wZG93bihKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdmb2xkZXJzJykpKTtcbn0pO1xuXG4vLyBHZXQgdGFzayBkaWFsb2cgYW5kIHJldHVybiBcbmZ1bmN0aW9uIGdldFRhc2tEaWFsb2coKSB7XG4gICAgY29uc3QgdGFza0RpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLWRpYWxvZycpO1xuXG4gICAgcmV0dXJuIHRhc2tEaWFsb2c7XG59XG5cbmZ1bmN0aW9uIGdldEVkaXREaWFsb2coKSB7XG4gICAgY29uc3QgZWRpdERpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0LWRpYWxvZycpO1xuXG4gICAgcmV0dXJuIGVkaXREaWFsb2c7XG59XG5cbi8vIE9wZW4gZm9sZGVyIG1vZGFsIHdoZW4gY2xpY2tlZFxuY29uc3QgYWRkRm9sZGVyQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlci1hZGQtYnRuJyk7XG5hZGRGb2xkZXJCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICBcbiAgICBjb25zdCBmb2xkZXJEaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVyLWRpYWxvZycpO1xuICAgIGZvbGRlckRpYWxvZy5zaG93TW9kYWwoKTtcbiAgICBcbn0pO1xuXG4vLyBFdmVudCBsaXN0ZW5lciB0byBzdWJtaXQgZm9sZGVyIGZvcm1cbi8vIENyZWF0ZSBhIG5ldyBmb2xkZXIgaW5zdGFuY2Ugd2l0aCBpbmZvIGZyb20gZm9ybVxuLy8gQWRkIHRvIERPTVxuLy8gQWRkIHRvIHN1cGVyIGZvbGRlclxuLy8gU2hvdWxkIGJlIGRvbmUgb24gdGhlIGZvcm0gaW5zdGVhZCBvZiBidXR0b24gYnV0IE1ETiBleGFtcGxlIHdpdGggZGlhbG9nIGRpZCBpdCB0aGlzIHdheVxuY29uc3QgZm9sZGVyU3VibWl0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlci1jb25maXJtLWJ0bicpO1xuZm9sZGVyU3VibWl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBcbiAgICBjb25zdCBmb2xkZXJEaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVyLWRpYWxvZycpO1xuICAgIGNvbnN0IHtmb2xkZXJUaXRsZUluRm9ybX0gPSBnZXRGb2xkZXJGb3JtSW5mbygpO1xuXG4gICAgbGV0IG5ld0ZvbGRlciA9IEZvbGRlcihmb2xkZXJUaXRsZUluRm9ybSk7XG4gICAgYXBwZW5kRm9sZGVyKG5ld0ZvbGRlcik7XG4gICAgXG4gICAgc3VwZXJGb2xkZXIuYWRkRm9sZGVyKG5ld0ZvbGRlcik7XG4gICAgLy8gbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2ZvbGRlcnMnLCBKU09OLnN0cmluZ2lmeShzdXBlckZvbGRlcikpO1xuXG4gICAgbGV0IHN1cGVyRm9sZGVyRnJvbUxzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZm9sZGVycycpKTtcblxuICAgIHJlY3JlYXRlU3VwZXJGb2xkZXJGcm9tT2JqZWN0KHN1cGVyRm9sZGVyRnJvbUxzKTtcblxuICAgIGZvbGRlckRpYWxvZy5jbG9zZSgpO1xuXG59KTtcblxuY29uc3QgdGFza0FkZEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLWFkZC1idG4nKTtcbi8vIENyZWF0ZSBuZXcgdGFzayBpbnN0YW5jZSB1c2luZyBpbmZvIGZyb20gZm9ybVxudGFza0FkZEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAvLyBHZXQgdmFsdWUgb2YgdGhlIHNlbGVjdGVkIGZpZWxkIChJZCBiZWNhdXNlIHZhbHVlIGlzIHNldCB0byBpZCBpbiBkb20uanMpXG4gICAgY29uc3Qgc2VsZWN0ZWRGb2xkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVyLXNlbGVjdGlvbicpO1xuICAgIGNvbnN0IHNlbGVjdGVkRm9sZGVyVmFsdWUgPSBzZWxlY3RlZEZvbGRlci52YWx1ZTtcbiAgICAvLyBHZXQgdmFsdWVzIG9mIHRoZSBmb3JtXG4gICAgY29uc3Qge3Rhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uLCB0YXNrRHVlRGF0ZSwgdGFza1ByaW9yaXR5fSA9IGdldFRhc2tGb3JtSW5mbygpO1xuXG4gICAgLy8gQ3JlYXRlIG5ldyB0YXNrIGFuZCBsb29wIHRocm91Z2ggZm9sZGVyIHRvIGZpbmQgbWF0Y2hpbmcgSWQgYW5kIGFkZFxuICAgIGNvbnN0IG5ld1Rhc2sgPSBUYXNrKHRhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uLCB0YXNrRHVlRGF0ZSwgdGFza1ByaW9yaXR5KTtcbiAgICBzdXBlckZvbGRlci5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgaWYgKHNlbGVjdGVkRm9sZGVyVmFsdWUgPT09IGZvbGRlci5teUZvbGRlclV1aWQpIHtcbiAgICAgICAgICAgIGZvbGRlci5hZGRUYXNrKG5ld1Rhc2spO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZm9sZGVycycsIEpTT04uc3RyaW5naWZ5KHN1cGVyRm9sZGVyKSk7XG5cbiAgICBsZXQgc3VwZXJGb2xkZXJGcm9tTHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdmb2xkZXJzJykpO1xuXG4gICAgcmVjcmVhdGVTdXBlckZvbGRlckZyb21PYmplY3Qoc3VwZXJGb2xkZXJGcm9tTHMpO1xuXG4gICAgLy8gVXBkYXRlIHRoZSB0YXNrcyBvZiB0aGUgZm9sZGVyIHRoYXQgaXMgY3VycmVudGx5IGJlaW5nIGRpc3BsYXllZCB0byBhdm9pZCByZWxvYWRpbmcgZm9sZGVyXG4gICAgZGlzcGxheUN1cnJlbnRGb2xkZXJXaXRoSWQoc2VsZWN0ZWRGb2xkZXJWYWx1ZSk7XG4gICAgXG4gICAgLy8gQ2xlYXIgZm9ybSBmaWVsZHNcbiAgICBjb25zdCB0YXNrRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLWZvcm0nKTtcbiAgICB0YXNrRm9ybS5yZXNldCgpO1xuICAgIGdldFRhc2tEaWFsb2coKS5jbG9zZSgpO1xufSlcblxuLy8gU2VsZWN0IHRoZSBidXR0b24gd2l0aCBJZCBhbmQgZmluZCB0YXNrIHdpdGggdGhhdCBJZFxuLy8gQ2hhbmdlIHRoZSBpbmZvIG9mIHRoYXQgdGFzayBhbmQgdXBkYXRlIGZvbGRlclxuLy8gRGVsZXRlIGJ1dHRvbiBhZnRlciBhbmQgY2xvc2VcbmNvbnN0IHRhc2tFZGl0Q29uZmlybUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLWVkaXQtYnRuJyk7XG50YXNrRWRpdENvbmZpcm1CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIFxuICAgIGNvbnN0IGJ0bklkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmVkaXQtYnRuLWlkJyk7XG4gICAgXG4gICAgY29uc3Qge3Rhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uLCB0YXNrRHVlRGF0ZSwgdGFza1ByaW9yaXR5fSA9IGdldFRhc2tFZGl0Rm9ybUluZm8oKTtcbiAgICBcbiAgICBzdXBlckZvbGRlci5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgZm9sZGVyLnRhc2tzLmZvckVhY2godGFzayA9PiB7XG4gICAgICAgICAgICBpZiAoYnRuSWQudmFsdWUgPT09IHRhc2subXlUYXNrVXVpZCkge1xuICAgICAgICAgICAgICAgIHRhc2suZWRpdFRhc2sodGFza1RpdGxlLCB0YXNrRGVzY3JpcHRpb24sIHRhc2tEdWVEYXRlLCB0YXNrUHJpb3JpdHkpO1xuICAgICAgICAgICAgICAgIGRpc3BsYXlDdXJyZW50Rm9sZGVyV2l0aElkKGZvbGRlci5teUZvbGRlclV1aWQpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRhc2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH0pO1xuICAgIFxuICAgIGJ0bklkLnJlbW92ZSgpO1xuICAgIGdldEVkaXREaWFsb2coKS5jbG9zZSgpO1xuICAgIFxufSlcblxuLy8gVGVzdCB0YXNrc1xuY29uc3QgdGFzazEgPSBUYXNrKCdjaG9yZXMnLCAnd2FzaCBkaXNoZXMnLCAnbm92IDIzJywgJ2hpZ2gnKTtcbmNvbnN0IHRhc2syID0gVGFzaygnbW92aWVzJywgJ2F2YXRhcicsICdub3YgMjknLCAnbWVkJyk7XG5jb25zdCB0YXNrMyA9IFRhc2soJ2NvZGluZycsICd0b2RvIGxpc3QnLCAnZGVjIDEwJywgJ2xvdycpO1xuXG5sZXQgaW5ib3hGb2xkZXIgPSBGb2xkZXIoJ0luYm94Jyk7XG5pbmJveEZvbGRlci5hZGRUYXNrKHRhc2sxKTtcbnN1cGVyRm9sZGVyLmFkZEZvbGRlcihpbmJveEZvbGRlcik7XG5hcHBlbmRGb2xkZXIoaW5ib3hGb2xkZXIpO1xuXG5sZXQgdGVzdEZvbGRlcjIgPSBGb2xkZXIoJ3Rlc3QyJyk7XG50ZXN0Rm9sZGVyMi5hZGRUYXNrKHRhc2syKTtcbnRlc3RGb2xkZXIyLmFkZFRhc2sodGFzazEpO1xudGVzdEZvbGRlcjIuYWRkVGFzayh0YXNrMyk7XG50ZXN0Rm9sZGVyMi5kZWxldGVUYXNrKHRhc2syKTtcbnN1cGVyRm9sZGVyLmFkZEZvbGRlcih0ZXN0Rm9sZGVyMik7XG5hcHBlbmRGb2xkZXIodGVzdEZvbGRlcjIpO1xuXG5mdW5jdGlvbiBsb2FkUHJlc2V0Rm9sZGVycygpIHtcbiAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2ZvbGRlcnMnKSl7XG4gICAgICAgIGxldCBzdXBlckZvbGRlckZyb21McyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2ZvbGRlcnMnKSk7XG5cbiAgICAgICAgcmVjcmVhdGVTdXBlckZvbGRlckZyb21PYmplY3Qoc3VwZXJGb2xkZXJGcm9tTHMpO1xuXG4gICAgICAgIGRpc3BsYXlGb2xkZXJzKHJlY3JlYXRlU3VwZXJGb2xkZXJGcm9tT2JqZWN0KHN1cGVyRm9sZGVyRnJvbUxzKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2ZvbGRlcnMnLCBKU09OLnN0cmluZ2lmeShzdXBlckZvbGRlcikpO1xuICAgIH1cbn1cblxubG9hZFByZXNldEZvbGRlcnMoKTtcblxuLy8gUmVjcmVhdGUgdGFzayBmcm9tIGdlbmVyaWMgb2JqZWN0XG5mdW5jdGlvbiByZWNyZWF0ZVRhc2tPYmoodGFyZ2V0T2JqKSB7XG4gICAgY29uc3Qge3RpdGxlLCBkZXNjcmlwdGlvbiwgZHVlRGF0ZSwgcHJpb3JpdHksIG15VGFza1V1aWR9ID0gdGFyZ2V0T2JqO1xuXG4gICAgcmV0dXJuIFRhc2sodGl0bGUsIGRlc2NyaXB0aW9uLCBkdWVEYXRlLCBwcmlvcml0eSwgbXlUYXNrVXVpZCk7XG59XG5cbi8vIFJlY3JlYXRlIGEgZm9sZGVyIGZyb20gZ2VuZXJpYyBvYmplY3Rcbi8vIExvb3AgdGhyb3VnaCBHRU5FUklDIG9iamVjdHMgdGFza3Ncbi8vIEZvciBlYWNoIHRhc2ssIHJlY3JlYXRlIGEgdGFzayBhbmQgYWRkIHRvIHRoYXQgZm9sZGVyXG5mdW5jdGlvbiByZWNyZWF0ZUZvbGRlckZyb21PYmplY3QoZ2VuZXJpY09iaikge1xuXG4gICAgY29uc3Qge3RpdGxlLCAgbXlGb2xkZXJVdWlkfSA9IGdlbmVyaWNPYmo7XG4gICAgXG4gICAgbGV0IGZvbGRlckR1cGUgPSBGb2xkZXIodGl0bGUsIG15Rm9sZGVyVXVpZCk7XG5cbiAgICBnZW5lcmljT2JqLnRhc2tzLmZvckVhY2godGFzayA9PiB7XG4gICAgICAgIGZvbGRlckR1cGUuYWRkVGFzayhyZWNyZWF0ZVRhc2tPYmoodGFzaykpO1xuICAgIH0pXG5cbiAgICByZXR1cm4gZm9sZGVyRHVwZTtcbiAgICBcbn1cblxuZnVuY3Rpb24gcmVjcmVhdGVTdXBlckZvbGRlckZyb21PYmplY3QoZ2VuZXJpY09iaikge1xuICAgIGNvbnN0IHtteVN1cGVyRm9sZGVyVXVpZH0gPSBnZW5lcmljT2JqO1xuXG4gICAgbGV0IHN1cGVyRm9sZGVyRHVwZSA9IFN1cGVyRm9sZGVyKG15U3VwZXJGb2xkZXJVdWlkKTtcblxuICAgIGdlbmVyaWNPYmouZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgICAgIHN1cGVyRm9sZGVyRHVwZS5hZGRGb2xkZXIocmVjcmVhdGVGb2xkZXJGcm9tT2JqZWN0KGZvbGRlcikpXG4gICAgfSlcblxuICAgIHJldHVybiBzdXBlckZvbGRlckR1cGU7XG59XG5cbmxldCBsc1N1cGVyRm9sZGVyID0gU3VwZXJGb2xkZXIoKTtcbmxzU3VwZXJGb2xkZXIuYWRkRm9sZGVyKHRlc3RGb2xkZXIyKTtcbmxzU3VwZXJGb2xkZXIuYWRkRm9sZGVyKGluYm94Rm9sZGVyKTtcbmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdsc1N1cGVyRm9sZGVyJywgSlNPTi5zdHJpbmdpZnkobHNTdXBlckZvbGRlcikpO1xuXG5sZXQgZ2VuZXJpY1N1cGVyRm9sZGVyID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbHNTdXBlckZvbGRlcicpKTtcblxubGV0IG5ld0xzU3VwZXJGb2xkZXIgPSByZWNyZWF0ZVN1cGVyRm9sZGVyRnJvbU9iamVjdChnZW5lcmljU3VwZXJGb2xkZXIpO1xuY29uc29sZS5sb2cobmV3THNTdXBlckZvbGRlcik7XG5cblxuLy8gR28gdGhyb3VnaCBhbGwgZm9sZGVycyBhbmQgY2hlY2sgaWYgdGhlIGNsaWNrZWQgYnV0dG9uIHZhbHVlIG1hdGNoZXMgZm9sZGVyIHZhbHVlXG4vLyB0aGVuIGRpc3BsYXkgdGFza3Mgb2YgdGhhdCBmb2xkZXIgdG8gc2NyZWVuXG5mdW5jdGlvbiBkaXNwbGF5Q3VycmVudEZvbGRlcldpdGhJZCh0ZW1wSWQpIHtcblxuICAgIHN1cGVyRm9sZGVyLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBpZiAodGVtcElkID09PSBmb2xkZXIubXlGb2xkZXJVdWlkKSB7XG4gICAgICAgICAgICBjbGVhclRhc2tDb250YWluZXIoKTtcbiAgICAgICAgICAgIC8vZGlzcGxheSBhbGwgdGFza3Mgb2YgdGhpcyBmb2xkZXIgdG8gcGFnZVxuICAgICAgICAgICAgZGlzcGxheUZvbGRlclRhc2tzKGZvbGRlcik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIm1hdGNoIGZvdW5kXCIpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZUZvbGRlcldpdGhJZChidXR0b25JZCkge1xuICAgIHN1cGVyRm9sZGVyLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBpZiAoYnV0dG9uSWQgPT09IGZvbGRlci5teUZvbGRlclV1aWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGJ1dHRvbklkKTtcbiAgICAgICAgICAgIHN1cGVyRm9sZGVyLmRlbGV0ZUZvbGRlcihmb2xkZXIpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZVRhc2tXaXRoSWQoYnV0dG9uSWQpIHtcbiAgICBzdXBlckZvbGRlci5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgZm9sZGVyLnRhc2tzLmZvckVhY2godGFzayA9PiB7XG4gICAgICAgICAgICBpZiAoYnV0dG9uSWQgPT09IHRhc2subXlUYXNrVXVpZCkge1xuICAgICAgICAgICAgICAgIGZvbGRlci5kZWxldGVUYXNrKHRhc2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBjaGFuZ2VUYXNrU3RhdHVzKHRhc2tJZCkge1xuICAgIHN1cGVyRm9sZGVyLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBmb2xkZXIudGFza3MuZm9yRWFjaCh0YXNrID0+IHtcbiAgICAgICAgICAgIGlmICh0YXNrSWQgPT09IHRhc2subXlUYXNrVXVpZCkge1xuICAgICAgICAgICAgICAgIHRhc2suc2V0Q29tcGxldGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZmluZFRhc2tXaXRoSWQoYnV0dG9uSWQpIHtcbiAgICBsZXQgb3V0cHV0O1xuICAgIHN1cGVyRm9sZGVyLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBmb2xkZXIudGFza3MuZm9yRWFjaCh0YXNrID0+IHtcbiAgICAgICAgICAgIGlmIChidXR0b25JZCA9PT0gdGFzay5teVRhc2tVdWlkKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0ID0gdGFzaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9KTtcbiAgICByZXR1cm4gb3V0cHV0O1xufVxuXG5leHBvcnQge1xuICAgIGRpc3BsYXlDdXJyZW50Rm9sZGVyV2l0aElkLFxuICAgIGRlbGV0ZUZvbGRlcldpdGhJZCxcbiAgICBkZWxldGVUYXNrV2l0aElkLFxuICAgIGNoYW5nZVRhc2tTdGF0dXMsXG4gICAgZ2V0VGFza0RpYWxvZyxcbiAgICBmaW5kVGFza1dpdGhJZCxcbiAgICBnZXRFZGl0RGlhbG9nXG59Il0sIm5hbWVzIjpbIl9fd2VicGFja19yZXF1aXJlX18iLCJleHBvcnRzIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwicmFuZG9tVVVJRCIsImNyeXB0byIsImJpbmQiLCJnZXRSYW5kb21WYWx1ZXMiLCJybmRzOCIsIlVpbnQ4QXJyYXkiLCJybmciLCJFcnJvciIsImJ5dGVUb0hleCIsImkiLCJwdXNoIiwidG9TdHJpbmciLCJzbGljZSIsIm9wdGlvbnMiLCJidWYiLCJvZmZzZXQiLCJybmRzIiwicmFuZG9tIiwiYXJyIiwidW5zYWZlU3RyaW5naWZ5IiwiVGFzayIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJkdWVEYXRlIiwicHJpb3JpdHkiLCJteVRhc2tVdWlkIiwiY29tcGxldGVTdGF0ZSIsImdldENvbXBsZXRlU3RhdGUiLCJjaGFuZ2VQcmlvcml0eSIsIm5ld1ByaW9yaXR5Iiwic2V0Q29tcGxldGUiLCJlZGl0VGFzayIsIm5ld1RpdGxlIiwibmV3RGVzY3JpcHRpb24iLCJuZXdEdWVEYXRlIiwicHJpbnRUYXNrIiwiY29uc29sZSIsImxvZyIsIkZvbGRlciIsIm15Rm9sZGVyVXVpZCIsInRhc2tzIiwiYWRkVGFzayIsIm5ld1Rhc2tOYW1lIiwiZGlzcGxheVRhc2tzIiwibGVuZ3RoIiwiZGVsZXRlVGFzayIsInRhc2tOYW1lIiwic3BsaWNlIiwiU3VwZXJGb2xkZXIiLCJteVN1cGVyRm9sZGVyVXVpZCIsImZvbGRlcnMiLCJhZGRGb2xkZXIiLCJuZXdGb2xkZXJOYW1lIiwiZGVsZXRlRm9sZGVyIiwiZm9sZGVyTmFtZSIsImxvY2FsU3RvcmFnZSIsInJlbW92ZUl0ZW0iLCJkaXNwbGF5Rm9sZGVyVGFza3MiLCJmb3JFYWNoIiwidGFzayIsImxvY2F0aW9uIiwidGFza0RPTSIsInRhc2tEaXYiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ0YXNrVGl0bGVJbkRpdiIsInRhc2tEZXNjcmlwdGlvbkluRGl2IiwidGFza0R1ZURhdGVJbkRpdiIsInRhc2tQcmlvcml0eUluRGl2IiwiY2xhc3NMaXN0IiwiYWRkIiwidGV4dENvbnRlbnQiLCJhcHBlbmRDaGlsZCIsInRhc2tEZWxldGVCdG4iLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInRoaXNCdXR0b24iLCJ0YXJnZXQiLCJkZWxldGVUYXNrV2l0aElkIiwidmFsdWUiLCJwYXJlbnROb2RlIiwicmVtb3ZlIiwiY3JlYXRlVGFza0RlbGV0ZUJ1dHRvbiIsInRhc2tFZGl0QnRuIiwiZWRpdEZvcm0iLCJnZXRFbGVtZW50QnlJZCIsImJ0bkZvcklkIiwiZm9ybSIsInRhc2tUaXRsZUluRm9ybSIsImVsZW1lbnRzIiwidGFza0Rlc2NyaXB0aW9uSW5Gb3JtIiwidGFza0R1ZURhdGVJbkZvcm0iLCJ0YXNrUHJpb3JpdHlJbkZvcm0iLCJjaGFuZ2VUYXNrRm9ybUZpZWxkcyIsImZpbmRUYXNrV2l0aElkIiwiZ2V0RWRpdERpYWxvZyIsInNob3dNb2RhbCIsImNyZWF0ZVRhc2tFZGl0QnV0dG9uIiwidGFza1N0YXR1c0J0biIsImVsZW1lbnQiLCJjaGFuZ2VUYXNrU3RhdHVzIiwiY29udGFpbnMiLCJjcmVhdGVUYXNrU3RhdHVzQnV0dG9uIiwiY3JlYXRlVGFza0VsZW1lbnQiLCJhcHBlbmRUYXNrIiwiYXBwZW5kRm9sZGVyIiwiZm9sZGVyRE9NIiwic2lkZWJhciIsInF1ZXJ5U2VsZWN0b3IiLCJmb2xkZXJEaXYiLCJmb2xkZXJCdG4iLCJmb2xkZXIiLCJmb2xkZXJEZWxldGVCdG4iLCJkZWxldGVGb2xkZXJXaXRoSWQiLCJjcmVhdGVGb2xkZXJEZWxldGVCdXR0b24iLCJjdXJyZW50Rm9sZGVySWQiLCJkaXNwbGF5Q3VycmVudEZvbGRlcldpdGhJZCIsImNyZWF0ZUZvbGRlckJ1dHRvbiIsInN1cGVyRm9sZGVyIiwiZ2V0VGFza0RpYWxvZyIsInJlc2V0Iiwic2VsZWN0Iiwic2VsZWN0T3B0aW9uIiwiY2xlYXJTZWxlY3RNZW51Iiwib3B0aW9uIiwiYXBwZW5kRHJvcGRvd24iLCJKU09OIiwicGFyc2UiLCJnZXRJdGVtIiwicHJldmVudERlZmF1bHQiLCJmb2xkZXJEaWFsb2ciLCJmb2xkZXJUaXRsZUluRm9ybSIsImZvbGRlckZvcm0iLCJnZXRGb2xkZXJGb3JtSW5mbyIsIm5ld0ZvbGRlciIsInJlY3JlYXRlU3VwZXJGb2xkZXJGcm9tT2JqZWN0IiwiY2xvc2UiLCJzZWxlY3RlZEZvbGRlclZhbHVlIiwidGFza1RpdGxlIiwidGFza0Rlc2NyaXB0aW9uIiwidGFza0R1ZURhdGUiLCJ0YXNrUHJpb3JpdHkiLCJnZXRUYXNrRm9ybUluZm8iLCJuZXdUYXNrIiwiYnRuSWQiLCJnZXRUYXNrRWRpdEZvcm1JbmZvIiwidGFzazEiLCJ0YXNrMiIsInRhc2szIiwiaW5ib3hGb2xkZXIiLCJ0ZXN0Rm9sZGVyMiIsImdlbmVyaWNPYmoiLCJzdXBlckZvbGRlckR1cGUiLCJmb2xkZXJEdXBlIiwidGFyZ2V0T2JqIiwicmVjcmVhdGVUYXNrT2JqIiwicmVjcmVhdGVGb2xkZXJGcm9tT2JqZWN0Iiwic3VwZXJGb2xkZXJGcm9tTHMiLCJzZXRJdGVtIiwic3RyaW5naWZ5IiwibG9hZFByZXNldEZvbGRlcnMiLCJsc1N1cGVyRm9sZGVyIiwibmV3THNTdXBlckZvbGRlciIsInRlbXBJZCIsImJ1dHRvbklkIiwidGFza0lkIiwib3V0cHV0Il0sInNvdXJjZVJvb3QiOiIifQ==