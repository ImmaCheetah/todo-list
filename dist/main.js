(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{kj:()=>C,F5:()=>I,k3:()=>T,HA:()=>U,QP:()=>b,mo:()=>f});const t={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let n;const o=new Uint8Array(16);function d(){if(!n&&(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(o)}const l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));const r=function(e,n,o){if(t.randomUUID&&!n&&!e)return t.randomUUID();const r=(e=e||{}).random||(e.rng||d)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,n){o=o||0;for(let e=0;e<16;++e)n[o+e]=r[e];return n}return function(e,t=0){return l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]}(r)};function a(e,t,n,o,d=r()){let l=!1;const a=()=>l;e=e.toString(),t=t.toString();const s=e=>{o=e};return{get title(){return e},get description(){return t},get dueDate(){return n},get priority(){return o},getCompleteState:a,setComplete:()=>{l=0==a()},changePriority:s,editTask:(o,d,l,r)=>{e=o,t=d,n=l,s(r)},printTask:()=>{console.log(`Task title - ${e}, Desc - ${t}, Date - ${n}, Priority - ${o}`)},myTaskUuid:d}}function s(e,t=r()){let n=[];return{title:e,tasks:n,myFolderUuid:t,addTask:e=>{n.push(e)},displayTasks:()=>{for(let e=0;e<n.length;e++)console.log(`Task ${e} - ${n[e].title}, ${n[e].dueDate}, ${n[e].priority}`)},deleteTask:e=>{for(let t=n.length-1;t>=0;--t)n[t].myTaskUuid===e.myTaskUuid&&n.splice(t,1)}}}function i(e){e.tasks.forEach((e=>{!function(e,t){let n=function(e){const t=document.createElement("div"),n=document.createElement("p"),o=document.createElement("p"),d=document.createElement("p"),l=document.createElement("p");return t.classList.add("task-div"),n.textContent=e.title,o.textContent=e.description,d.textContent=e.dueDate,l.textContent=e.priority,t.appendChild(n),t.appendChild(o),t.appendChild(d),t.appendChild(l),(function(e){const t=document.createElement("button");return t.classList.add("task-delete-btn"),t.textContent="-",e.appendChild(t),t.addEventListener("click",(function(e){let t=e.target;T(t.value),t.parentNode.remove()})),t}(t)).value=e.myTaskUuid,(function(e){const t=document.createElement("button");return t.classList.add("task-edit-btn"),t.textContent="+",e.appendChild(t),t.addEventListener("click",(function(e){const t=document.getElementById("edit-form"),n=document.createElement("button");n.classList.add("edit-btn-id"),n.value=e.target.value,t.appendChild(n),function(e){const t=document.getElementById("edit-form"),n=t.elements["task-title"],o=t.elements["task-description"],d=t.elements["task-due-date"],l=t.elements["task-priority"];n.value=e.title,o.value=e.description,d.value=e.dueDate,l.value=e.priority}(b(e.target.value)),f().showModal()})),t}(t)).value=e.myTaskUuid,(function(e){const t=document.createElement("button");return t.classList.add("task-status-btn"),t.textContent="âœ”",e.appendChild(t),t.addEventListener("click",(function(e){let t=e.target;var n;C(t.value),(n=t).parentNode.classList.contains("complete-task")?n.parentNode.classList.remove("complete-task"):n.parentNode.classList.add("complete-task")})),t}(t)).value=e.myTaskUuid,t}(e);document.getElementById(["task-container"]).appendChild(n)}(e)}))}function c(e){let t=function(e){const t=document.querySelector(".sidebar"),n=document.createElement("div"),o=document.createElement("button");return n.classList.add("folder-div"),o.classList.add("folder-button"),o.textContent=e.title,o.value=e.myFolderUuid,n.appendChild(o),(function(e){const t=document.createElement("button");return t.classList.add("folder-delete-btn"),t.textContent="-",e.appendChild(t),t.addEventListener("click",(function(e){let t=e.target;I(t.value),t.parentNode.remove()})),t}(n)).value=e.myFolderUuid,t.appendChild(n),o.addEventListener("click",(function(){let t=e.myFolderUuid;return U(e.myFolderUuid),console.log(e.title,e.myFolderUuid),t})),n}(e);document.querySelector(".sidebar").appendChild(t)}const u=function(){let e=[];return{folders:e,addFolder:t=>{e.push(t)},deleteFolder:t=>{for(let n=e.length-1;n>=0;--n)e[n].myFolderUuid===t.myFolderUuid&&e.splice(n,1);localStorage.removeItem(t.myFolderUuid)}}}();function m(){return document.getElementById("task-dialog")}function f(){return document.getElementById("edit-dialog")}function p(e){u.folders.forEach((t=>{if(e===t.myFolderUuid)return t}))}document.getElementById("open-task-modal-btn").addEventListener("click",(function(){m().reset,m().showModal(),function(e){const t=document.getElementById("folder-selection");!function(e){for(let t=e.options.length;t>=0;t--)e.remove(0)}(t),e.folders.forEach((e=>{const n=document.createElement("option");n.textContent=e.title,n.value=e.myFolderUuid,t.appendChild(n)}))}(u)})),document.getElementById("folder-add-btn").addEventListener("click",(function(){document.getElementById("folder-dialog").showModal()})),document.getElementById("folder-confirm-btn").addEventListener("click",(function(e){e.preventDefault();const t=document.getElementById("folder-dialog"),{folderTitleInForm:n}=function(){const e=document.getElementById("folder-form");return{folderForm:e,folderTitleInForm:e.elements["folder-title"].value}}();let o=s(n);c(o),localStorage.setItem("folders",JSON.stringify(o)),u.addFolder(o),t.close()})),document.getElementById("task-add-btn").addEventListener("click",(function(e){e.preventDefault();const t=document.getElementById("folder-selection").value,{taskTitle:n,taskDescription:o,taskDueDate:d,taskPriority:l}=function(){const e=document.getElementById("main-form"),t=e.elements["task-title"],n=e.elements["task-description"],o=e.elements["task-due-date"],d=e.elements["task-priority"];return{taskTitle:t.value,taskDescription:n.value,taskDueDate:o.value,taskPriority:d.value}}(),r=a(n,o,d,l);u.folders.forEach((e=>{t===e.myFolderUuid&&e.addTask(r)}));for(let e=0;e<localStorage.length;e++){let n=localStorage.key(e);console.log(n);let o=JSON.parse(localStorage.getItem(n));if(o.myFolderUuid===t){let e=h(o,p(t));console.log(e),e.addTask(k)}}U(t),document.getElementById("main-form").reset(),m().close()})),document.getElementById("task-edit-btn").addEventListener("click",(function(e){e.preventDefault();const t=document.querySelector(".edit-btn-id"),{taskTitle:n,taskDescription:o,taskDueDate:d,taskPriority:l}=function(){const e=document.getElementById("edit-form"),t=e.elements["task-title"],n=e.elements["task-description"],o=e.elements["task-due-date"],d=e.elements["task-priority"];return{taskTitle:t.value,taskDescription:n.value,taskDueDate:o.value,taskPriority:d.value}}();u.folders.forEach((e=>{e.tasks.forEach((r=>{t.value===r.myTaskUuid&&(r.editTask(n,o,d,l),U(e.myFolderUuid),console.log(r))}))})),t.remove(),f().close()}));const k=a("chores","wash dishes","nov 23","high"),y=a("movies","avatar","nov 29","med"),g=a("coding","todo list","dec 10","low");let v=s("Inbox");v.addTask(k),u.addFolder(v),c(v);let E=s("test2");function h(e,t){const{title:n,myFolderUuid:o}=e;return a(n,o)}function U(e){u.folders.forEach((t=>{e===t.myFolderUuid&&(document.getElementById("task-container").textContent="",i(t),console.log("match found"))}))}function I(e){u.folders.forEach((t=>{e===t.myFolderUuid&&(console.log(e),u.deleteFolder(t))}))}function T(e){u.folders.forEach((t=>{t.tasks.forEach((n=>{e===n.myTaskUuid&&t.deleteTask(n)}))}))}function C(e){u.folders.forEach((t=>{t.tasks.forEach((t=>{e===t.myTaskUuid&&t.setComplete()}))}))}function b(e){let t;return u.folders.forEach((n=>{n.tasks.forEach((n=>{e===n.myTaskUuid&&(t=n)}))})),t}E.addTask(y),E.addTask(k),E.addTask(g),E.deleteTask(y),u.addFolder(E),c(E),localStorage.setItem("folders",JSON.stringify(u)),console.log(JSON.parse(localStorage.getItem("folders")))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNwQmlCLElBQWFqQixFQUFPaEUsZUFDcEJILFFBQVFDLElBQUltRixHQUNaVixFQUFZSSxhQUFhWCxHQUM3QixHQUVSLENBRUEsU0FBU2pDLEVBQWlCa0QsR0FDdEJWLEVBQVlDLFFBQVE3RCxTQUFRcUQsSUFDeEJBLEVBQU8vRCxNQUFNVSxTQUFRQyxJQUNicUUsSUFBYXJFLEVBQUsxQixZQUNsQjhFLEVBQU8xRCxXQUFXTSxFQUN0QixHQUNILEdBRVQsQ0FHQSxTQUFTeUMsRUFBaUJtRSxHQUN0QmpELEVBQVlDLFFBQVE3RCxTQUFRcUQsSUFDeEJBLEVBQU8vRCxNQUFNVSxTQUFRQyxJQUNiNEcsSUFBVzVHLEVBQUsxQixZQUNoQjBCLEVBQUtyQixhQUNULEdBQ0gsR0FFVCxDQUVBLFNBQVN3RCxFQUFla0MsR0FDcEIsSUFBSXdDLEVBUUosT0FQQWxELEVBQVlDLFFBQVE3RCxTQUFRcUQsSUFDeEJBLEVBQU8vRCxNQUFNVSxTQUFRQyxJQUNicUUsSUFBYXJFLEVBQUsxQixhQUNsQnVJLEVBQVM3RyxFQUNiLEdBQ0gsSUFFRTZHLENBQ1gsQ0F2SEFMLEVBQVlsSCxRQUFRK0csR0FDcEJHLEVBQVlsSCxRQUFRNEcsR0FDcEJNLEVBQVlsSCxRQUFRZ0gsR0FDcEJFLEVBQVk5RyxXQUFXMkcsR0FDdkIxQyxFQUFZRSxVQUFVMkMsR0FFdEIxRCxFQUFhMEQsR0FjVHhDLGFBQWFrQixRQUFRLFVBQVdDLEtBQUtDLFVBQVV6QixJQUMvQzFFLFFBQVFDLElBQUlpRyxLQUFLVyxNQUFNOUIsYUFBYStCLFFBQVEsWSIsInNvdXJjZXMiOlsid2VicGFjazovL3RvZG8tbGlzdC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly90b2RvLWxpc3Qvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL3RvZG8tbGlzdC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy91dWlkL2Rpc3QvZXNtLWJyb3dzZXIvbmF0aXZlLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy91dWlkL2Rpc3QvZXNtLWJyb3dzZXIvcm5nLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy91dWlkL2Rpc3QvZXNtLWJyb3dzZXIvc3RyaW5naWZ5LmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy91dWlkL2Rpc3QvZXNtLWJyb3dzZXIvdjQuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL21vZHVsZXMvZmFjdG9yaWVzLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9tb2R1bGVzL2RvbS5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCJjb25zdCByYW5kb21VVUlEID0gdHlwZW9mIGNyeXB0byAhPT0gJ3VuZGVmaW5lZCcgJiYgY3J5cHRvLnJhbmRvbVVVSUQgJiYgY3J5cHRvLnJhbmRvbVVVSUQuYmluZChjcnlwdG8pO1xuZXhwb3J0IGRlZmF1bHQge1xuICByYW5kb21VVUlEXG59OyIsIi8vIFVuaXF1ZSBJRCBjcmVhdGlvbiByZXF1aXJlcyBhIGhpZ2ggcXVhbGl0eSByYW5kb20gIyBnZW5lcmF0b3IuIEluIHRoZSBicm93c2VyIHdlIHRoZXJlZm9yZVxuLy8gcmVxdWlyZSB0aGUgY3J5cHRvIEFQSSBhbmQgZG8gbm90IHN1cHBvcnQgYnVpbHQtaW4gZmFsbGJhY2sgdG8gbG93ZXIgcXVhbGl0eSByYW5kb20gbnVtYmVyXG4vLyBnZW5lcmF0b3JzIChsaWtlIE1hdGgucmFuZG9tKCkpLlxubGV0IGdldFJhbmRvbVZhbHVlcztcbmNvbnN0IHJuZHM4ID0gbmV3IFVpbnQ4QXJyYXkoMTYpO1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcm5nKCkge1xuICAvLyBsYXp5IGxvYWQgc28gdGhhdCBlbnZpcm9ubWVudHMgdGhhdCBuZWVkIHRvIHBvbHlmaWxsIGhhdmUgYSBjaGFuY2UgdG8gZG8gc29cbiAgaWYgKCFnZXRSYW5kb21WYWx1ZXMpIHtcbiAgICAvLyBnZXRSYW5kb21WYWx1ZXMgbmVlZHMgdG8gYmUgaW52b2tlZCBpbiBhIGNvbnRleHQgd2hlcmUgXCJ0aGlzXCIgaXMgYSBDcnlwdG8gaW1wbGVtZW50YXRpb24uXG4gICAgZ2V0UmFuZG9tVmFsdWVzID0gdHlwZW9mIGNyeXB0byAhPT0gJ3VuZGVmaW5lZCcgJiYgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzLmJpbmQoY3J5cHRvKTtcblxuICAgIGlmICghZ2V0UmFuZG9tVmFsdWVzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NyeXB0by5nZXRSYW5kb21WYWx1ZXMoKSBub3Qgc3VwcG9ydGVkLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3V1aWRqcy91dWlkI2dldHJhbmRvbXZhbHVlcy1ub3Qtc3VwcG9ydGVkJyk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGdldFJhbmRvbVZhbHVlcyhybmRzOCk7XG59IiwiaW1wb3J0IHZhbGlkYXRlIGZyb20gJy4vdmFsaWRhdGUuanMnO1xuLyoqXG4gKiBDb252ZXJ0IGFycmF5IG9mIDE2IGJ5dGUgdmFsdWVzIHRvIFVVSUQgc3RyaW5nIGZvcm1hdCBvZiB0aGUgZm9ybTpcbiAqIFhYWFhYWFhYLVhYWFgtWFhYWC1YWFhYLVhYWFhYWFhYWFhYWFxuICovXG5cbmNvbnN0IGJ5dGVUb0hleCA9IFtdO1xuXG5mb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgKytpKSB7XG4gIGJ5dGVUb0hleC5wdXNoKChpICsgMHgxMDApLnRvU3RyaW5nKDE2KS5zbGljZSgxKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1bnNhZmVTdHJpbmdpZnkoYXJyLCBvZmZzZXQgPSAwKSB7XG4gIC8vIE5vdGU6IEJlIGNhcmVmdWwgZWRpdGluZyB0aGlzIGNvZGUhICBJdCdzIGJlZW4gdHVuZWQgZm9yIHBlcmZvcm1hbmNlXG4gIC8vIGFuZCB3b3JrcyBpbiB3YXlzIHlvdSBtYXkgbm90IGV4cGVjdC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS91dWlkanMvdXVpZC9wdWxsLzQzNFxuICByZXR1cm4gYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAwXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDFdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMl1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAzXV0gKyAnLScgKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDRdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgNV1dICsgJy0nICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA2XV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDddXSArICctJyArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgOF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA5XV0gKyAnLScgKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDEwXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDExXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDEyXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDEzXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDE0XV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDE1XV07XG59XG5cbmZ1bmN0aW9uIHN0cmluZ2lmeShhcnIsIG9mZnNldCA9IDApIHtcbiAgY29uc3QgdXVpZCA9IHVuc2FmZVN0cmluZ2lmeShhcnIsIG9mZnNldCk7IC8vIENvbnNpc3RlbmN5IGNoZWNrIGZvciB2YWxpZCBVVUlELiAgSWYgdGhpcyB0aHJvd3MsIGl0J3MgbGlrZWx5IGR1ZSB0byBvbmVcbiAgLy8gb2YgdGhlIGZvbGxvd2luZzpcbiAgLy8gLSBPbmUgb3IgbW9yZSBpbnB1dCBhcnJheSB2YWx1ZXMgZG9uJ3QgbWFwIHRvIGEgaGV4IG9jdGV0IChsZWFkaW5nIHRvXG4gIC8vIFwidW5kZWZpbmVkXCIgaW4gdGhlIHV1aWQpXG4gIC8vIC0gSW52YWxpZCBpbnB1dCB2YWx1ZXMgZm9yIHRoZSBSRkMgYHZlcnNpb25gIG9yIGB2YXJpYW50YCBmaWVsZHNcblxuICBpZiAoIXZhbGlkYXRlKHV1aWQpKSB7XG4gICAgdGhyb3cgVHlwZUVycm9yKCdTdHJpbmdpZmllZCBVVUlEIGlzIGludmFsaWQnKTtcbiAgfVxuXG4gIHJldHVybiB1dWlkO1xufVxuXG5leHBvcnQgZGVmYXVsdCBzdHJpbmdpZnk7IiwiaW1wb3J0IG5hdGl2ZSBmcm9tICcuL25hdGl2ZS5qcyc7XG5pbXBvcnQgcm5nIGZyb20gJy4vcm5nLmpzJztcbmltcG9ydCB7IHVuc2FmZVN0cmluZ2lmeSB9IGZyb20gJy4vc3RyaW5naWZ5LmpzJztcblxuZnVuY3Rpb24gdjQob3B0aW9ucywgYnVmLCBvZmZzZXQpIHtcbiAgaWYgKG5hdGl2ZS5yYW5kb21VVUlEICYmICFidWYgJiYgIW9wdGlvbnMpIHtcbiAgICByZXR1cm4gbmF0aXZlLnJhbmRvbVVVSUQoKTtcbiAgfVxuXG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICBjb25zdCBybmRzID0gb3B0aW9ucy5yYW5kb20gfHwgKG9wdGlvbnMucm5nIHx8IHJuZykoKTsgLy8gUGVyIDQuNCwgc2V0IGJpdHMgZm9yIHZlcnNpb24gYW5kIGBjbG9ja19zZXFfaGlfYW5kX3Jlc2VydmVkYFxuXG4gIHJuZHNbNl0gPSBybmRzWzZdICYgMHgwZiB8IDB4NDA7XG4gIHJuZHNbOF0gPSBybmRzWzhdICYgMHgzZiB8IDB4ODA7IC8vIENvcHkgYnl0ZXMgdG8gYnVmZmVyLCBpZiBwcm92aWRlZFxuXG4gIGlmIChidWYpIHtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfHwgMDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7ICsraSkge1xuICAgICAgYnVmW29mZnNldCArIGldID0gcm5kc1tpXTtcbiAgICB9XG5cbiAgICByZXR1cm4gYnVmO1xuICB9XG5cbiAgcmV0dXJuIHVuc2FmZVN0cmluZ2lmeShybmRzKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgdjQ7IiwiaW1wb3J0IHt2NCBhcyB1dWlkdjR9IGZyb20gJ3V1aWQnO1xuXG5leHBvcnQgZnVuY3Rpb24gVGFzayh0aXRsZSwgZGVzY3JpcHRpb24sIGR1ZURhdGUsIHByaW9yaXR5LCBteVRhc2tVdWlkID0gdXVpZHY0KCkpIHtcblxuICAgIC8vIGxldCBteVRhc2tVdWlkID0gdXVpZHY0KCk7XG5cbiAgICBsZXQgY29tcGxldGVTdGF0ZSA9IGZhbHNlO1xuXG4gICAgY29uc3QgZ2V0Q29tcGxldGVTdGF0ZSA9ICgpID0+IGNvbXBsZXRlU3RhdGU7XG5cbiAgICBjb25zdCBzZXRDb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgaWYgKGdldENvbXBsZXRlU3RhdGUoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgY29tcGxldGVTdGF0ZSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb21wbGV0ZVN0YXRlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIHRpdGxlID0gdGl0bGUudG9TdHJpbmcoKTtcbiAgICBkZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uLnRvU3RyaW5nKCk7XG5cbiAgICBjb25zdCBjaGFuZ2VQcmlvcml0eSA9IChuZXdQcmlvcml0eSkgPT4ge1xuICAgICAgICBwcmlvcml0eSA9IG5ld1ByaW9yaXR5O1xuICAgIH1cblxuICAgIGNvbnN0IGVkaXRUYXNrID0gKG5ld1RpdGxlLCBuZXdEZXNjcmlwdGlvbiwgbmV3RHVlRGF0ZSwgbmV3UHJpb3JpdHkpID0+IHtcbiAgICAgICAgdGl0bGUgPSBuZXdUaXRsZTtcbiAgICAgICAgZGVzY3JpcHRpb24gPSBuZXdEZXNjcmlwdGlvbjtcbiAgICAgICAgZHVlRGF0ZSA9IG5ld0R1ZURhdGU7XG4gICAgICAgIGNoYW5nZVByaW9yaXR5KG5ld1ByaW9yaXR5KTtcbiAgICB9XG5cbiAgICBjb25zdCBwcmludFRhc2sgPSAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBUYXNrIHRpdGxlIC0gJHt0aXRsZX0sIERlc2MgLSAke2Rlc2NyaXB0aW9ufSwgRGF0ZSAtICR7ZHVlRGF0ZX0sIFByaW9yaXR5IC0gJHtwcmlvcml0eX1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBnZXQgdGl0bGUoKSB7cmV0dXJuIHRpdGxlfSwgXG4gICAgICAgIGdldCBkZXNjcmlwdGlvbigpIHtyZXR1cm4gZGVzY3JpcHRpb259LCBcbiAgICAgICAgZ2V0IGR1ZURhdGUoKSB7cmV0dXJuIGR1ZURhdGV9LCBcbiAgICAgICAgZ2V0IHByaW9yaXR5KCkge3JldHVybiBwcmlvcml0eX0sXG4gICAgICAgIGdldENvbXBsZXRlU3RhdGUsXG4gICAgICAgIHNldENvbXBsZXRlLCBcbiAgICAgICAgY2hhbmdlUHJpb3JpdHksXG4gICAgICAgIGVkaXRUYXNrLFxuICAgICAgICBwcmludFRhc2ssXG4gICAgICAgIG15VGFza1V1aWRcbiAgICB9O1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIEZvbGRlcih0aXRsZSwgbXlGb2xkZXJVdWlkPXV1aWR2NCgpKSB7XG4gICAgXG5cbiAgICAvLyBsZXQgbXlGb2xkZXJVdWlkID0gdXVpZHY0KCk7XG4gICAgbGV0IHRhc2tzID0gW107XG5cbiAgICBjb25zdCBhZGRUYXNrID0gKG5ld1Rhc2tOYW1lKSA9PiB7XG4gICAgICAgIHRhc2tzLnB1c2gobmV3VGFza05hbWUpO1xuXG5cbiAgICAgICAgLy8gbG9jYWxTdG9yYWdlLnNldEl0ZW0obmV3VGFza05hbWUubXlUYXNrVXVpZCwgSlNPTi5zdHJpbmdpZnkobmV3VGFza05hbWUpKTtcbiAgICB9XG5cbiAgICBjb25zdCBkaXNwbGF5VGFza3MgPSAoKSA9PiB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGFza3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBUYXNrICR7aX0gLSAke3Rhc2tzW2ldLnRpdGxlfSwgJHt0YXNrc1tpXS5kdWVEYXRlfSwgJHt0YXNrc1tpXS5wcmlvcml0eX1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGRlbGV0ZVRhc2sgPSAodGFza05hbWUpID0+IHtcbiAgICAgICAgLy8gdGFza3Muc3BsaWNlKHRhc2tOYW1lLCAxKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IHRhc2tzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICBpZiAodGFza3NbaV0ubXlUYXNrVXVpZCA9PT0gdGFza05hbWUubXlUYXNrVXVpZCkge1xuICAgICAgICAgICAgICAgIHRhc2tzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4ge3RpdGxlLCB0YXNrcywgbXlGb2xkZXJVdWlkLCBhZGRUYXNrLCBkaXNwbGF5VGFza3MsIGRlbGV0ZVRhc2t9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gU3VwZXJGb2xkZXIoKSB7XG4gICAgbGV0IGZvbGRlcnMgPSBbXVxuXG4gICAgY29uc3QgYWRkRm9sZGVyID0gKG5ld0ZvbGRlck5hbWUpID0+IHtcbiAgICAgICAgZm9sZGVycy5wdXNoKG5ld0ZvbGRlck5hbWUpO1xuXG4gICAgICAgIC8vIGxvY2FsU3RvcmFnZS5zZXRJdGVtKG5ld0ZvbGRlck5hbWUubXlGb2xkZXJVdWlkLCBKU09OLnN0cmluZ2lmeShuZXdGb2xkZXJOYW1lKSk7XG4gICAgfVxuXG4gICAgY29uc3QgZGVsZXRlRm9sZGVyID0gKGZvbGRlck5hbWUpID0+IHtcbiAgICAgICAgZm9yIChsZXQgaSA9IGZvbGRlcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgICAgIGlmIChmb2xkZXJzW2ldLm15Rm9sZGVyVXVpZCA9PT0gZm9sZGVyTmFtZS5teUZvbGRlclV1aWQpIHtcbiAgICAgICAgICAgICAgICBmb2xkZXJzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGZvbGRlck5hbWUubXlGb2xkZXJVdWlkKTtcblxuICAgIH1cblxuICAgIHJldHVybiB7Zm9sZGVycywgYWRkRm9sZGVyLCBkZWxldGVGb2xkZXJ9XG59IiwiaW1wb3J0IHtcbiAgICBkaXNwbGF5Q3VycmVudEZvbGRlcldpdGhJZCxcbiAgICBkZWxldGVGb2xkZXJXaXRoSWQsXG4gICAgZGVsZXRlVGFza1dpdGhJZCxcbiAgICBjaGFuZ2VUYXNrU3RhdHVzLFxuICAgIGZpbmRUYXNrV2l0aElkLFxuICAgIGdldEVkaXREaWFsb2dcbn0gZnJvbSAnLi4vaW5kZXguanMnO1xuXG5cbi8vIENyZWF0ZSBhbGwgZWxlbWVudHMgZm9yIGVhY2ggdGFzayBwcm9wZXJ0eSBhbmQgY2hhbmdlIHRleHQgY29udGVudCB0byBjb3JyZXNwb25kaW5nIHZhbHVlXG4vLyBUaGVuIGFkZCB0aGVtIHRvIGEgbWFpbiBkaXYgYW5kIHJldHVyblxuZnVuY3Rpb24gY3JlYXRlVGFza0VsZW1lbnQodGFza05hbWUpIHtcbiAgICBjb25zdCB0YXNrRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29uc3QgdGFza1RpdGxlSW5EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgY29uc3QgdGFza0Rlc2NyaXB0aW9uSW5EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgY29uc3QgdGFza0R1ZURhdGVJbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBjb25zdCB0YXNrUHJpb3JpdHlJbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBcbiAgICB0YXNrRGl2LmNsYXNzTGlzdC5hZGQoJ3Rhc2stZGl2Jyk7XG4gICAgdGFza1RpdGxlSW5EaXYudGV4dENvbnRlbnQgPSB0YXNrTmFtZS50aXRsZTtcbiAgICB0YXNrRGVzY3JpcHRpb25JbkRpdi50ZXh0Q29udGVudCA9IHRhc2tOYW1lLmRlc2NyaXB0aW9uO1xuICAgIHRhc2tEdWVEYXRlSW5EaXYudGV4dENvbnRlbnQgPSB0YXNrTmFtZS5kdWVEYXRlO1xuICAgIHRhc2tQcmlvcml0eUluRGl2LnRleHRDb250ZW50ID0gdGFza05hbWUucHJpb3JpdHk7XG5cbiAgICB0YXNrRGl2LmFwcGVuZENoaWxkKHRhc2tUaXRsZUluRGl2KTtcbiAgICB0YXNrRGl2LmFwcGVuZENoaWxkKHRhc2tEZXNjcmlwdGlvbkluRGl2KTtcbiAgICB0YXNrRGl2LmFwcGVuZENoaWxkKHRhc2tEdWVEYXRlSW5EaXYpO1xuICAgIHRhc2tEaXYuYXBwZW5kQ2hpbGQodGFza1ByaW9yaXR5SW5EaXYpO1xuICAgIGNyZWF0ZVRhc2tEZWxldGVCdXR0b24odGFza0RpdikudmFsdWUgPSB0YXNrTmFtZS5teVRhc2tVdWlkO1xuICAgIGNyZWF0ZVRhc2tFZGl0QnV0dG9uKHRhc2tEaXYpLnZhbHVlID0gdGFza05hbWUubXlUYXNrVXVpZDtcbiAgICBjcmVhdGVUYXNrU3RhdHVzQnV0dG9uKHRhc2tEaXYpLnZhbHVlID0gdGFza05hbWUubXlUYXNrVXVpZDtcblxuICAgIHJldHVybiB0YXNrRGl2O1xufVxuXG4vLyBUYWtlIGluIHRhc2sgYW5kIHdoZXJlIHRvIGFwcGVuZFxuLy8gQ3JlYXRlIHRoZSB0YXNrIHVzaW5nIGNyZWF0ZVRhc2tFbGVtZW50IGFuZCBhc3NpZ24gdG8gdmFyaWFibGVcbi8vIFRhcmdldCBlbGVtZW50IHRvIGFwcGVuZCB0byBhbmQgYXBwZW5kXG5mdW5jdGlvbiBhcHBlbmRUYXNrKHRhc2tOYW1lLCBsb2NhdGlvbikge1xuICAgIGxldCB0YXNrRE9NID0gY3JlYXRlVGFza0VsZW1lbnQodGFza05hbWUpO1xuXG4gICAgY29uc3QgbG9jYXRpb25ET00gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsb2NhdGlvbik7XG4gICAgbG9jYXRpb25ET00uYXBwZW5kQ2hpbGQodGFza0RPTSk7XG59XG5cbi8vIFRha2UgaW4gZm9sZGVyIG5hbWUgdGhlbiBsb29wIHRocm91Z2ggdGFza3MgaW5zaWRlIGZvbGRlciB0byBhcHBlbmQgdG8gc2NyZWVuXG5mdW5jdGlvbiBkaXNwbGF5Rm9sZGVyVGFza3MoZm9sZGVyTmFtZSkge1xuICAgIGZvbGRlck5hbWUudGFza3MuZm9yRWFjaCh0YXNrID0+IHtcbiAgICAgICAgYXBwZW5kVGFzayh0YXNrLCBbJ3Rhc2stY29udGFpbmVyJ10pO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRUYXNrRm9ybUluZm8oKSB7XG4gICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLWZvcm0nKTtcblxuICAgIGNvbnN0IHRhc2tUaXRsZUluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stdGl0bGUnXTtcbiAgICBjb25zdCB0YXNrRGVzY3JpcHRpb25JbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLWRlc2NyaXB0aW9uJ107XG4gICAgY29uc3QgdGFza0R1ZURhdGVJbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLWR1ZS1kYXRlJ107XG4gICAgY29uc3QgdGFza1ByaW9yaXR5SW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay1wcmlvcml0eSddO1xuICAgIFxuICAgIGxldCB0YXNrVGl0bGUgPSB0YXNrVGl0bGVJbkZvcm0udmFsdWU7XG4gICAgbGV0IHRhc2tEZXNjcmlwdGlvbiA9IHRhc2tEZXNjcmlwdGlvbkluRm9ybS52YWx1ZTtcbiAgICBsZXQgdGFza0R1ZURhdGUgPSB0YXNrRHVlRGF0ZUluRm9ybS52YWx1ZTtcbiAgICBsZXQgdGFza1ByaW9yaXR5ID0gdGFza1ByaW9yaXR5SW5Gb3JtLnZhbHVlO1xuXG4gICAgcmV0dXJuIHt0YXNrVGl0bGUsIHRhc2tEZXNjcmlwdGlvbiwgdGFza0R1ZURhdGUsIHRhc2tQcmlvcml0eX07XG59IFxuXG5mdW5jdGlvbiBnZXRUYXNrRWRpdEZvcm1JbmZvKCkge1xuICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdC1mb3JtJyk7XG5cbiAgICBjb25zdCB0YXNrVGl0bGVJbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLXRpdGxlJ107XG4gICAgY29uc3QgdGFza0Rlc2NyaXB0aW9uSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay1kZXNjcmlwdGlvbiddO1xuICAgIGNvbnN0IHRhc2tEdWVEYXRlSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay1kdWUtZGF0ZSddO1xuICAgIGNvbnN0IHRhc2tQcmlvcml0eUluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stcHJpb3JpdHknXTtcbiAgICBcbiAgICBsZXQgdGFza1RpdGxlID0gdGFza1RpdGxlSW5Gb3JtLnZhbHVlO1xuICAgIGxldCB0YXNrRGVzY3JpcHRpb24gPSB0YXNrRGVzY3JpcHRpb25JbkZvcm0udmFsdWU7XG4gICAgbGV0IHRhc2tEdWVEYXRlID0gdGFza0R1ZURhdGVJbkZvcm0udmFsdWU7XG4gICAgbGV0IHRhc2tQcmlvcml0eSA9IHRhc2tQcmlvcml0eUluRm9ybS52YWx1ZTtcblxuICAgIHJldHVybiB7dGFza1RpdGxlLCB0YXNrRGVzY3JpcHRpb24sIHRhc2tEdWVEYXRlLCB0YXNrUHJpb3JpdHl9O1xufSBcblxuLy8gQ3JlYXRlIGJ1dHRvbiB0byBob2xkIGZvbGRlciBhbmQgdGl0bGVcbi8vIEFkZCB0aXRsZSB0byBkaXYgYW5kIHJldHVyblxuZnVuY3Rpb24gY3JlYXRlRm9sZGVyQnV0dG9uKGZvbGRlck5hbWUpIHtcbiAgICBjb25zdCBzaWRlYmFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNpZGViYXInKTtcbiAgICBjb25zdCBmb2xkZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb25zdCBmb2xkZXJCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblxuICAgIGZvbGRlckRpdi5jbGFzc0xpc3QuYWRkKCdmb2xkZXItZGl2Jyk7XG4gICAgZm9sZGVyQnRuLmNsYXNzTGlzdC5hZGQoJ2ZvbGRlci1idXR0b24nKTtcbiAgICBmb2xkZXJCdG4udGV4dENvbnRlbnQgPSBmb2xkZXJOYW1lLnRpdGxlO1xuICAgIGZvbGRlckJ0bi52YWx1ZSA9IGZvbGRlck5hbWUubXlGb2xkZXJVdWlkO1xuXG4gICAgZm9sZGVyRGl2LmFwcGVuZENoaWxkKGZvbGRlckJ0bik7XG4gICAgXG4gICAgLy8gQ3JlYXRlIHRoZSBkZWwgYnRuIGFuZCAgYXNzaWduIHNhbWUgaWQgYXMgZm9sZGVyIHRvIGl0XG4gICAgY3JlYXRlRm9sZGVyRGVsZXRlQnV0dG9uKGZvbGRlckRpdikudmFsdWUgPSBmb2xkZXJOYW1lLm15Rm9sZGVyVXVpZDtcblxuICAgIHNpZGViYXIuYXBwZW5kQ2hpbGQoZm9sZGVyRGl2KTtcblxuICAgIGZvbGRlckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBsZXQgY3VycmVudEZvbGRlcklkID0gZm9sZGVyTmFtZS5teUZvbGRlclV1aWQ7XG4gICAgICAgIGRpc3BsYXlDdXJyZW50Rm9sZGVyV2l0aElkKGZvbGRlck5hbWUubXlGb2xkZXJVdWlkKTtcbiAgICAgICAgY29uc29sZS5sb2coZm9sZGVyTmFtZS50aXRsZSwgZm9sZGVyTmFtZS5teUZvbGRlclV1aWQpO1xuICAgICAgICByZXR1cm4gY3VycmVudEZvbGRlcklkO1xuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiBmb2xkZXJEaXY7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUZvbGRlckRlbGV0ZUJ1dHRvbihmb2xkZXIpIHtcbiAgICBjb25zdCBmb2xkZXJEZWxldGVCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblxuICAgIGZvbGRlckRlbGV0ZUJ0bi5jbGFzc0xpc3QuYWRkKCdmb2xkZXItZGVsZXRlLWJ0bicpO1xuICAgIGZvbGRlckRlbGV0ZUJ0bi50ZXh0Q29udGVudCA9ICctJztcblxuICAgIGZvbGRlci5hcHBlbmRDaGlsZChmb2xkZXJEZWxldGVCdG4pO1xuXG4gICAgZm9sZGVyRGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBsZXQgdGhpc0J1dHRvbiA9IGUudGFyZ2V0O1xuICAgICAgICBkZWxldGVGb2xkZXJXaXRoSWQodGhpc0J1dHRvbi52YWx1ZSk7XG4gICAgICAgIHRoaXNCdXR0b24ucGFyZW50Tm9kZS5yZW1vdmUoKTtcbiAgICB9KVxuXG4gICAgcmV0dXJuIGZvbGRlckRlbGV0ZUJ0bjtcbn1cblxuZnVuY3Rpb24gY3JlYXRlVGFza0RlbGV0ZUJ1dHRvbih0YXNrKSB7XG4gICAgY29uc3QgdGFza0RlbGV0ZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXG4gICAgdGFza0RlbGV0ZUJ0bi5jbGFzc0xpc3QuYWRkKCd0YXNrLWRlbGV0ZS1idG4nKTtcbiAgICB0YXNrRGVsZXRlQnRuLnRleHRDb250ZW50ID0gJy0nO1xuXG4gICAgdGFzay5hcHBlbmRDaGlsZCh0YXNrRGVsZXRlQnRuKTtcblxuICAgIHRhc2tEZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGxldCB0aGlzQnV0dG9uID0gZS50YXJnZXQ7XG4gICAgICAgIGRlbGV0ZVRhc2tXaXRoSWQodGhpc0J1dHRvbi52YWx1ZSk7XG4gICAgICAgIHRoaXNCdXR0b24ucGFyZW50Tm9kZS5yZW1vdmUoKTtcbiAgICB9KVxuXG4gICAgcmV0dXJuIHRhc2tEZWxldGVCdG47XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVRhc2tFZGl0QnV0dG9uKHRhc2spIHtcbiAgICBjb25zdCB0YXNrRWRpdEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXG4gICAgdGFza0VkaXRCdG4uY2xhc3NMaXN0LmFkZCgndGFzay1lZGl0LWJ0bicpO1xuICAgIHRhc2tFZGl0QnRuLnRleHRDb250ZW50ID0gJysnO1xuXG4gICAgdGFzay5hcHBlbmRDaGlsZCh0YXNrRWRpdEJ0bik7XG5cbiAgICB0YXNrRWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgLy8gQ3JlYXRlIGEgYnV0dG9uIHRvIGhvbGQgSWQgdmFsdWVcbiAgICAgICAgY29uc3QgZWRpdEZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdC1mb3JtJyk7XG4gICAgICAgIGNvbnN0IGJ0bkZvcklkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG5cbiAgICAgICAgYnRuRm9ySWQuY2xhc3NMaXN0LmFkZCgnZWRpdC1idG4taWQnKTtcbiAgICAgICAgYnRuRm9ySWQudmFsdWUgPSBlLnRhcmdldC52YWx1ZVxuICAgICAgICBlZGl0Rm9ybS5hcHBlbmRDaGlsZChidG5Gb3JJZCk7XG5cbiAgICAgICAgLy8gQ2hhbmdlIGZvcm0gZmllbGRzIHRvIHRhc2sgaW5mbyBhbmQgb3BlbiBtb2RhbFxuICAgICAgICBjaGFuZ2VUYXNrRm9ybUZpZWxkcyhmaW5kVGFza1dpdGhJZChlLnRhcmdldC52YWx1ZSkpO1xuICAgICAgICBnZXRFZGl0RGlhbG9nKCkuc2hvd01vZGFsKCk7XG4gICAgfSlcblxuICAgIHJldHVybiB0YXNrRWRpdEJ0bjtcbn1cblxuZnVuY3Rpb24gY2hhbmdlVGFza0Zvcm1GaWVsZHModGFzaykge1xuICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdC1mb3JtJyk7XG5cbiAgICBjb25zdCB0YXNrVGl0bGVJbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLXRpdGxlJ107XG4gICAgY29uc3QgdGFza0Rlc2NyaXB0aW9uSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay1kZXNjcmlwdGlvbiddO1xuICAgIGNvbnN0IHRhc2tEdWVEYXRlSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay1kdWUtZGF0ZSddO1xuICAgIGNvbnN0IHRhc2tQcmlvcml0eUluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stcHJpb3JpdHknXTtcblxuICAgIHRhc2tUaXRsZUluRm9ybS52YWx1ZSA9IHRhc2sudGl0bGU7XG4gICAgdGFza0Rlc2NyaXB0aW9uSW5Gb3JtLnZhbHVlID0gdGFzay5kZXNjcmlwdGlvbjtcbiAgICB0YXNrRHVlRGF0ZUluRm9ybS52YWx1ZSA9IHRhc2suZHVlRGF0ZTtcbiAgICB0YXNrUHJpb3JpdHlJbkZvcm0udmFsdWUgPSB0YXNrLnByaW9yaXR5O1xufSBcblxuZnVuY3Rpb24gY3JlYXRlVGFza1N0YXR1c0J1dHRvbih0YXNrKSB7XG4gICAgY29uc3QgdGFza1N0YXR1c0J0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXG4gICAgdGFza1N0YXR1c0J0bi5jbGFzc0xpc3QuYWRkKCd0YXNrLXN0YXR1cy1idG4nKTtcbiAgICB0YXNrU3RhdHVzQnRuLnRleHRDb250ZW50ID0gJ+KclCc7XG5cbiAgICB0YXNrLmFwcGVuZENoaWxkKHRhc2tTdGF0dXNCdG4pO1xuXG4gICAgdGFza1N0YXR1c0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgbGV0IHRoaXNCdXR0b24gPSBlLnRhcmdldDtcbiAgICAgICAgY2hhbmdlVGFza1N0YXR1cyh0aGlzQnV0dG9uLnZhbHVlKTtcbiAgICAgICAgdG9nZ2xlQ29tcGxldGVTdHlsZSh0aGlzQnV0dG9uKTtcbiAgICB9KVxuXG4gICAgcmV0dXJuIHRhc2tTdGF0dXNCdG47XG59XG5cbmZ1bmN0aW9uIHRvZ2dsZUNvbXBsZXRlU3R5bGUoZWxlbWVudCkge1xuICAgIGlmICghZWxlbWVudC5wYXJlbnROb2RlLmNsYXNzTGlzdC5jb250YWlucygnY29tcGxldGUtdGFzaycpKSB7XG4gICAgICAgIGVsZW1lbnQucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZS10YXNrJylcbiAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY29tcGxldGUtdGFzaycpO1xuICAgIH1cbn1cblxuLy8gVGFrZSBpbiBmb2xkZXIgbmFtZSBhbmQgY3JlYXRlIGZvbGRlciB1c2luZyBmdW5jdGlvblxuLy8gQXBwZW5kIHRvIHNpZGViYXJcbmZ1bmN0aW9uIGFwcGVuZEZvbGRlcihmb2xkZXJOYW1lKSB7XG4gICAgbGV0IGZvbGRlckRPTSA9IGNyZWF0ZUZvbGRlckJ1dHRvbihmb2xkZXJOYW1lKTtcbiAgICBcbiAgICBjb25zdCBzaWRlYmFyRm9sZGVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaWRlYmFyJyk7XG4gICAgc2lkZWJhckZvbGRlcnMuYXBwZW5kQ2hpbGQoZm9sZGVyRE9NKTtcbn1cblxuLy8gVGFrZSBpbiBzdXBlciBmb2xkZXIgbmFtZSB0byBsb29wIHRocm91Z2ggZWFjaCBmb2xkZXIgYW5kIGFwcGVuZCB0byBzaWRlYmFyXG5mdW5jdGlvbiBkaXNwbGF5Rm9sZGVycyhzdXBlckZvbGRlck5hbWUpIHtcbiAgICAvLyBjbGVhclNpZGViYXIoKTtcbiAgICBzdXBlckZvbGRlck5hbWUuZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgICAgIGFwcGVuZEZvbGRlcihmb2xkZXIpO1xuICAgIH0pO1xufVxuXG5cbmZ1bmN0aW9uIGdldEZvbGRlckZvcm1JbmZvKCkge1xuICAgIGNvbnN0IGZvbGRlckZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVyLWZvcm0nKTtcblxuICAgIGNvbnN0IGZvbGRlclRpdGxlSW5Gb3JtID0gZm9sZGVyRm9ybS5lbGVtZW50c1snZm9sZGVyLXRpdGxlJ10udmFsdWU7XG5cbiAgICByZXR1cm4ge2ZvbGRlckZvcm0sIGZvbGRlclRpdGxlSW5Gb3JtfTtcbn1cblxuZnVuY3Rpb24gY2xlYXJUYXNrQ29udGFpbmVyKCkge1xuICAgIGNvbnN0IHRhc2tDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1jb250YWluZXInKTtcblxuICAgIHRhc2tDb250YWluZXIudGV4dENvbnRlbnQgPSAnJztcbn1cblxuZnVuY3Rpb24gYXBwZW5kRHJvcGRvd24oc3VwZXJGb2xkZXIpIHtcblxuICAgIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXItc2VsZWN0aW9uJyk7XG5cbiAgICBjbGVhclNlbGVjdE1lbnUoc2VsZWN0KTtcblxuICAgIHN1cGVyRm9sZGVyLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICAgICAgXG4gICAgICAgIG9wdGlvbi50ZXh0Q29udGVudCA9IGZvbGRlci50aXRsZTtcbiAgICAgICAgb3B0aW9uLnZhbHVlID0gZm9sZGVyLm15Rm9sZGVyVXVpZDsgLy8gZmlndXJlIG91dCBpZiB0aGlzIGlzIGdvb2Qgd2F5IHRvIHNlbGVjdFxuICAgICAgICAvLyBvcHRpb24uc2V0QXR0cmlidXRlKCdpbmRleCcsIGluZGV4KyspO1xuXG4gICAgICAgIHNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pO1xuICAgIH0pXG59XG5cbmZ1bmN0aW9uIGNsZWFyU2VsZWN0TWVudShzZWxlY3RPcHRpb24pIHtcbiAgICBmb3IgKGxldCBpID0gc2VsZWN0T3B0aW9uLm9wdGlvbnMubGVuZ3RoOyBpID49IDA7IGktLSkge1xuICAgICAgICBzZWxlY3RPcHRpb24ucmVtb3ZlKDApO1xuICAgIH1cbn1cblxuZXhwb3J0IHtcbiAgICBnZXRUYXNrRm9ybUluZm8sXG4gICAgZ2V0VGFza0VkaXRGb3JtSW5mbyxcbiAgICBnZXRGb2xkZXJGb3JtSW5mbyxcbiAgICBjcmVhdGVUYXNrRWxlbWVudCxcbiAgICBjcmVhdGVGb2xkZXJCdXR0b24sXG4gICAgYXBwZW5kRm9sZGVyLFxuICAgIGRpc3BsYXlGb2xkZXJUYXNrcyxcbiAgICBhcHBlbmRUYXNrLFxuICAgIGRpc3BsYXlGb2xkZXJzLFxuICAgIGNsZWFyVGFza0NvbnRhaW5lcixcbiAgICBhcHBlbmREcm9wZG93bixcbiAgICBjbGVhclNlbGVjdE1lbnUsXG59IiwiaW1wb3J0IHtcbiAgICBUYXNrLFxuICAgIEZvbGRlcixcbiAgICBTdXBlckZvbGRlclxufSBmcm9tICcuL21vZHVsZXMvZmFjdG9yaWVzLmpzJztcblxuaW1wb3J0IHtcbiAgICBnZXRUYXNrRm9ybUluZm8sXG4gICAgZ2V0VGFza0VkaXRGb3JtSW5mbyxcbiAgICBnZXRGb2xkZXJGb3JtSW5mbyxcbiAgICBhcHBlbmRGb2xkZXIsXG4gICAgZGlzcGxheUZvbGRlclRhc2tzLFxuICAgIGNsZWFyVGFza0NvbnRhaW5lcixcbiAgICBhcHBlbmREcm9wZG93bixcbiAgICBjcmVhdGVGb2xkZXJCdXR0b24sXG4gICAgZGlzcGxheUZvbGRlcnNcblxufSBmcm9tICcuL21vZHVsZXMvZG9tLmpzJztcblxuaW1wb3J0IHsgZm9ybWF0RGlzdGFuY2UsIHN1YkRheXMgfSBmcm9tIFwiZGF0ZS1mbnNcIjtcblxuXG4vL1N1cGVyIEZvbGRlciBcbmNvbnN0IHN1cGVyRm9sZGVyID0gU3VwZXJGb2xkZXIoKTtcblxuLy8gT3BlbiB0YXNrIG1vZGFsIHdoZW4gY2xpY2tlZFxuY29uc3Qgb3BlblRhc2tNb2RhbEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVuLXRhc2stbW9kYWwtYnRuJyk7XG5vcGVuVGFza01vZGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgZ2V0VGFza0RpYWxvZygpLnJlc2V0O1xuICAgIGdldFRhc2tEaWFsb2coKS5zaG93TW9kYWwoKTtcbiAgICBhcHBlbmREcm9wZG93bihzdXBlckZvbGRlcik7XG59KTtcblxuLy8gR2V0IHRhc2sgZGlhbG9nIGFuZCByZXR1cm4gXG5mdW5jdGlvbiBnZXRUYXNrRGlhbG9nKCkge1xuICAgIGNvbnN0IHRhc2tEaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1kaWFsb2cnKTtcblxuICAgIHJldHVybiB0YXNrRGlhbG9nO1xufVxuXG5mdW5jdGlvbiBnZXRFZGl0RGlhbG9nKCkge1xuICAgIGNvbnN0IGVkaXREaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdC1kaWFsb2cnKTtcblxuICAgIHJldHVybiBlZGl0RGlhbG9nO1xufVxuXG4vLyBPcGVuIGZvbGRlciBtb2RhbCB3aGVuIGNsaWNrZWRcbmNvbnN0IGFkZEZvbGRlckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXItYWRkLWJ0bicpO1xuYWRkRm9sZGVyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgXG4gICAgY29uc3QgZm9sZGVyRGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlci1kaWFsb2cnKTtcbiAgICBmb2xkZXJEaWFsb2cuc2hvd01vZGFsKCk7XG4gICAgXG59KTtcblxuLy8gRXZlbnQgbGlzdGVuZXIgdG8gc3VibWl0IGZvbGRlciBmb3JtXG4vLyBDcmVhdGUgYSBuZXcgZm9sZGVyIGluc3RhbmNlIHdpdGggaW5mbyBmcm9tIGZvcm1cbi8vIEFkZCB0byBET01cbi8vIEFkZCB0byBzdXBlciBmb2xkZXJcbi8vIFNob3VsZCBiZSBkb25lIG9uIHRoZSBmb3JtIGluc3RlYWQgb2YgYnV0dG9uIGJ1dCBNRE4gZXhhbXBsZSB3aXRoIGRpYWxvZyBkaWQgaXQgdGhpcyB3YXlcbmNvbnN0IGZvbGRlclN1Ym1pdEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXItY29uZmlybS1idG4nKTtcbmZvbGRlclN1Ym1pdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgXG4gICAgY29uc3QgZm9sZGVyRGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlci1kaWFsb2cnKTtcbiAgICBjb25zdCB7Zm9sZGVyVGl0bGVJbkZvcm19ID0gZ2V0Rm9sZGVyRm9ybUluZm8oKTtcblxuICAgIGxldCBuZXdGb2xkZXIgPSBGb2xkZXIoZm9sZGVyVGl0bGVJbkZvcm0pO1xuICAgIGFwcGVuZEZvbGRlcihuZXdGb2xkZXIpO1xuXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2ZvbGRlcnMnLCBKU09OLnN0cmluZ2lmeShuZXdGb2xkZXIpKTtcblxuICAgIC8vIHNhdmVGb2xkZXJUb1N0b3JhZ2UobmV3Rm9sZGVyKTtcbiAgICBcbiAgICBzdXBlckZvbGRlci5hZGRGb2xkZXIobmV3Rm9sZGVyKTtcblxuICAgIGZvbGRlckRpYWxvZy5jbG9zZSgpO1xuXG4gICAgLy8gcmV0dXJuIGZvbGRlcktleUlkO1xufSk7XG5cbmNvbnN0IHRhc2tBZGRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1hZGQtYnRuJyk7XG4vLyBDcmVhdGUgbmV3IHRhc2sgaW5zdGFuY2UgdXNpbmcgaW5mbyBmcm9tIGZvcm1cbnRhc2tBZGRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgLy8gR2V0IHZhbHVlIG9mIHRoZSBzZWxlY3RlZCBmaWVsZCAoSWQgYmVjYXVzZSB2YWx1ZSBpcyBzZXQgdG8gaWQgaW4gZG9tLmpzKVxuICAgIGNvbnN0IHNlbGVjdGVkRm9sZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlci1zZWxlY3Rpb24nKTtcbiAgICBjb25zdCBzZWxlY3RlZEZvbGRlclZhbHVlID0gc2VsZWN0ZWRGb2xkZXIudmFsdWU7XG4gICAgLy8gR2V0IHZhbHVlcyBvZiB0aGUgZm9ybVxuICAgIGNvbnN0IHt0YXNrVGl0bGUsIHRhc2tEZXNjcmlwdGlvbiwgdGFza0R1ZURhdGUsIHRhc2tQcmlvcml0eX0gPSBnZXRUYXNrRm9ybUluZm8oKTtcblxuICAgIC8vIENyZWF0ZSBuZXcgdGFzayBhbmQgbG9vcCB0aHJvdWdoIGZvbGRlciB0byBmaW5kIG1hdGNoaW5nIElkIGFuZCBhZGRcbiAgICBjb25zdCBuZXdUYXNrID0gVGFzayh0YXNrVGl0bGUsIHRhc2tEZXNjcmlwdGlvbiwgdGFza0R1ZURhdGUsIHRhc2tQcmlvcml0eSk7XG4gICAgc3VwZXJGb2xkZXIuZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgICAgIGlmIChzZWxlY3RlZEZvbGRlclZhbHVlID09PSBmb2xkZXIubXlGb2xkZXJVdWlkKSB7XG4gICAgICAgICAgICBmb2xkZXIuYWRkVGFzayhuZXdUYXNrKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsb2NhbFN0b3JhZ2UubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IGtleSA9IChsb2NhbFN0b3JhZ2Uua2V5KGkpKTtcbiAgICAgICAgY29uc29sZS5sb2coa2V5KTtcblxuICAgICAgICBsZXQgbHNGb2xkZXIgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkpO1xuXG4gICAgICAgIGlmIChsc0ZvbGRlci5teUZvbGRlclV1aWQgPT09IHNlbGVjdGVkRm9sZGVyVmFsdWUpIHtcbiAgICAgICAgICAgIGxldCB0aGlzRm9sZGVyID0gZmluZEZvbGRlcldpdGhJZChzZWxlY3RlZEZvbGRlclZhbHVlKTtcbiAgICAgICAgICAgIGxldCByZWNyZWF0ZWRGb2xkZXIgPSByZWNyZWF0ZUZvbGRlck9iaihsc0ZvbGRlciwgdGhpc0ZvbGRlcik7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlY3JlYXRlZEZvbGRlcik7XG4gICAgICAgICAgICByZWNyZWF0ZWRGb2xkZXIuYWRkVGFzayh0YXNrMSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBzYXZlVGFza1RvU3RvcmFnZShuZXdUYXNrKTtcbiAgICBcbiAgICAvLyBVcGRhdGUgdGhlIHRhc2tzIG9mIHRoZSBmb2xkZXIgdGhhdCBpcyBjdXJyZW50bHkgYmVpbmcgZGlzcGxheWVkIHRvIGF2b2lkIHJlbG9hZGluZyBmb2xkZXJcbiAgICBkaXNwbGF5Q3VycmVudEZvbGRlcldpdGhJZChzZWxlY3RlZEZvbGRlclZhbHVlKTtcbiAgICBcbiAgICAvLyBDbGVhciBmb3JtIGZpZWxkc1xuICAgIGNvbnN0IHRhc2tGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tZm9ybScpO1xuICAgIHRhc2tGb3JtLnJlc2V0KCk7XG4gICAgZ2V0VGFza0RpYWxvZygpLmNsb3NlKCk7XG59KVxuXG5mdW5jdGlvbiBmaW5kRm9sZGVyV2l0aElkKGJ1dHRvbklkKSB7XG4gICAgc3VwZXJGb2xkZXIuZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgICAgIGlmIChidXR0b25JZCA9PT0gZm9sZGVyLm15Rm9sZGVyVXVpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZvbGRlcjtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG4vLyBTZWxlY3QgdGhlIGJ1dHRvbiB3aXRoIElkIGFuZCBmaW5kIHRhc2sgd2l0aCB0aGF0IElkXG4vLyBDaGFuZ2UgdGhlIGluZm8gb2YgdGhhdCB0YXNrIGFuZCB1cGRhdGUgZm9sZGVyXG4vLyBEZWxldGUgYnV0dG9uIGFmdGVyIGFuZCBjbG9zZVxuY29uc3QgdGFza0VkaXRDb25maXJtQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2stZWRpdC1idG4nKTtcbnRhc2tFZGl0Q29uZmlybUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgXG4gICAgXG4gICAgY29uc3QgYnRuSWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZWRpdC1idG4taWQnKTtcbiAgICBcbiAgICBjb25zdCB7dGFza1RpdGxlLCB0YXNrRGVzY3JpcHRpb24sIHRhc2tEdWVEYXRlLCB0YXNrUHJpb3JpdHl9ID0gZ2V0VGFza0VkaXRGb3JtSW5mbygpO1xuICAgIFxuICAgIHN1cGVyRm9sZGVyLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBmb2xkZXIudGFza3MuZm9yRWFjaCh0YXNrID0+IHtcbiAgICAgICAgICAgIGlmIChidG5JZC52YWx1ZSA9PT0gdGFzay5teVRhc2tVdWlkKSB7XG4gICAgICAgICAgICAgICAgdGFzay5lZGl0VGFzayh0YXNrVGl0bGUsIHRhc2tEZXNjcmlwdGlvbiwgdGFza0R1ZURhdGUsIHRhc2tQcmlvcml0eSk7XG4gICAgICAgICAgICAgICAgZGlzcGxheUN1cnJlbnRGb2xkZXJXaXRoSWQoZm9sZGVyLm15Rm9sZGVyVXVpZCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codGFzayk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSk7XG4gICAgXG4gICAgYnRuSWQucmVtb3ZlKCk7XG4gICAgZ2V0RWRpdERpYWxvZygpLmNsb3NlKCk7XG4gICAgXG59KVxuXG4vLyBUZXN0IHRhc2tzXG5jb25zdCB0YXNrMSA9IFRhc2soJ2Nob3JlcycsICd3YXNoIGRpc2hlcycsICdub3YgMjMnLCAnaGlnaCcpO1xuY29uc3QgdGFzazIgPSBUYXNrKCdtb3ZpZXMnLCAnYXZhdGFyJywgJ25vdiAyOScsICdtZWQnKTtcbmNvbnN0IHRhc2szID0gVGFzaygnY29kaW5nJywgJ3RvZG8gbGlzdCcsICdkZWMgMTAnLCAnbG93Jyk7XG5cbmxldCBpbmJveEZvbGRlciA9IEZvbGRlcignSW5ib3gnKTtcbmluYm94Rm9sZGVyLmFkZFRhc2sodGFzazEpO1xuc3VwZXJGb2xkZXIuYWRkRm9sZGVyKGluYm94Rm9sZGVyKTtcbmFwcGVuZEZvbGRlcihpbmJveEZvbGRlcik7XG5cbmxldCB0ZXN0Rm9sZGVyMiA9IEZvbGRlcigndGVzdDInKTtcbnRlc3RGb2xkZXIyLmFkZFRhc2sodGFzazIpO1xudGVzdEZvbGRlcjIuYWRkVGFzayh0YXNrMSk7XG50ZXN0Rm9sZGVyMi5hZGRUYXNrKHRhc2szKTtcbnRlc3RGb2xkZXIyLmRlbGV0ZVRhc2sodGFzazIpO1xuc3VwZXJGb2xkZXIuYWRkRm9sZGVyKHRlc3RGb2xkZXIyKTtcbi8vIHN1cGVyRm9sZGVyLmRlbGV0ZUZvbGRlcih0ZXN0Rm9sZGVyMik7XG5hcHBlbmRGb2xkZXIodGVzdEZvbGRlcjIpO1xuXG5mdW5jdGlvbiBsb2FkUHJlc2V0Rm9sZGVycygpIHtcbiAgICAvLyBPbGQgbWV0aG9kIG9mIHN0b3JpbmcgYnkgdW5pcXVlIElkc1xuICAgIC8vIGlmIChsb2NhbFN0b3JhZ2UubGVuZ3RoID49IDApIHtcbiAgICAvLyAgICAgc3VwZXJGb2xkZXIuZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgLy8gICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZm9sZGVycycsIEpTT04uc3RyaW5naWZ5KGZvbGRlcikpO1xuICAgIC8vICAgICAgICAgLy8gZm9sZGVyLnRhc2tzLmZvckVhY2godGFzayA9PiB7XG5cbiAgICAvLyAgICAgICAgIC8vICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0YXNrLm15VGFza1V1aWQsIEpTT04uc3RyaW5naWZ5KHRhc2spKTtcbiAgICAvLyAgICAgICAgIC8vIH0pXG4gICAgLy8gICAgIH0pXG4gICAgLy8gfVxuICAgIC8vIFN0b3JlcyB1bmRlciBvbmUga2V5XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2ZvbGRlcnMnLCBKU09OLnN0cmluZ2lmeShzdXBlckZvbGRlcikpO1xuICAgIGNvbnNvbGUubG9nKEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2ZvbGRlcnMnKSkpO1xufVxuXG5sb2FkUHJlc2V0Rm9sZGVycygpO1xuXG5mdW5jdGlvbiByZWNyZWF0ZVRhc2tPYmoodGFyZ2V0T2JqLCByZXBsYWNlbWVudE9iaikge1xuICAgIGNvbnN0IHt0aXRsZSwgZGVzY3JpcHRpb24sIGR1ZURhdGUsIHByaW9yaXR5LCBteVRhc2tVdWlkfSA9IHRhcmdldE9iajtcblxuICAgIHJlcGxhY2VtZW50T2JqID0gVGFzayh0aXRsZSwgZGVzY3JpcHRpb24sIGR1ZURhdGUsIHByaW9yaXR5LCBteVRhc2tVdWlkKTtcbiAgICByZXR1cm4gcmVwbGFjZW1lbnRPYmo7XG59XG5cbmZ1bmN0aW9uIHJlY3JlYXRlRm9sZGVyT2JqKHRhcmdldE9iaiwgcmVwbGFjZW1lbnRPYmopIHtcbiAgICBjb25zdCB7dGl0bGUsICBteUZvbGRlclV1aWR9ID0gdGFyZ2V0T2JqO1xuXG4gICAgcmVwbGFjZW1lbnRPYmogPSBUYXNrKHRpdGxlLCBteUZvbGRlclV1aWQpO1xuICAgIHJldHVybiByZXBsYWNlbWVudE9iajtcbn1cblxuZnVuY3Rpb24gYWRkTHNJdGVtKG9iamVjdCkge1xuICAgIGxldCBhbGxGb2xkZXJzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZm9sZGVycycpKSB8fCBbXTtcblxuXG59XG5cbi8vIGxldCB0ZXN0VGFzayA9IFRhc2soJ1NPTUVUSElORycsICdERVNDJywgbmV3IERhdGUoKSwgJ0hJR0gnKTtcbi8vIGNvbnNvbGUubG9nKHRlc3RUYXNrKTtcbi8vIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRlc3RUYXNrLm15VGFza1V1aWQsIEpTT04uc3RyaW5naWZ5KHRlc3RUYXNrKSk7XG4vLyBjb25zb2xlLmxvZyhKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRlc3RUYXNrLm15VGFza1V1aWQpKSk7XG4vLyBsZXQgbHNUYXNrID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0ZXN0VGFzay5teVRhc2tVdWlkKSk7XG4vLyB0ZXN0VGFzay5yZWNyZWF0ZVRhc2tPYmoobHNUYXNrLCB0ZXN0VGFzayk7XG4vLyBsZXQgcmVjcmVhdGVkVGFzayA9IHJlY3JlYXRlVGFza09iaihsc1Rhc2ssIHRlc3RUYXNrKTtcbi8vIHJlY3JlYXRlZFRhc2suY2hhbmdlUHJpb3JpdHkoJ2xvdycpO1xuLy8gY29uc29sZS5sb2cocmVjcmVhdGVkVGFzayk7XG5cblxuZnVuY3Rpb24gc2F2ZUZvbGRlclRvU3RvcmFnZShmb2xkZXIpIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZm9sZGVyJysgZm9sZGVyLm15Rm9sZGVyVXVpZCwgSlNPTi5zdHJpbmdpZnkoZm9sZGVyKSk7XG59XG5cbmZ1bmN0aW9uIHNhdmVUYXNrVG9TdG9yYWdlKHRhc2spIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndGFzaycrIHRhc2subXlUYXNrVXVpZCwgSlNPTi5zdHJpbmdpZnkodGFzaykpO1xufVxuXG4vLyBHbyB0aHJvdWdoIGFsbCBmb2xkZXJzIGFuZCBjaGVjayBpZiB0aGUgY2xpY2tlZCBidXR0b24gdmFsdWUgbWF0Y2hlcyBmb2xkZXIgdmFsdWVcbi8vIHRoZW4gZGlzcGxheSB0YXNrcyBvZiB0aGF0IGZvbGRlciB0byBzY3JlZW5cbmZ1bmN0aW9uIGRpc3BsYXlDdXJyZW50Rm9sZGVyV2l0aElkKHRlbXBJZCkge1xuXG4gICAgc3VwZXJGb2xkZXIuZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgICAgIGlmICh0ZW1wSWQgPT09IGZvbGRlci5teUZvbGRlclV1aWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGFza0NvbnRhaW5lcigpO1xuICAgICAgICAgICAgLy9kaXNwbGF5IGFsbCB0YXNrcyBvZiB0aGlzIGZvbGRlciB0byBwYWdlXG4gICAgICAgICAgICBkaXNwbGF5Rm9sZGVyVGFza3MoZm9sZGVyKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibWF0Y2ggZm91bmRcIik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZGVsZXRlRm9sZGVyV2l0aElkKGJ1dHRvbklkKSB7XG4gICAgc3VwZXJGb2xkZXIuZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgICAgIGlmIChidXR0b25JZCA9PT0gZm9sZGVyLm15Rm9sZGVyVXVpZCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYnV0dG9uSWQpO1xuICAgICAgICAgICAgc3VwZXJGb2xkZXIuZGVsZXRlRm9sZGVyKGZvbGRlcik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZGVsZXRlVGFza1dpdGhJZChidXR0b25JZCkge1xuICAgIHN1cGVyRm9sZGVyLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBmb2xkZXIudGFza3MuZm9yRWFjaCh0YXNrID0+IHtcbiAgICAgICAgICAgIGlmIChidXR0b25JZCA9PT0gdGFzay5teVRhc2tVdWlkKSB7XG4gICAgICAgICAgICAgICAgZm9sZGVyLmRlbGV0ZVRhc2sodGFzayk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSk7XG59XG5cblxuZnVuY3Rpb24gY2hhbmdlVGFza1N0YXR1cyh0YXNrSWQpIHtcbiAgICBzdXBlckZvbGRlci5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgZm9sZGVyLnRhc2tzLmZvckVhY2godGFzayA9PiB7XG4gICAgICAgICAgICBpZiAodGFza0lkID09PSB0YXNrLm15VGFza1V1aWQpIHtcbiAgICAgICAgICAgICAgICB0YXNrLnNldENvbXBsZXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGZpbmRUYXNrV2l0aElkKGJ1dHRvbklkKSB7XG4gICAgbGV0IG91dHB1dDtcbiAgICBzdXBlckZvbGRlci5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgZm9sZGVyLnRhc2tzLmZvckVhY2godGFzayA9PiB7XG4gICAgICAgICAgICBpZiAoYnV0dG9uSWQgPT09IHRhc2subXlUYXNrVXVpZCkge1xuICAgICAgICAgICAgICAgIG91dHB1dCA9IHRhc2s7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSk7XG4gICAgcmV0dXJuIG91dHB1dDtcbn1cblxuZXhwb3J0IHtcbiAgICBkaXNwbGF5Q3VycmVudEZvbGRlcldpdGhJZCxcbiAgICBkZWxldGVGb2xkZXJXaXRoSWQsXG4gICAgZGVsZXRlVGFza1dpdGhJZCxcbiAgICBjaGFuZ2VUYXNrU3RhdHVzLFxuICAgIGdldFRhc2tEaWFsb2csXG4gICAgZmluZFRhc2tXaXRoSWQsXG4gICAgZ2V0RWRpdERpYWxvZ1xufSJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZXhwb3J0cyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsInJhbmRvbVVVSUQiLCJjcnlwdG8iLCJiaW5kIiwiZ2V0UmFuZG9tVmFsdWVzIiwicm5kczgiLCJVaW50OEFycmF5Iiwicm5nIiwiRXJyb3IiLCJieXRlVG9IZXgiLCJpIiwicHVzaCIsInRvU3RyaW5nIiwic2xpY2UiLCJvcHRpb25zIiwiYnVmIiwib2Zmc2V0Iiwicm5kcyIsInJhbmRvbSIsImFyciIsInVuc2FmZVN0cmluZ2lmeSIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJkdWVEYXRlIiwicHJpb3JpdHkiLCJteVRhc2tVdWlkIiwiY29tcGxldGVTdGF0ZSIsImdldENvbXBsZXRlU3RhdGUiLCJjaGFuZ2VQcmlvcml0eSIsIm5ld1ByaW9yaXR5Iiwic2V0Q29tcGxldGUiLCJlZGl0VGFzayIsIm5ld1RpdGxlIiwibmV3RGVzY3JpcHRpb24iLCJuZXdEdWVEYXRlIiwicHJpbnRUYXNrIiwiY29uc29sZSIsImxvZyIsIkZvbGRlciIsIm15Rm9sZGVyVXVpZCIsInRhc2tzIiwiYWRkVGFzayIsIm5ld1Rhc2tOYW1lIiwiZGlzcGxheVRhc2tzIiwibGVuZ3RoIiwiZGVsZXRlVGFzayIsInRhc2tOYW1lIiwic3BsaWNlIiwiZGlzcGxheUZvbGRlclRhc2tzIiwiZm9sZGVyTmFtZSIsImZvckVhY2giLCJ0YXNrIiwibG9jYXRpb24iLCJ0YXNrRE9NIiwidGFza0RpdiIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInRhc2tUaXRsZUluRGl2IiwidGFza0Rlc2NyaXB0aW9uSW5EaXYiLCJ0YXNrRHVlRGF0ZUluRGl2IiwidGFza1ByaW9yaXR5SW5EaXYiLCJjbGFzc0xpc3QiLCJhZGQiLCJ0ZXh0Q29udGVudCIsImFwcGVuZENoaWxkIiwidGFza0RlbGV0ZUJ0biIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwidGhpc0J1dHRvbiIsInRhcmdldCIsImRlbGV0ZVRhc2tXaXRoSWQiLCJ2YWx1ZSIsInBhcmVudE5vZGUiLCJyZW1vdmUiLCJjcmVhdGVUYXNrRGVsZXRlQnV0dG9uIiwidGFza0VkaXRCdG4iLCJlZGl0Rm9ybSIsImdldEVsZW1lbnRCeUlkIiwiYnRuRm9ySWQiLCJmb3JtIiwidGFza1RpdGxlSW5Gb3JtIiwiZWxlbWVudHMiLCJ0YXNrRGVzY3JpcHRpb25JbkZvcm0iLCJ0YXNrRHVlRGF0ZUluRm9ybSIsInRhc2tQcmlvcml0eUluRm9ybSIsImNoYW5nZVRhc2tGb3JtRmllbGRzIiwiZmluZFRhc2tXaXRoSWQiLCJnZXRFZGl0RGlhbG9nIiwic2hvd01vZGFsIiwiY3JlYXRlVGFza0VkaXRCdXR0b24iLCJ0YXNrU3RhdHVzQnRuIiwiZWxlbWVudCIsImNoYW5nZVRhc2tTdGF0dXMiLCJjb250YWlucyIsImNyZWF0ZVRhc2tTdGF0dXNCdXR0b24iLCJjcmVhdGVUYXNrRWxlbWVudCIsImFwcGVuZFRhc2siLCJhcHBlbmRGb2xkZXIiLCJmb2xkZXJET00iLCJzaWRlYmFyIiwicXVlcnlTZWxlY3RvciIsImZvbGRlckRpdiIsImZvbGRlckJ0biIsImZvbGRlciIsImZvbGRlckRlbGV0ZUJ0biIsImRlbGV0ZUZvbGRlcldpdGhJZCIsImNyZWF0ZUZvbGRlckRlbGV0ZUJ1dHRvbiIsImN1cnJlbnRGb2xkZXJJZCIsImRpc3BsYXlDdXJyZW50Rm9sZGVyV2l0aElkIiwiY3JlYXRlRm9sZGVyQnV0dG9uIiwic3VwZXJGb2xkZXIiLCJmb2xkZXJzIiwiYWRkRm9sZGVyIiwibmV3Rm9sZGVyTmFtZSIsImRlbGV0ZUZvbGRlciIsImxvY2FsU3RvcmFnZSIsInJlbW92ZUl0ZW0iLCJTdXBlckZvbGRlciIsImdldFRhc2tEaWFsb2ciLCJmaW5kRm9sZGVyV2l0aElkIiwiYnV0dG9uSWQiLCJyZXNldCIsInNlbGVjdCIsInNlbGVjdE9wdGlvbiIsImNsZWFyU2VsZWN0TWVudSIsIm9wdGlvbiIsImFwcGVuZERyb3Bkb3duIiwicHJldmVudERlZmF1bHQiLCJmb2xkZXJEaWFsb2ciLCJmb2xkZXJUaXRsZUluRm9ybSIsImZvbGRlckZvcm0iLCJnZXRGb2xkZXJGb3JtSW5mbyIsIm5ld0ZvbGRlciIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwiY2xvc2UiLCJzZWxlY3RlZEZvbGRlclZhbHVlIiwidGFza1RpdGxlIiwidGFza0Rlc2NyaXB0aW9uIiwidGFza0R1ZURhdGUiLCJ0YXNrUHJpb3JpdHkiLCJnZXRUYXNrRm9ybUluZm8iLCJuZXdUYXNrIiwibHNGb2xkZXIiLCJwYXJzZSIsImdldEl0ZW0iLCJyZWNyZWF0ZWRGb2xkZXIiLCJyZWNyZWF0ZUZvbGRlck9iaiIsInRhc2sxIiwiYnRuSWQiLCJnZXRUYXNrRWRpdEZvcm1JbmZvIiwidGFzazIiLCJ0YXNrMyIsImluYm94Rm9sZGVyIiwidGVzdEZvbGRlcjIiLCJ0YXJnZXRPYmoiLCJyZXBsYWNlbWVudE9iaiIsInRlbXBJZCIsInRhc2tJZCIsIm91dHB1dCJdLCJzb3VyY2VSb290IjoiIn0=