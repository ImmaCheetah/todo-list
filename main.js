(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{kj:()=>g,F5:()=>k,k3:()=>y,HA:()=>p,QP:()=>v,mo:()=>f});const t={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let n;const o=new Uint8Array(16);function d(){if(!n&&(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(o)}const l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));const r=function(e,n,o){if(t.randomUUID&&!n&&!e)return t.randomUUID();const r=(e=e||{}).random||(e.rng||d)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,n){o=o||0;for(let e=0;e<16;++e)n[o+e]=r[e];return n}return function(e,t=0){return l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]}(r)};function a(e,t,n,o){let d=r(),l=!1;const a=()=>l;e=e.toString(),t=t.toString();const s=e=>{o=e};return{get title(){return e},get description(){return t},get dueDate(){return n},get priority(){return o},getCompleteState:a,setComplete:()=>{l=0==a()},changePriority:s,editTask:(o,d,l,r)=>{e=o,t=d,n=l,s(r)},printTask:()=>{console.log(`Task title - ${e}, Desc - ${t}, Date - ${n}, Priority - ${o}`)},myTaskUuid:d}}function s(e){let t=r(),n=[];return{title:e,tasks:n,myFolderUuid:t,addTask:e=>{n.push(e)},displayTasks:()=>{for(let e=0;e<n.length;e++)console.log(`Task ${e} - ${n[e].title}, ${n[e].dueDate}, ${n[e].priority}`)},deleteTask:e=>{for(let t=n.length-1;t>=0;--t)n[t].myTaskUuid===e.myTaskUuid&&n.splice(t,1)}}}function i(e){e.tasks.forEach((e=>{!function(e,t){let n=function(e){const t=document.createElement("div"),n=document.createElement("p"),o=document.createElement("p"),d=document.createElement("p"),l=document.createElement("p");return t.classList.add("task-div"),n.textContent=e.title,o.textContent=e.description,d.textContent=e.dueDate,l.textContent=e.priority,t.appendChild(n),t.appendChild(o),t.appendChild(d),t.appendChild(l),(function(e){const t=document.createElement("button");return t.classList.add("task-delete-btn"),t.textContent="-",e.appendChild(t),t.addEventListener("click",(function(e){let t=e.target;y(t.value),t.parentNode.remove()})),t}(t)).value=e.myTaskUuid,(function(e){const t=document.createElement("button");return t.classList.add("task-edit-btn"),t.textContent="+",e.appendChild(t),t.addEventListener("click",(function(e){const t=document.getElementById("edit-form"),n=document.createElement("button");n.classList.add("edit-btn-id"),n.value=e.target.value,t.appendChild(n),function(e){const t=document.getElementById("edit-form"),n=t.elements["task-title"],o=t.elements["task-description"],d=t.elements["task-due-date"],l=t.elements["task-priority"];n.value=e.title,o.value=e.description,d.value=e.dueDate,l.value=e.priority}(v(e.target.value)),f().showModal()})),t}(t)).value=e.myTaskUuid,(function(e){const t=document.createElement("button");return t.classList.add("task-status-btn"),t.textContent="âœ”",e.appendChild(t),t.addEventListener("click",(function(e){let t=e.target;var n;g(t.value),(n=t).parentNode.classList.contains("complete-task")?n.parentNode.classList.remove("complete-task"):n.parentNode.classList.add("complete-task")})),t}(t)).value=e.myTaskUuid,t}(e);document.getElementById(["task-container"]).appendChild(n)}(e)}))}function c(e){let t=function(e){const t=document.querySelector(".sidebar"),n=document.createElement("div"),o=document.createElement("button");return n.classList.add("folder-div"),o.classList.add("folder-button"),o.textContent=e.title,o.value=e.myFolderUuid,n.appendChild(o),(function(e){const t=document.createElement("button");return t.classList.add("folder-delete-btn"),t.textContent="-",e.appendChild(t),t.addEventListener("click",(function(e){let t=e.target;k(t.value),t.parentNode.remove()})),t}(n)).value=e.myFolderUuid,t.appendChild(n),o.addEventListener("click",(function(){let t=e.myFolderUuid;return p(e.myFolderUuid),console.log(e.title,e.myFolderUuid),t})),n}(e);document.querySelector(".sidebar").appendChild(t)}const u=function(){let e=[];return{folders:e,addFolder:t=>{e.push(t)},deleteFolder:t=>{for(let n=e.length-1;n>=0;--n)e[n].myFolderUuid===t.myFolderUuid&&e.splice(n,1)}}}();function m(){return document.getElementById("task-dialog")}function f(){return document.getElementById("edit-dialog")}function p(e){u.folders.forEach((t=>{e===t.myFolderUuid&&(document.getElementById("task-container").textContent="",i(t),console.log("match found"))}))}function k(e){u.folders.forEach((t=>{e===t.myFolderUuid&&(console.log(e),u.deleteFolder(t))}))}function y(e){u.folders.forEach((t=>{t.tasks.forEach((n=>{e===n.myTaskUuid&&t.deleteTask(n)}))}))}function g(e){u.folders.forEach((t=>{t.tasks.forEach((t=>{e===t.myTaskUuid&&t.setComplete()}))}))}function v(e){let t;return u.folders.forEach((n=>{n.tasks.forEach((n=>{e===n.myTaskUuid&&(t=n)}))})),t}document.getElementById("open-task-modal-btn").addEventListener("click",(function(){m().reset,m().showModal(),function(e){const t=document.getElementById("folder-selection");!function(e){for(let t=e.options.length;t>=0;t--)e.remove(0)}(t),e.folders.forEach((e=>{const n=document.createElement("option");n.textContent=e.title,n.value=e.myFolderUuid,t.appendChild(n)}))}(u)})),document.getElementById("folder-add-btn").addEventListener("click",(function(){document.getElementById("folder-dialog").showModal()})),document.getElementById("folder-confirm-btn").addEventListener("click",(function(e){e.preventDefault();const t=document.getElementById("folder-dialog"),{folderTitleInForm:n}=function(){const e=document.getElementById("folder-form");return{folderForm:e,folderTitleInForm:e.elements["folder-title"].value}}();let o=s(n);c(o),u.addFolder(o),localStorage.setItem("folder",JSON.stringify(o)),console.log(JSON.parse(localStorage.getItem("folder"))),t.close()})),console.log(JSON.parse(localStorage.getItem("folder"))),document.getElementById("task-add-btn").addEventListener("click",(function(e){e.preventDefault();const t=document.getElementById("folder-selection").value,{taskTitle:n,taskDescription:o,taskDueDate:d,taskPriority:l}=function(){const e=document.getElementById("main-form"),t=e.elements["task-title"],n=e.elements["task-description"],o=e.elements["task-due-date"],d=e.elements["task-priority"];return{taskTitle:t.value,taskDescription:n.value,taskDueDate:o.value,taskPriority:d.value}}(),r=a(n,o,d,l);u.folders.forEach((e=>{t===e.myFolderUuid&&e.addTask(r)})),p(t),document.getElementById("main-form").reset(),m().close()})),document.getElementById("task-edit-btn").addEventListener("click",(function(e){e.preventDefault();const t=document.querySelector(".edit-btn-id"),{taskTitle:n,taskDescription:o,taskDueDate:d,taskPriority:l}=function(){const e=document.getElementById("edit-form"),t=e.elements["task-title"],n=e.elements["task-description"],o=e.elements["task-due-date"],d=e.elements["task-priority"];return{taskTitle:t.value,taskDescription:n.value,taskDueDate:o.value,taskPriority:d.value}}();u.folders.forEach((e=>{e.tasks.forEach((r=>{t.value===r.myTaskUuid&&(r.editTask(n,o,d,l),p(e.myFolderUuid),console.log(r))}))})),t.remove(),f().close()}));const E=a("chores","wash dishes","nov 23","high"),h=a("movies","avatar","nov 29","med"),U=a("coding","todo list","dec 10","low");let I=s("Inbox");I.addTask(E),u.addFolder(I),c(I);let T=s("test2");T.addTask(h),T.addTask(E),T.addTask(U),T.deleteTask(h),u.addFolder(T),c(T),JSON.parse(localStorage.getItem("folder"))?console.log("a folder exists"):console.log("no folder")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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NEcsR0FDcEJ2QyxFQUFZRSxVQUFVd0MsR0FDdEJ2RCxFQUFhdUQsR0FFYixJQUFJQyxFQUFjbkgsRUFBTyxTQUN6Qm1ILEVBQVloSCxRQUFRNkcsR0FDcEJHLEVBQVloSCxRQUFRNEcsR0FDcEJJLEVBQVloSCxRQUFROEcsR0FDcEJFLEVBQVk1RyxXQUFXeUcsR0FDdkJ4QyxFQUFZRSxVQUFVeUMsR0FDdEJ4RCxFQUFhd0QsR0FVUmxCLEtBQUtFLE1BQU1KLGFBQWFLLFFBQVEsV0FHakN0RyxRQUFRQyxJQUFJLG1CQUZaRCxRQUFRQyxJQUFJLFkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2RvLWxpc3Qvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vdG9kby1saXN0L3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly90b2RvLWxpc3Qvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL25hdGl2ZS5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3JuZy5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3N0cmluZ2lmeS5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3Y0LmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9tb2R1bGVzL2ZhY3Rvcmllcy5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvbW9kdWxlcy9kb20uanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiY29uc3QgcmFuZG9tVVVJRCA9IHR5cGVvZiBjcnlwdG8gIT09ICd1bmRlZmluZWQnICYmIGNyeXB0by5yYW5kb21VVUlEICYmIGNyeXB0by5yYW5kb21VVUlELmJpbmQoY3J5cHRvKTtcbmV4cG9ydCBkZWZhdWx0IHtcbiAgcmFuZG9tVVVJRFxufTsiLCIvLyBVbmlxdWUgSUQgY3JlYXRpb24gcmVxdWlyZXMgYSBoaWdoIHF1YWxpdHkgcmFuZG9tICMgZ2VuZXJhdG9yLiBJbiB0aGUgYnJvd3NlciB3ZSB0aGVyZWZvcmVcbi8vIHJlcXVpcmUgdGhlIGNyeXB0byBBUEkgYW5kIGRvIG5vdCBzdXBwb3J0IGJ1aWx0LWluIGZhbGxiYWNrIHRvIGxvd2VyIHF1YWxpdHkgcmFuZG9tIG51bWJlclxuLy8gZ2VuZXJhdG9ycyAobGlrZSBNYXRoLnJhbmRvbSgpKS5cbmxldCBnZXRSYW5kb21WYWx1ZXM7XG5jb25zdCBybmRzOCA9IG5ldyBVaW50OEFycmF5KDE2KTtcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJuZygpIHtcbiAgLy8gbGF6eSBsb2FkIHNvIHRoYXQgZW52aXJvbm1lbnRzIHRoYXQgbmVlZCB0byBwb2x5ZmlsbCBoYXZlIGEgY2hhbmNlIHRvIGRvIHNvXG4gIGlmICghZ2V0UmFuZG9tVmFsdWVzKSB7XG4gICAgLy8gZ2V0UmFuZG9tVmFsdWVzIG5lZWRzIHRvIGJlIGludm9rZWQgaW4gYSBjb250ZXh0IHdoZXJlIFwidGhpc1wiIGlzIGEgQ3J5cHRvIGltcGxlbWVudGF0aW9uLlxuICAgIGdldFJhbmRvbVZhbHVlcyA9IHR5cGVvZiBjcnlwdG8gIT09ICd1bmRlZmluZWQnICYmIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMgJiYgY3J5cHRvLmdldFJhbmRvbVZhbHVlcy5iaW5kKGNyeXB0byk7XG5cbiAgICBpZiAoIWdldFJhbmRvbVZhbHVlcykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKCkgbm90IHN1cHBvcnRlZC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS91dWlkanMvdXVpZCNnZXRyYW5kb212YWx1ZXMtbm90LXN1cHBvcnRlZCcpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBnZXRSYW5kb21WYWx1ZXMocm5kczgpO1xufSIsImltcG9ydCB2YWxpZGF0ZSBmcm9tICcuL3ZhbGlkYXRlLmpzJztcbi8qKlxuICogQ29udmVydCBhcnJheSBvZiAxNiBieXRlIHZhbHVlcyB0byBVVUlEIHN0cmluZyBmb3JtYXQgb2YgdGhlIGZvcm06XG4gKiBYWFhYWFhYWC1YWFhYLVhYWFgtWFhYWC1YWFhYWFhYWFhYWFhcbiAqL1xuXG5jb25zdCBieXRlVG9IZXggPSBbXTtcblxuZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7ICsraSkge1xuICBieXRlVG9IZXgucHVzaCgoaSArIDB4MTAwKS50b1N0cmluZygxNikuc2xpY2UoMSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdW5zYWZlU3RyaW5naWZ5KGFyciwgb2Zmc2V0ID0gMCkge1xuICAvLyBOb3RlOiBCZSBjYXJlZnVsIGVkaXRpbmcgdGhpcyBjb2RlISAgSXQncyBiZWVuIHR1bmVkIGZvciBwZXJmb3JtYW5jZVxuICAvLyBhbmQgd29ya3MgaW4gd2F5cyB5b3UgbWF5IG5vdCBleHBlY3QuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdXVpZGpzL3V1aWQvcHVsbC80MzRcbiAgcmV0dXJuIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDJdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgM11dICsgJy0nICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA0XV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDVdXSArICctJyArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgNl1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA3XV0gKyAnLScgKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDhdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgOV1dICsgJy0nICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMV1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMl1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxM11dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxNF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxNV1dO1xufVxuXG5mdW5jdGlvbiBzdHJpbmdpZnkoYXJyLCBvZmZzZXQgPSAwKSB7XG4gIGNvbnN0IHV1aWQgPSB1bnNhZmVTdHJpbmdpZnkoYXJyLCBvZmZzZXQpOyAvLyBDb25zaXN0ZW5jeSBjaGVjayBmb3IgdmFsaWQgVVVJRC4gIElmIHRoaXMgdGhyb3dzLCBpdCdzIGxpa2VseSBkdWUgdG8gb25lXG4gIC8vIG9mIHRoZSBmb2xsb3dpbmc6XG4gIC8vIC0gT25lIG9yIG1vcmUgaW5wdXQgYXJyYXkgdmFsdWVzIGRvbid0IG1hcCB0byBhIGhleCBvY3RldCAobGVhZGluZyB0b1xuICAvLyBcInVuZGVmaW5lZFwiIGluIHRoZSB1dWlkKVxuICAvLyAtIEludmFsaWQgaW5wdXQgdmFsdWVzIGZvciB0aGUgUkZDIGB2ZXJzaW9uYCBvciBgdmFyaWFudGAgZmllbGRzXG5cbiAgaWYgKCF2YWxpZGF0ZSh1dWlkKSkge1xuICAgIHRocm93IFR5cGVFcnJvcignU3RyaW5naWZpZWQgVVVJRCBpcyBpbnZhbGlkJyk7XG4gIH1cblxuICByZXR1cm4gdXVpZDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgc3RyaW5naWZ5OyIsImltcG9ydCBuYXRpdmUgZnJvbSAnLi9uYXRpdmUuanMnO1xuaW1wb3J0IHJuZyBmcm9tICcuL3JuZy5qcyc7XG5pbXBvcnQgeyB1bnNhZmVTdHJpbmdpZnkgfSBmcm9tICcuL3N0cmluZ2lmeS5qcyc7XG5cbmZ1bmN0aW9uIHY0KG9wdGlvbnMsIGJ1Ziwgb2Zmc2V0KSB7XG4gIGlmIChuYXRpdmUucmFuZG9tVVVJRCAmJiAhYnVmICYmICFvcHRpb25zKSB7XG4gICAgcmV0dXJuIG5hdGl2ZS5yYW5kb21VVUlEKCk7XG4gIH1cblxuICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgY29uc3Qgcm5kcyA9IG9wdGlvbnMucmFuZG9tIHx8IChvcHRpb25zLnJuZyB8fCBybmcpKCk7IC8vIFBlciA0LjQsIHNldCBiaXRzIGZvciB2ZXJzaW9uIGFuZCBgY2xvY2tfc2VxX2hpX2FuZF9yZXNlcnZlZGBcblxuICBybmRzWzZdID0gcm5kc1s2XSAmIDB4MGYgfCAweDQwO1xuICBybmRzWzhdID0gcm5kc1s4XSAmIDB4M2YgfCAweDgwOyAvLyBDb3B5IGJ5dGVzIHRvIGJ1ZmZlciwgaWYgcHJvdmlkZWRcblxuICBpZiAoYnVmKSB7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IDA7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyArK2kpIHtcbiAgICAgIGJ1ZltvZmZzZXQgKyBpXSA9IHJuZHNbaV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGJ1ZjtcbiAgfVxuXG4gIHJldHVybiB1bnNhZmVTdHJpbmdpZnkocm5kcyk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHY0OyIsImltcG9ydCB7djQgYXMgdXVpZHY0fSBmcm9tICd1dWlkJztcblxuZXhwb3J0IGZ1bmN0aW9uIFRhc2sodGl0bGUsIGRlc2NyaXB0aW9uLCBkdWVEYXRlLCBwcmlvcml0eSkge1xuXG4gICAgbGV0IG15VGFza1V1aWQgPSB1dWlkdjQoKTtcblxuICAgIGxldCBjb21wbGV0ZVN0YXRlID0gZmFsc2U7XG5cbiAgICBjb25zdCBnZXRDb21wbGV0ZVN0YXRlID0gKCkgPT4gY29tcGxldGVTdGF0ZTtcblxuICAgIGNvbnN0IHNldENvbXBsZXRlID0gKCkgPT4ge1xuICAgICAgICBpZiAoZ2V0Q29tcGxldGVTdGF0ZSgpID09IGZhbHNlKSB7XG4gICAgICAgICAgICBjb21wbGV0ZVN0YXRlID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbXBsZXRlU3RhdGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG4gICAgdGl0bGUgPSB0aXRsZS50b1N0cmluZygpO1xuICAgIGRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb24udG9TdHJpbmcoKTtcblxuICAgIGNvbnN0IGNoYW5nZVByaW9yaXR5ID0gKG5ld1ByaW9yaXR5KSA9PiB7XG4gICAgICAgIHByaW9yaXR5ID0gbmV3UHJpb3JpdHk7XG4gICAgfVxuXG4gICAgY29uc3QgZWRpdFRhc2sgPSAobmV3VGl0bGUsIG5ld0Rlc2NyaXB0aW9uLCBuZXdEdWVEYXRlLCBuZXdQcmlvcml0eSkgPT4ge1xuICAgICAgICB0aXRsZSA9IG5ld1RpdGxlO1xuICAgICAgICBkZXNjcmlwdGlvbiA9IG5ld0Rlc2NyaXB0aW9uO1xuICAgICAgICBkdWVEYXRlID0gbmV3RHVlRGF0ZTtcbiAgICAgICAgY2hhbmdlUHJpb3JpdHkobmV3UHJpb3JpdHkpO1xuICAgIH1cblxuICAgIGNvbnN0IHByaW50VGFzayA9ICgpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coYFRhc2sgdGl0bGUgLSAke3RpdGxlfSwgRGVzYyAtICR7ZGVzY3JpcHRpb259LCBEYXRlIC0gJHtkdWVEYXRlfSwgUHJpb3JpdHkgLSAke3ByaW9yaXR5fWApO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGdldCB0aXRsZSgpIHtyZXR1cm4gdGl0bGV9LCBcbiAgICAgICAgZ2V0IGRlc2NyaXB0aW9uKCkge3JldHVybiBkZXNjcmlwdGlvbn0sIFxuICAgICAgICBnZXQgZHVlRGF0ZSgpIHtyZXR1cm4gZHVlRGF0ZX0sIFxuICAgICAgICBnZXQgcHJpb3JpdHkoKSB7cmV0dXJuIHByaW9yaXR5fSxcbiAgICAgICAgZ2V0Q29tcGxldGVTdGF0ZSxcbiAgICAgICAgc2V0Q29tcGxldGUsIFxuICAgICAgICBjaGFuZ2VQcmlvcml0eSxcbiAgICAgICAgZWRpdFRhc2ssXG4gICAgICAgIHByaW50VGFzayxcbiAgICAgICAgbXlUYXNrVXVpZFxuICAgIH07XG59O1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBGb2xkZXIodGl0bGUpIHtcbiAgICBcblxuICAgIGxldCBteUZvbGRlclV1aWQgPSB1dWlkdjQoKTtcbiAgICBsZXQgdGFza3MgPSBbXTtcblxuICAgIGNvbnN0IGFkZFRhc2sgPSAobmV3VGFza05hbWUpID0+IHtcbiAgICAgICAgdGFza3MucHVzaChuZXdUYXNrTmFtZSk7XG4gICAgfVxuXG4gICAgY29uc3QgZGlzcGxheVRhc2tzID0gKCkgPT4ge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhc2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgVGFzayAke2l9IC0gJHt0YXNrc1tpXS50aXRsZX0sICR7dGFza3NbaV0uZHVlRGF0ZX0sICR7dGFza3NbaV0ucHJpb3JpdHl9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBkZWxldGVUYXNrID0gKHRhc2tOYW1lKSA9PiB7XG4gICAgICAgIC8vIHRhc2tzLnNwbGljZSh0YXNrTmFtZSwgMSk7XG4gICAgICAgIGZvciAobGV0IGkgPSB0YXNrcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgaWYgKHRhc2tzW2ldLm15VGFza1V1aWQgPT09IHRhc2tOYW1lLm15VGFza1V1aWQpIHtcbiAgICAgICAgICAgICAgICB0YXNrcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBcbiAgICByZXR1cm4ge3RpdGxlLCB0YXNrcywgbXlGb2xkZXJVdWlkLCBhZGRUYXNrLCBkaXNwbGF5VGFza3MsIGRlbGV0ZVRhc2t9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gU3VwZXJGb2xkZXIoKSB7XG4gICAgbGV0IGZvbGRlcnMgPSBbXVxuXG4gICAgY29uc3QgYWRkRm9sZGVyID0gKG5ld0ZvbGRlck5hbWUpID0+IHtcbiAgICAgICAgZm9sZGVycy5wdXNoKG5ld0ZvbGRlck5hbWUpO1xuICAgIH1cblxuICAgIGNvbnN0IGRlbGV0ZUZvbGRlciA9IChmb2xkZXJOYW1lKSA9PiB7XG4gICAgICAgIGZvciAobGV0IGkgPSBmb2xkZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICBpZiAoZm9sZGVyc1tpXS5teUZvbGRlclV1aWQgPT09IGZvbGRlck5hbWUubXlGb2xkZXJVdWlkKSB7XG4gICAgICAgICAgICAgICAgZm9sZGVycy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge2ZvbGRlcnMsIGFkZEZvbGRlciwgZGVsZXRlRm9sZGVyfVxufSIsImltcG9ydCB7XG4gICAgZGlzcGxheUN1cnJlbnRGb2xkZXJXaXRoSWQsXG4gICAgZGVsZXRlRm9sZGVyV2l0aElkLFxuICAgIGRlbGV0ZVRhc2tXaXRoSWQsXG4gICAgY2hhbmdlVGFza1N0YXR1cyxcbiAgICBmaW5kVGFza1dpdGhJZCxcbiAgICBnZXRFZGl0RGlhbG9nXG59IGZyb20gJy4uL2luZGV4LmpzJztcblxuXG4vLyBDcmVhdGUgYWxsIGVsZW1lbnRzIGZvciBlYWNoIHRhc2sgcHJvcGVydHkgYW5kIGNoYW5nZSB0ZXh0IGNvbnRlbnQgdG8gY29ycmVzcG9uZGluZyB2YWx1ZVxuLy8gVGhlbiBhZGQgdGhlbSB0byBhIG1haW4gZGl2IGFuZCByZXR1cm5cbmZ1bmN0aW9uIGNyZWF0ZVRhc2tFbGVtZW50KHRhc2tOYW1lKSB7XG4gICAgY29uc3QgdGFza0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IHRhc2tUaXRsZUluRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIGNvbnN0IHRhc2tEZXNjcmlwdGlvbkluRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIGNvbnN0IHRhc2tEdWVEYXRlSW5EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgY29uc3QgdGFza1ByaW9yaXR5SW5EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgXG4gICAgdGFza0Rpdi5jbGFzc0xpc3QuYWRkKCd0YXNrLWRpdicpO1xuICAgIHRhc2tUaXRsZUluRGl2LnRleHRDb250ZW50ID0gdGFza05hbWUudGl0bGU7XG4gICAgdGFza0Rlc2NyaXB0aW9uSW5EaXYudGV4dENvbnRlbnQgPSB0YXNrTmFtZS5kZXNjcmlwdGlvbjtcbiAgICB0YXNrRHVlRGF0ZUluRGl2LnRleHRDb250ZW50ID0gdGFza05hbWUuZHVlRGF0ZTtcbiAgICB0YXNrUHJpb3JpdHlJbkRpdi50ZXh0Q29udGVudCA9IHRhc2tOYW1lLnByaW9yaXR5O1xuXG4gICAgdGFza0Rpdi5hcHBlbmRDaGlsZCh0YXNrVGl0bGVJbkRpdik7XG4gICAgdGFza0Rpdi5hcHBlbmRDaGlsZCh0YXNrRGVzY3JpcHRpb25JbkRpdik7XG4gICAgdGFza0Rpdi5hcHBlbmRDaGlsZCh0YXNrRHVlRGF0ZUluRGl2KTtcbiAgICB0YXNrRGl2LmFwcGVuZENoaWxkKHRhc2tQcmlvcml0eUluRGl2KTtcbiAgICBjcmVhdGVUYXNrRGVsZXRlQnV0dG9uKHRhc2tEaXYpLnZhbHVlID0gdGFza05hbWUubXlUYXNrVXVpZDtcbiAgICBjcmVhdGVUYXNrRWRpdEJ1dHRvbih0YXNrRGl2KS52YWx1ZSA9IHRhc2tOYW1lLm15VGFza1V1aWQ7XG4gICAgY3JlYXRlVGFza1N0YXR1c0J1dHRvbih0YXNrRGl2KS52YWx1ZSA9IHRhc2tOYW1lLm15VGFza1V1aWQ7XG5cbiAgICByZXR1cm4gdGFza0Rpdjtcbn1cblxuLy8gVGFrZSBpbiB0YXNrIGFuZCB3aGVyZSB0byBhcHBlbmRcbi8vIENyZWF0ZSB0aGUgdGFzayB1c2luZyBjcmVhdGVUYXNrRWxlbWVudCBhbmQgYXNzaWduIHRvIHZhcmlhYmxlXG4vLyBUYXJnZXQgZWxlbWVudCB0byBhcHBlbmQgdG8gYW5kIGFwcGVuZFxuZnVuY3Rpb24gYXBwZW5kVGFzayh0YXNrTmFtZSwgbG9jYXRpb24pIHtcbiAgICBsZXQgdGFza0RPTSA9IGNyZWF0ZVRhc2tFbGVtZW50KHRhc2tOYW1lKTtcblxuICAgIGNvbnN0IGxvY2F0aW9uRE9NID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobG9jYXRpb24pO1xuICAgIGxvY2F0aW9uRE9NLmFwcGVuZENoaWxkKHRhc2tET00pO1xufVxuXG4vLyBUYWtlIGluIGZvbGRlciBuYW1lIHRoZW4gbG9vcCB0aHJvdWdoIHRhc2tzIGluc2lkZSBmb2xkZXIgdG8gYXBwZW5kIHRvIHNjcmVlblxuZnVuY3Rpb24gZGlzcGxheUZvbGRlclRhc2tzKGZvbGRlck5hbWUpIHtcbiAgICBmb2xkZXJOYW1lLnRhc2tzLmZvckVhY2godGFzayA9PiB7XG4gICAgICAgIGFwcGVuZFRhc2sodGFzaywgWyd0YXNrLWNvbnRhaW5lciddKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0VGFza0Zvcm1JbmZvKCkge1xuICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1mb3JtJyk7XG5cbiAgICBjb25zdCB0YXNrVGl0bGVJbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLXRpdGxlJ107XG4gICAgY29uc3QgdGFza0Rlc2NyaXB0aW9uSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay1kZXNjcmlwdGlvbiddO1xuICAgIGNvbnN0IHRhc2tEdWVEYXRlSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay1kdWUtZGF0ZSddO1xuICAgIGNvbnN0IHRhc2tQcmlvcml0eUluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stcHJpb3JpdHknXTtcbiAgICBcbiAgICBsZXQgdGFza1RpdGxlID0gdGFza1RpdGxlSW5Gb3JtLnZhbHVlO1xuICAgIGxldCB0YXNrRGVzY3JpcHRpb24gPSB0YXNrRGVzY3JpcHRpb25JbkZvcm0udmFsdWU7XG4gICAgbGV0IHRhc2tEdWVEYXRlID0gdGFza0R1ZURhdGVJbkZvcm0udmFsdWU7XG4gICAgbGV0IHRhc2tQcmlvcml0eSA9IHRhc2tQcmlvcml0eUluRm9ybS52YWx1ZTtcblxuICAgIHJldHVybiB7dGFza1RpdGxlLCB0YXNrRGVzY3JpcHRpb24sIHRhc2tEdWVEYXRlLCB0YXNrUHJpb3JpdHl9O1xufSBcblxuZnVuY3Rpb24gZ2V0VGFza0VkaXRGb3JtSW5mbygpIHtcbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXQtZm9ybScpO1xuXG4gICAgY29uc3QgdGFza1RpdGxlSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay10aXRsZSddO1xuICAgIGNvbnN0IHRhc2tEZXNjcmlwdGlvbkluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stZGVzY3JpcHRpb24nXTtcbiAgICBjb25zdCB0YXNrRHVlRGF0ZUluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stZHVlLWRhdGUnXTtcbiAgICBjb25zdCB0YXNrUHJpb3JpdHlJbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLXByaW9yaXR5J107XG4gICAgXG4gICAgbGV0IHRhc2tUaXRsZSA9IHRhc2tUaXRsZUluRm9ybS52YWx1ZTtcbiAgICBsZXQgdGFza0Rlc2NyaXB0aW9uID0gdGFza0Rlc2NyaXB0aW9uSW5Gb3JtLnZhbHVlO1xuICAgIGxldCB0YXNrRHVlRGF0ZSA9IHRhc2tEdWVEYXRlSW5Gb3JtLnZhbHVlO1xuICAgIGxldCB0YXNrUHJpb3JpdHkgPSB0YXNrUHJpb3JpdHlJbkZvcm0udmFsdWU7XG5cbiAgICByZXR1cm4ge3Rhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uLCB0YXNrRHVlRGF0ZSwgdGFza1ByaW9yaXR5fTtcbn0gXG5cbi8vIENyZWF0ZSBidXR0b24gdG8gaG9sZCBmb2xkZXIgYW5kIHRpdGxlXG4vLyBBZGQgdGl0bGUgdG8gZGl2IGFuZCByZXR1cm5cbmZ1bmN0aW9uIGNyZWF0ZUZvbGRlckJ1dHRvbihmb2xkZXJOYW1lKSB7XG4gICAgY29uc3Qgc2lkZWJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaWRlYmFyJyk7XG4gICAgY29uc3QgZm9sZGVyRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29uc3QgZm9sZGVyQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG5cbiAgICBmb2xkZXJEaXYuY2xhc3NMaXN0LmFkZCgnZm9sZGVyLWRpdicpO1xuICAgIGZvbGRlckJ0bi5jbGFzc0xpc3QuYWRkKCdmb2xkZXItYnV0dG9uJyk7XG4gICAgZm9sZGVyQnRuLnRleHRDb250ZW50ID0gZm9sZGVyTmFtZS50aXRsZTtcbiAgICBmb2xkZXJCdG4udmFsdWUgPSBmb2xkZXJOYW1lLm15Rm9sZGVyVXVpZDtcblxuICAgIGZvbGRlckRpdi5hcHBlbmRDaGlsZChmb2xkZXJCdG4pO1xuICAgIFxuICAgIC8vIENyZWF0ZSB0aGUgZGVsIGJ0biBhbmQgIGFzc2lnbiBzYW1lIGlkIGFzIGZvbGRlciB0byBpdFxuICAgIGNyZWF0ZUZvbGRlckRlbGV0ZUJ1dHRvbihmb2xkZXJEaXYpLnZhbHVlID0gZm9sZGVyTmFtZS5teUZvbGRlclV1aWQ7XG5cbiAgICBzaWRlYmFyLmFwcGVuZENoaWxkKGZvbGRlckRpdik7XG5cbiAgICBmb2xkZXJCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbGV0IGN1cnJlbnRGb2xkZXJJZCA9IGZvbGRlck5hbWUubXlGb2xkZXJVdWlkO1xuICAgICAgICBkaXNwbGF5Q3VycmVudEZvbGRlcldpdGhJZChmb2xkZXJOYW1lLm15Rm9sZGVyVXVpZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGZvbGRlck5hbWUudGl0bGUsIGZvbGRlck5hbWUubXlGb2xkZXJVdWlkKTtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRGb2xkZXJJZDtcbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gZm9sZGVyRGl2O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVGb2xkZXJEZWxldGVCdXR0b24oZm9sZGVyKSB7XG4gICAgY29uc3QgZm9sZGVyRGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG5cbiAgICBmb2xkZXJEZWxldGVCdG4uY2xhc3NMaXN0LmFkZCgnZm9sZGVyLWRlbGV0ZS1idG4nKTtcbiAgICBmb2xkZXJEZWxldGVCdG4udGV4dENvbnRlbnQgPSAnLSc7XG5cbiAgICBmb2xkZXIuYXBwZW5kQ2hpbGQoZm9sZGVyRGVsZXRlQnRuKTtcblxuICAgIGZvbGRlckRlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgbGV0IHRoaXNCdXR0b24gPSBlLnRhcmdldDtcbiAgICAgICAgZGVsZXRlRm9sZGVyV2l0aElkKHRoaXNCdXR0b24udmFsdWUpO1xuICAgICAgICB0aGlzQnV0dG9uLnBhcmVudE5vZGUucmVtb3ZlKCk7XG4gICAgfSlcblxuICAgIHJldHVybiBmb2xkZXJEZWxldGVCdG47XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVRhc2tEZWxldGVCdXR0b24odGFzaykge1xuICAgIGNvbnN0IHRhc2tEZWxldGVCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblxuICAgIHRhc2tEZWxldGVCdG4uY2xhc3NMaXN0LmFkZCgndGFzay1kZWxldGUtYnRuJyk7XG4gICAgdGFza0RlbGV0ZUJ0bi50ZXh0Q29udGVudCA9ICctJztcblxuICAgIHRhc2suYXBwZW5kQ2hpbGQodGFza0RlbGV0ZUJ0bik7XG5cbiAgICB0YXNrRGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBsZXQgdGhpc0J1dHRvbiA9IGUudGFyZ2V0O1xuICAgICAgICBkZWxldGVUYXNrV2l0aElkKHRoaXNCdXR0b24udmFsdWUpO1xuICAgICAgICB0aGlzQnV0dG9uLnBhcmVudE5vZGUucmVtb3ZlKCk7XG4gICAgfSlcblxuICAgIHJldHVybiB0YXNrRGVsZXRlQnRuO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVUYXNrRWRpdEJ1dHRvbih0YXNrKSB7XG4gICAgY29uc3QgdGFza0VkaXRCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblxuICAgIHRhc2tFZGl0QnRuLmNsYXNzTGlzdC5hZGQoJ3Rhc2stZWRpdC1idG4nKTtcbiAgICB0YXNrRWRpdEJ0bi50ZXh0Q29udGVudCA9ICcrJztcblxuICAgIHRhc2suYXBwZW5kQ2hpbGQodGFza0VkaXRCdG4pO1xuXG4gICAgdGFza0VkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8vIENyZWF0ZSBhIGJ1dHRvbiB0byBob2xkIElkIHZhbHVlXG4gICAgICAgIGNvbnN0IGVkaXRGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXQtZm9ybScpO1xuICAgICAgICBjb25zdCBidG5Gb3JJZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXG4gICAgICAgIGJ0bkZvcklkLmNsYXNzTGlzdC5hZGQoJ2VkaXQtYnRuLWlkJyk7XG4gICAgICAgIGJ0bkZvcklkLnZhbHVlID0gZS50YXJnZXQudmFsdWVcbiAgICAgICAgZWRpdEZvcm0uYXBwZW5kQ2hpbGQoYnRuRm9ySWQpO1xuXG4gICAgICAgIC8vIENoYW5nZSBmb3JtIGZpZWxkcyB0byB0YXNrIGluZm8gYW5kIG9wZW4gbW9kYWxcbiAgICAgICAgY2hhbmdlVGFza0Zvcm1GaWVsZHMoZmluZFRhc2tXaXRoSWQoZS50YXJnZXQudmFsdWUpKTtcbiAgICAgICAgZ2V0RWRpdERpYWxvZygpLnNob3dNb2RhbCgpO1xuICAgIH0pXG5cbiAgICByZXR1cm4gdGFza0VkaXRCdG47XG59XG5cbmZ1bmN0aW9uIGNoYW5nZVRhc2tGb3JtRmllbGRzKHRhc2spIHtcbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXQtZm9ybScpO1xuXG4gICAgY29uc3QgdGFza1RpdGxlSW5Gb3JtID0gZm9ybS5lbGVtZW50c1sndGFzay10aXRsZSddO1xuICAgIGNvbnN0IHRhc2tEZXNjcmlwdGlvbkluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stZGVzY3JpcHRpb24nXTtcbiAgICBjb25zdCB0YXNrRHVlRGF0ZUluRm9ybSA9IGZvcm0uZWxlbWVudHNbJ3Rhc2stZHVlLWRhdGUnXTtcbiAgICBjb25zdCB0YXNrUHJpb3JpdHlJbkZvcm0gPSBmb3JtLmVsZW1lbnRzWyd0YXNrLXByaW9yaXR5J107XG5cbiAgICB0YXNrVGl0bGVJbkZvcm0udmFsdWUgPSB0YXNrLnRpdGxlO1xuICAgIHRhc2tEZXNjcmlwdGlvbkluRm9ybS52YWx1ZSA9IHRhc2suZGVzY3JpcHRpb247XG4gICAgdGFza0R1ZURhdGVJbkZvcm0udmFsdWUgPSB0YXNrLmR1ZURhdGU7XG4gICAgdGFza1ByaW9yaXR5SW5Gb3JtLnZhbHVlID0gdGFzay5wcmlvcml0eTtcbn0gXG5cbmZ1bmN0aW9uIGNyZWF0ZVRhc2tTdGF0dXNCdXR0b24odGFzaykge1xuICAgIGNvbnN0IHRhc2tTdGF0dXNCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblxuICAgIHRhc2tTdGF0dXNCdG4uY2xhc3NMaXN0LmFkZCgndGFzay1zdGF0dXMtYnRuJyk7XG4gICAgdGFza1N0YXR1c0J0bi50ZXh0Q29udGVudCA9ICfinJQnO1xuXG4gICAgdGFzay5hcHBlbmRDaGlsZCh0YXNrU3RhdHVzQnRuKTtcblxuICAgIHRhc2tTdGF0dXNCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGxldCB0aGlzQnV0dG9uID0gZS50YXJnZXQ7XG4gICAgICAgIGNoYW5nZVRhc2tTdGF0dXModGhpc0J1dHRvbi52YWx1ZSk7XG4gICAgICAgIHRvZ2dsZUNvbXBsZXRlU3R5bGUodGhpc0J1dHRvbik7XG4gICAgfSlcblxuICAgIHJldHVybiB0YXNrU3RhdHVzQnRuO1xufVxuXG5mdW5jdGlvbiB0b2dnbGVDb21wbGV0ZVN0eWxlKGVsZW1lbnQpIHtcbiAgICBpZiAoIWVsZW1lbnQucGFyZW50Tm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbXBsZXRlLXRhc2snKSkge1xuICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnY29tcGxldGUtdGFzaycpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NvbXBsZXRlLXRhc2snKTtcbiAgICB9XG59XG5cbi8vIFRha2UgaW4gZm9sZGVyIG5hbWUgYW5kIGNyZWF0ZSBmb2xkZXIgdXNpbmcgZnVuY3Rpb25cbi8vIEFwcGVuZCB0byBzaWRlYmFyXG5mdW5jdGlvbiBhcHBlbmRGb2xkZXIoZm9sZGVyTmFtZSkge1xuICAgIGxldCBmb2xkZXJET00gPSBjcmVhdGVGb2xkZXJCdXR0b24oZm9sZGVyTmFtZSk7XG4gICAgXG4gICAgY29uc3Qgc2lkZWJhckZvbGRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2lkZWJhcicpO1xuICAgIHNpZGViYXJGb2xkZXJzLmFwcGVuZENoaWxkKGZvbGRlckRPTSk7XG59XG5cbi8vIFRha2UgaW4gc3VwZXIgZm9sZGVyIG5hbWUgdG8gbG9vcCB0aHJvdWdoIGVhY2ggZm9sZGVyIGFuZCBhcHBlbmQgdG8gc2lkZWJhclxuZnVuY3Rpb24gZGlzcGxheUZvbGRlcnMoc3VwZXJGb2xkZXJOYW1lKSB7XG4gICAgLy8gY2xlYXJTaWRlYmFyKCk7XG4gICAgc3VwZXJGb2xkZXJOYW1lLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBhcHBlbmRGb2xkZXIoZm9sZGVyKTtcbiAgICB9KTtcbn1cblxuXG5mdW5jdGlvbiBnZXRGb2xkZXJGb3JtSW5mbygpIHtcbiAgICBjb25zdCBmb2xkZXJGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlci1mb3JtJyk7XG5cbiAgICBjb25zdCBmb2xkZXJUaXRsZUluRm9ybSA9IGZvbGRlckZvcm0uZWxlbWVudHNbJ2ZvbGRlci10aXRsZSddLnZhbHVlO1xuXG4gICAgcmV0dXJuIHtmb2xkZXJGb3JtLCBmb2xkZXJUaXRsZUluRm9ybX07XG59XG5cbmZ1bmN0aW9uIGNsZWFyVGFza0NvbnRhaW5lcigpIHtcbiAgICBjb25zdCB0YXNrQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2stY29udGFpbmVyJyk7XG5cbiAgICB0YXNrQ29udGFpbmVyLnRleHRDb250ZW50ID0gJyc7XG59XG5cbmZ1bmN0aW9uIGFwcGVuZERyb3Bkb3duKHN1cGVyRm9sZGVyKSB7XG4gICAgbGV0IGluZGV4ID0gMDtcbiAgICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVyLXNlbGVjdGlvbicpO1xuXG4gICAgY2xlYXJTZWxlY3RNZW51KHNlbGVjdCk7XG5cbiAgICBzdXBlckZvbGRlci5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgIFxuICAgICAgICBvcHRpb24udGV4dENvbnRlbnQgPSBmb2xkZXIudGl0bGU7XG4gICAgICAgIG9wdGlvbi52YWx1ZSA9IGZvbGRlci5teUZvbGRlclV1aWQ7IC8vIGZpZ3VyZSBvdXQgaWYgdGhpcyBpcyBnb29kIHdheSB0byBzZWxlY3RcbiAgICAgICAgLy8gb3B0aW9uLnNldEF0dHJpYnV0ZSgnaW5kZXgnLCBpbmRleCsrKTtcblxuICAgICAgICBzZWxlY3QuYXBwZW5kQ2hpbGQob3B0aW9uKTtcbiAgICB9KVxufVxuXG5mdW5jdGlvbiBjbGVhclNlbGVjdE1lbnUoc2VsZWN0T3B0aW9uKSB7XG4gICAgZm9yIChsZXQgaSA9IHNlbGVjdE9wdGlvbi5vcHRpb25zLmxlbmd0aDsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgc2VsZWN0T3B0aW9uLnJlbW92ZSgwKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7XG4gICAgZ2V0VGFza0Zvcm1JbmZvLFxuICAgIGdldFRhc2tFZGl0Rm9ybUluZm8sXG4gICAgZ2V0Rm9sZGVyRm9ybUluZm8sXG4gICAgY3JlYXRlVGFza0VsZW1lbnQsXG4gICAgY3JlYXRlRm9sZGVyQnV0dG9uLFxuICAgIGFwcGVuZEZvbGRlcixcbiAgICBkaXNwbGF5Rm9sZGVyVGFza3MsXG4gICAgYXBwZW5kVGFzayxcbiAgICBkaXNwbGF5Rm9sZGVycyxcbiAgICBjbGVhclRhc2tDb250YWluZXIsXG4gICAgYXBwZW5kRHJvcGRvd24sXG4gICAgY2xlYXJTZWxlY3RNZW51XG59IiwiaW1wb3J0IHtcbiAgICBUYXNrLFxuICAgIEZvbGRlcixcbiAgICBTdXBlckZvbGRlclxufSBmcm9tICcuL21vZHVsZXMvZmFjdG9yaWVzLmpzJztcblxuaW1wb3J0IHtcbiAgICBnZXRUYXNrRm9ybUluZm8sXG4gICAgZ2V0VGFza0VkaXRGb3JtSW5mbyxcbiAgICBnZXRGb2xkZXJGb3JtSW5mbyxcbiAgICBhcHBlbmRGb2xkZXIsXG4gICAgZGlzcGxheUZvbGRlclRhc2tzLFxuICAgIGNsZWFyVGFza0NvbnRhaW5lcixcbiAgICBhcHBlbmREcm9wZG93bixcblxufSBmcm9tICcuL21vZHVsZXMvZG9tLmpzJztcblxuaW1wb3J0IHsgZm9ybWF0RGlzdGFuY2UsIHN1YkRheXMgfSBmcm9tIFwiZGF0ZS1mbnNcIjtcblxuLy9TdXBlciBGb2xkZXIgXG5jb25zdCBzdXBlckZvbGRlciA9IFN1cGVyRm9sZGVyKCk7XG5cbi8vIE9wZW4gdGFzayBtb2RhbCB3aGVuIGNsaWNrZWRcbmNvbnN0IG9wZW5UYXNrTW9kYWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3Blbi10YXNrLW1vZGFsLWJ0bicpO1xub3BlblRhc2tNb2RhbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgIGdldFRhc2tEaWFsb2coKS5yZXNldDtcbiAgICBnZXRUYXNrRGlhbG9nKCkuc2hvd01vZGFsKCk7XG4gICAgYXBwZW5kRHJvcGRvd24oc3VwZXJGb2xkZXIpO1xufSk7XG5cbi8vIEdldCB0YXNrIGRpYWxvZyBhbmQgcmV0dXJuIFxuZnVuY3Rpb24gZ2V0VGFza0RpYWxvZygpIHtcbiAgICBjb25zdCB0YXNrRGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2stZGlhbG9nJyk7XG5cbiAgICByZXR1cm4gdGFza0RpYWxvZztcbn1cblxuZnVuY3Rpb24gZ2V0RWRpdERpYWxvZygpIHtcbiAgICBjb25zdCBlZGl0RGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXQtZGlhbG9nJyk7XG5cbiAgICByZXR1cm4gZWRpdERpYWxvZztcbn1cblxuLy8gT3BlbiBmb2xkZXIgbW9kYWwgd2hlbiBjbGlja2VkXG5jb25zdCBhZGRGb2xkZXJCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVyLWFkZC1idG4nKTtcbmFkZEZvbGRlckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgIFxuICAgIGNvbnN0IGZvbGRlckRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXItZGlhbG9nJyk7XG4gICAgZm9sZGVyRGlhbG9nLnNob3dNb2RhbCgpO1xuICAgIFxufSk7XG5cbi8vIEV2ZW50IGxpc3RlbmVyIHRvIHN1Ym1pdCBmb2xkZXIgZm9ybVxuLy8gQ3JlYXRlIGEgbmV3IGZvbGRlciBpbnN0YW5jZSB3aXRoIGluZm8gZnJvbSBmb3JtXG4vLyBBZGQgdG8gRE9NXG4vLyBBZGQgdG8gc3VwZXIgZm9sZGVyXG4vLyBTaG91bGQgYmUgZG9uZSBvbiB0aGUgZm9ybSBpbnN0ZWFkIG9mIGJ1dHRvbiBidXQgTUROIGV4YW1wbGUgd2l0aCBkaWFsb2cgZGlkIGl0IHRoaXMgd2F5XG5jb25zdCBmb2xkZXJTdWJtaXRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVyLWNvbmZpcm0tYnRuJyk7XG5mb2xkZXJTdWJtaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIFxuICAgIGNvbnN0IGZvbGRlckRpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb2xkZXItZGlhbG9nJyk7XG4gICAgY29uc3Qge2ZvbGRlclRpdGxlSW5Gb3JtfSA9IGdldEZvbGRlckZvcm1JbmZvKCk7XG5cbiAgICBsZXQgbmV3Rm9sZGVyID0gRm9sZGVyKGZvbGRlclRpdGxlSW5Gb3JtKTtcbiAgICBhcHBlbmRGb2xkZXIobmV3Rm9sZGVyKTtcbiAgICBcbiAgICBzdXBlckZvbGRlci5hZGRGb2xkZXIobmV3Rm9sZGVyKTtcblxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdmb2xkZXInLCBKU09OLnN0cmluZ2lmeShuZXdGb2xkZXIpKTtcbiAgICBjb25zb2xlLmxvZyhKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiZm9sZGVyXCIpKSk7XG5cbiAgICBmb2xkZXJEaWFsb2cuY2xvc2UoKTtcbn0pO1xuXG5mdW5jdGlvbiBkaXNwbGF5TG9jYWxTdG9yYWdlKCkge1xuXG59XG5cbmNvbnNvbGUubG9nKEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2ZvbGRlcicpKSk7XG4vLyBHbyB0aHJvdWdoIGFsbCBmb2xkZXJzIGFuZCBjaGVjayBpZiB0aGUgY2xpY2tlZCBidXR0b24gdmFsdWUgbWF0Y2hlcyBmb2xkZXIgdmFsdWVcbi8vIHRoZW4gZGlzcGxheSB0YXNrcyBvZiB0aGF0IGZvbGRlciB0byBzY3JlZW5cbmZ1bmN0aW9uIGRpc3BsYXlDdXJyZW50Rm9sZGVyV2l0aElkKHRlbXBJZCkge1xuXG4gICAgc3VwZXJGb2xkZXIuZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgICAgIGlmICh0ZW1wSWQgPT09IGZvbGRlci5teUZvbGRlclV1aWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGFza0NvbnRhaW5lcigpO1xuICAgICAgICAgICAgLy9kaXNwbGF5IGFsbCB0YXNrcyBvZiB0aGlzIGZvbGRlciB0byBwYWdlXG4gICAgICAgICAgICBkaXNwbGF5Rm9sZGVyVGFza3MoZm9sZGVyKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibWF0Y2ggZm91bmRcIik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuY29uc3QgdGFza0FkZEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrLWFkZC1idG4nKTtcbi8vIENyZWF0ZSBuZXcgdGFzayBpbnN0YW5jZSB1c2luZyBpbmZvIGZyb20gZm9ybVxudGFza0FkZEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAvLyBHZXQgdmFsdWUgb2YgdGhlIHNlbGVjdGVkIGZpZWxkIChJZCBiZWNhdXNlIHZhbHVlIGlzIHNldCB0byBpZCBpbiBkb20uanMpXG4gICAgY29uc3Qgc2VsZWN0ZWRGb2xkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVyLXNlbGVjdGlvbicpO1xuICAgIGNvbnN0IHNlbGVjdGVkRm9sZGVyVmFsdWUgPSBzZWxlY3RlZEZvbGRlci52YWx1ZTtcbiAgICAvLyBHZXQgdmFsdWVzIG9mIHRoZSBmb3JtXG4gICAgY29uc3Qge3Rhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uLCB0YXNrRHVlRGF0ZSwgdGFza1ByaW9yaXR5fSA9IGdldFRhc2tGb3JtSW5mbygpO1xuXG4gICAgLy8gQ3JlYXRlIG5ldyB0YXNrIGFuZCBsb29wIHRocm91Z2ggZm9sZGVyIHRvIGZpbmQgbWF0Y2hpbmcgSWQgYW5kIGFkZFxuICAgIGNvbnN0IG5ld1Rhc2sgPSBUYXNrKHRhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uLCB0YXNrRHVlRGF0ZSwgdGFza1ByaW9yaXR5KTtcbiAgICBzdXBlckZvbGRlci5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgaWYgKHNlbGVjdGVkRm9sZGVyVmFsdWUgPT09IGZvbGRlci5teUZvbGRlclV1aWQpIHtcbiAgICAgICAgICAgIGZvbGRlci5hZGRUYXNrKG5ld1Rhc2spO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBVcGRhdGUgdGhlIHRhc2tzIG9mIHRoZSBmb2xkZXIgdGhhdCBpcyBjdXJyZW50bHkgYmVpbmcgZGlzcGxheWVkIHRvIGF2b2lkIHJlbG9hZGluZyBmb2xkZXJcbiAgICBkaXNwbGF5Q3VycmVudEZvbGRlcldpdGhJZChzZWxlY3RlZEZvbGRlclZhbHVlKTtcblxuICAgIC8vIENsZWFyIGZvcm0gZmllbGRzXG4gICAgY29uc3QgdGFza0Zvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1mb3JtJyk7XG4gICAgdGFza0Zvcm0ucmVzZXQoKTtcbiAgICBnZXRUYXNrRGlhbG9nKCkuY2xvc2UoKTtcbn0pXG5cbi8vIFNlbGVjdCB0aGUgYnV0dG9uIHdpdGggSWQgYW5kIGZpbmQgdGFzayB3aXRoIHRoYXQgSWRcbi8vIENoYW5nZSB0aGUgaW5mbyBvZiB0aGF0IHRhc2sgYW5kIHVwZGF0ZSBmb2xkZXJcbi8vIERlbGV0ZSBidXR0b24gYWZ0ZXIgYW5kIGNsb3NlXG5jb25zdCB0YXNrRWRpdENvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFzay1lZGl0LWJ0bicpO1xudGFza0VkaXRDb25maXJtQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBcbiAgICBjb25zdCBidG5JZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lZGl0LWJ0bi1pZCcpO1xuXG4gICAgY29uc3Qge3Rhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uLCB0YXNrRHVlRGF0ZSwgdGFza1ByaW9yaXR5fSA9IGdldFRhc2tFZGl0Rm9ybUluZm8oKTtcblxuICAgIHN1cGVyRm9sZGVyLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBmb2xkZXIudGFza3MuZm9yRWFjaCh0YXNrID0+IHtcbiAgICAgICAgICAgIGlmIChidG5JZC52YWx1ZSA9PT0gdGFzay5teVRhc2tVdWlkKSB7XG4gICAgICAgICAgICAgICAgdGFzay5lZGl0VGFzayh0YXNrVGl0bGUsIHRhc2tEZXNjcmlwdGlvbiwgdGFza0R1ZURhdGUsIHRhc2tQcmlvcml0eSk7XG4gICAgICAgICAgICAgICAgZGlzcGxheUN1cnJlbnRGb2xkZXJXaXRoSWQoZm9sZGVyLm15Rm9sZGVyVXVpZCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codGFzayk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSk7XG5cbiAgICBidG5JZC5yZW1vdmUoKTtcbiAgICBnZXRFZGl0RGlhbG9nKCkuY2xvc2UoKTtcblxufSlcblxuZnVuY3Rpb24gZGVsZXRlRm9sZGVyV2l0aElkKGJ1dHRvbklkKSB7XG4gICAgc3VwZXJGb2xkZXIuZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XG4gICAgICAgIGlmIChidXR0b25JZCA9PT0gZm9sZGVyLm15Rm9sZGVyVXVpZCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYnV0dG9uSWQpO1xuICAgICAgICAgICAgc3VwZXJGb2xkZXIuZGVsZXRlRm9sZGVyKGZvbGRlcik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZGVsZXRlVGFza1dpdGhJZChidXR0b25JZCkge1xuICAgIHN1cGVyRm9sZGVyLmZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xuICAgICAgICBmb2xkZXIudGFza3MuZm9yRWFjaCh0YXNrID0+IHtcbiAgICAgICAgICAgIGlmIChidXR0b25JZCA9PT0gdGFzay5teVRhc2tVdWlkKSB7XG4gICAgICAgICAgICAgICAgZm9sZGVyLmRlbGV0ZVRhc2sodGFzayk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSk7XG59XG5cblxuZnVuY3Rpb24gY2hhbmdlVGFza1N0YXR1cyh0YXNrSWQpIHtcbiAgICBzdXBlckZvbGRlci5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgZm9sZGVyLnRhc2tzLmZvckVhY2godGFzayA9PiB7XG4gICAgICAgICAgICBpZiAodGFza0lkID09PSB0YXNrLm15VGFza1V1aWQpIHtcbiAgICAgICAgICAgICAgICB0YXNrLnNldENvbXBsZXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGZpbmRUYXNrV2l0aElkKGJ1dHRvbklkKSB7XG4gICAgbGV0IG91dHB1dDtcbiAgICBzdXBlckZvbGRlci5mb2xkZXJzLmZvckVhY2goZm9sZGVyID0+IHtcbiAgICAgICAgZm9sZGVyLnRhc2tzLmZvckVhY2godGFzayA9PiB7XG4gICAgICAgICAgICBpZiAoYnV0dG9uSWQgPT09IHRhc2subXlUYXNrVXVpZCkge1xuICAgICAgICAgICAgICAgIG91dHB1dCA9IHRhc2s7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSk7XG4gICAgcmV0dXJuIG91dHB1dDtcbn1cbi8vIFRlc3QgdGFza3NcbmNvbnN0IHRhc2sxID0gVGFzaygnY2hvcmVzJywgJ3dhc2ggZGlzaGVzJywgJ25vdiAyMycsICdoaWdoJyk7XG5jb25zdCB0YXNrMiA9IFRhc2soJ21vdmllcycsICdhdmF0YXInLCAnbm92IDI5JywgJ21lZCcpO1xuY29uc3QgdGFzazMgPSBUYXNrKCdjb2RpbmcnLCAndG9kbyBsaXN0JywgJ2RlYyAxMCcsICdsb3cnKTtcblxubGV0IGluYm94Rm9sZGVyID0gRm9sZGVyKCdJbmJveCcpO1xuaW5ib3hGb2xkZXIuYWRkVGFzayh0YXNrMSk7XG5zdXBlckZvbGRlci5hZGRGb2xkZXIoaW5ib3hGb2xkZXIpO1xuYXBwZW5kRm9sZGVyKGluYm94Rm9sZGVyKTtcblxubGV0IHRlc3RGb2xkZXIyID0gRm9sZGVyKCd0ZXN0MicpO1xudGVzdEZvbGRlcjIuYWRkVGFzayh0YXNrMik7XG50ZXN0Rm9sZGVyMi5hZGRUYXNrKHRhc2sxKTtcbnRlc3RGb2xkZXIyLmFkZFRhc2sodGFzazMpO1xudGVzdEZvbGRlcjIuZGVsZXRlVGFzayh0YXNrMik7XG5zdXBlckZvbGRlci5hZGRGb2xkZXIodGVzdEZvbGRlcjIpO1xuYXBwZW5kRm9sZGVyKHRlc3RGb2xkZXIyKTtcblxuZnVuY3Rpb24gcG9wdWxhdGVTdG9yYWdlKCkge1xuICAgIGdldFRhc2tEaWFsb2coKTtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShnZXRUYXNrRGlhbG9nKCksIFwieWVsbG93XCIpO1xuXG4gICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5sZW5ndGg7XG59XG5cblxuaWYgKCFKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdmb2xkZXInKSkpIHtcbiAgICBjb25zb2xlLmxvZygnbm8gZm9sZGVyJyk7XG59IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKCdhIGZvbGRlciBleGlzdHMnKTtcblxufVxuXG4vLyBPbiBwYWdlIGxvYWQsIGNoZWNrIGZvciBzdG9yYWdlXG4vLyBJZiBzdG9yYWdlIGNvbnRhaW5zIHByb2plY3RzLCBnZXQgcHJvamVjdHMgZnJvbSBzdG9yYWdlXG4vLyBQdXQgc2FpZCBwcm9qZWN0cyBpbnRvIHByb2plY3RzIGFycmF5XG4vLyBEaXNwbGF5IHByb2plY3RzIGFycmF5IHRvIERPTSAoZnVuY3Rpb25hbGl0eSB5b3UgYWxyZWFkeSBoYXZlKVxuXG4vLyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndGVzdEZvbGRlckluU3RvcmFnZScsIEpTT04uc3RyaW5naWZ5KHRlc3RGb2xkZXIyKSlcbi8vIGNvbnNvbGUubG9nKEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Rlc3RGb2xkZXJJblN0b3JhZ2UnKSkpO1xuXG5mdW5jdGlvbiBzYXZlVG9TdG9yYWdlKGZvbGRlcikge1xuICAgIFxufVxuXG4vLyBwb3B1bGF0ZVN0b3JhZ2UoKTsgXG5cbi8vIGZ1bmN0aW9uIHN0b3JhZ2VBdmFpbGFibGUodHlwZSkge1xuLy8gICAgIGxldCBzdG9yYWdlO1xuLy8gICAgIHRyeSB7XG4vLyAgICAgICBzdG9yYWdlID0gd2luZG93W3R5cGVdO1xuLy8gICAgICAgY29uc3QgeCA9IFwiX19zdG9yYWdlX3Rlc3RfX1wiO1xuLy8gICAgICAgc3RvcmFnZS5zZXRJdGVtKHgsIHgpO1xuLy8gICAgICAgc3RvcmFnZS5yZW1vdmVJdGVtKHgpO1xuLy8gICAgICAgcmV0dXJuIHRydWU7XG4vLyAgICAgfSBjYXRjaCAoZSkge1xuLy8gICAgICAgcmV0dXJuIChcbi8vICAgICAgICAgZSBpbnN0YW5jZW9mIERPTUV4Y2VwdGlvbiAmJlxuLy8gICAgICAgICAvLyBldmVyeXRoaW5nIGV4Y2VwdCBGaXJlZm94XG4vLyAgICAgICAgIChlLmNvZGUgPT09IDIyIHx8XG4vLyAgICAgICAgICAgLy8gRmlyZWZveFxuLy8gICAgICAgICAgIGUuY29kZSA9PT0gMTAxNCB8fFxuLy8gICAgICAgICAgIC8vIHRlc3QgbmFtZSBmaWVsZCB0b28sIGJlY2F1c2UgY29kZSBtaWdodCBub3QgYmUgcHJlc2VudFxuLy8gICAgICAgICAgIC8vIGV2ZXJ5dGhpbmcgZXhjZXB0IEZpcmVmb3hcbi8vICAgICAgICAgICBlLm5hbWUgPT09IFwiUXVvdGFFeGNlZWRlZEVycm9yXCIgfHxcbi8vICAgICAgICAgICAvLyBGaXJlZm94XG4vLyAgICAgICAgICAgZS5uYW1lID09PSBcIk5TX0VSUk9SX0RPTV9RVU9UQV9SRUFDSEVEXCIpICYmXG4vLyAgICAgICAgIC8vIGFja25vd2xlZGdlIFF1b3RhRXhjZWVkZWRFcnJvciBvbmx5IGlmIHRoZXJlJ3Mgc29tZXRoaW5nIGFscmVhZHkgc3RvcmVkXG4vLyAgICAgICAgIHN0b3JhZ2UgJiZcbi8vICAgICAgICAgc3RvcmFnZS5sZW5ndGggIT09IDBcbi8vICAgICAgICk7XG4vLyAgICAgfVxuLy8gICB9XG5cbi8vIGlmIChzdG9yYWdlQXZhaWxhYmxlKFwibG9jYWxTdG9yYWdlXCIpKSB7XG4vLyAvLyBZaXBwZWUhIFdlIGNhbiB1c2UgbG9jYWxTdG9yYWdlIGF3ZXNvbWVuZXNzXG4vLyBjb25zb2xlLmxvZygneWF5Jyk7XG4vLyB9IGVsc2Uge1xuLy8gLy8gVG9vIGJhZCwgbm8gbG9jYWxTdG9yYWdlIGZvciB1c1xuLy8gY29uc29sZS5sb2coJ21haCcpO1xuLy8gfVxuZXhwb3J0IHtcbiAgICBkaXNwbGF5Q3VycmVudEZvbGRlcldpdGhJZCxcbiAgICBkZWxldGVGb2xkZXJXaXRoSWQsXG4gICAgZGVsZXRlVGFza1dpdGhJZCxcbiAgICBjaGFuZ2VUYXNrU3RhdHVzLFxuICAgIGdldFRhc2tEaWFsb2csXG4gICAgZmluZFRhc2tXaXRoSWQsXG4gICAgZ2V0RWRpdERpYWxvZ1xufSJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZXhwb3J0cyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsInJhbmRvbVVVSUQiLCJjcnlwdG8iLCJiaW5kIiwiZ2V0UmFuZG9tVmFsdWVzIiwicm5kczgiLCJVaW50OEFycmF5Iiwicm5nIiwiRXJyb3IiLCJieXRlVG9IZXgiLCJpIiwicHVzaCIsInRvU3RyaW5nIiwic2xpY2UiLCJvcHRpb25zIiwiYnVmIiwib2Zmc2V0Iiwicm5kcyIsInJhbmRvbSIsImFyciIsInVuc2FmZVN0cmluZ2lmeSIsIlRhc2siLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiZHVlRGF0ZSIsInByaW9yaXR5IiwibXlUYXNrVXVpZCIsImNvbXBsZXRlU3RhdGUiLCJnZXRDb21wbGV0ZVN0YXRlIiwiY2hhbmdlUHJpb3JpdHkiLCJuZXdQcmlvcml0eSIsInNldENvbXBsZXRlIiwiZWRpdFRhc2siLCJuZXdUaXRsZSIsIm5ld0Rlc2NyaXB0aW9uIiwibmV3RHVlRGF0ZSIsInByaW50VGFzayIsImNvbnNvbGUiLCJsb2ciLCJGb2xkZXIiLCJteUZvbGRlclV1aWQiLCJ0YXNrcyIsImFkZFRhc2siLCJuZXdUYXNrTmFtZSIsImRpc3BsYXlUYXNrcyIsImxlbmd0aCIsImRlbGV0ZVRhc2siLCJ0YXNrTmFtZSIsInNwbGljZSIsImRpc3BsYXlGb2xkZXJUYXNrcyIsImZvbGRlck5hbWUiLCJmb3JFYWNoIiwidGFzayIsImxvY2F0aW9uIiwidGFza0RPTSIsInRhc2tEaXYiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ0YXNrVGl0bGVJbkRpdiIsInRhc2tEZXNjcmlwdGlvbkluRGl2IiwidGFza0R1ZURhdGVJbkRpdiIsInRhc2tQcmlvcml0eUluRGl2IiwiY2xhc3NMaXN0IiwiYWRkIiwidGV4dENvbnRlbnQiLCJhcHBlbmRDaGlsZCIsInRhc2tEZWxldGVCdG4iLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInRoaXNCdXR0b24iLCJ0YXJnZXQiLCJkZWxldGVUYXNrV2l0aElkIiwidmFsdWUiLCJwYXJlbnROb2RlIiwicmVtb3ZlIiwiY3JlYXRlVGFza0RlbGV0ZUJ1dHRvbiIsInRhc2tFZGl0QnRuIiwiZWRpdEZvcm0iLCJnZXRFbGVtZW50QnlJZCIsImJ0bkZvcklkIiwiZm9ybSIsInRhc2tUaXRsZUluRm9ybSIsImVsZW1lbnRzIiwidGFza0Rlc2NyaXB0aW9uSW5Gb3JtIiwidGFza0R1ZURhdGVJbkZvcm0iLCJ0YXNrUHJpb3JpdHlJbkZvcm0iLCJjaGFuZ2VUYXNrRm9ybUZpZWxkcyIsImZpbmRUYXNrV2l0aElkIiwiZ2V0RWRpdERpYWxvZyIsInNob3dNb2RhbCIsImNyZWF0ZVRhc2tFZGl0QnV0dG9uIiwidGFza1N0YXR1c0J0biIsImVsZW1lbnQiLCJjaGFuZ2VUYXNrU3RhdHVzIiwiY29udGFpbnMiLCJjcmVhdGVUYXNrU3RhdHVzQnV0dG9uIiwiY3JlYXRlVGFza0VsZW1lbnQiLCJhcHBlbmRUYXNrIiwiYXBwZW5kRm9sZGVyIiwiZm9sZGVyRE9NIiwic2lkZWJhciIsInF1ZXJ5U2VsZWN0b3IiLCJmb2xkZXJEaXYiLCJmb2xkZXJCdG4iLCJmb2xkZXIiLCJmb2xkZXJEZWxldGVCdG4iLCJkZWxldGVGb2xkZXJXaXRoSWQiLCJjcmVhdGVGb2xkZXJEZWxldGVCdXR0b24iLCJjdXJyZW50Rm9sZGVySWQiLCJkaXNwbGF5Q3VycmVudEZvbGRlcldpdGhJZCIsImNyZWF0ZUZvbGRlckJ1dHRvbiIsInN1cGVyRm9sZGVyIiwiZm9sZGVycyIsImFkZEZvbGRlciIsIm5ld0ZvbGRlck5hbWUiLCJkZWxldGVGb2xkZXIiLCJTdXBlckZvbGRlciIsImdldFRhc2tEaWFsb2ciLCJ0ZW1wSWQiLCJidXR0b25JZCIsInRhc2tJZCIsIm91dHB1dCIsInJlc2V0Iiwic2VsZWN0Iiwic2VsZWN0T3B0aW9uIiwiY2xlYXJTZWxlY3RNZW51Iiwib3B0aW9uIiwiYXBwZW5kRHJvcGRvd24iLCJwcmV2ZW50RGVmYXVsdCIsImZvbGRlckRpYWxvZyIsImZvbGRlclRpdGxlSW5Gb3JtIiwiZm9sZGVyRm9ybSIsImdldEZvbGRlckZvcm1JbmZvIiwibmV3Rm9sZGVyIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJwYXJzZSIsImdldEl0ZW0iLCJjbG9zZSIsInNlbGVjdGVkRm9sZGVyVmFsdWUiLCJ0YXNrVGl0bGUiLCJ0YXNrRGVzY3JpcHRpb24iLCJ0YXNrRHVlRGF0ZSIsInRhc2tQcmlvcml0eSIsImdldFRhc2tGb3JtSW5mbyIsIm5ld1Rhc2siLCJidG5JZCIsImdldFRhc2tFZGl0Rm9ybUluZm8iLCJ0YXNrMSIsInRhc2syIiwidGFzazMiLCJpbmJveEZvbGRlciIsInRlc3RGb2xkZXIyIl0sInNvdXJjZVJvb3QiOiIifQ==